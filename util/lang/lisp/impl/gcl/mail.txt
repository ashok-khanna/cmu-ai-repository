From stolcke@ICSI.Berkeley.EDU  Tue Jul  5 15:29:39 1994
Return-Path: <stolcke@ICSI.Berkeley.EDU>
Received: from cli.com by jingles.cli.com.cliftp (4.1/SMI-4.1)
	id AA02813; Tue, 5 Jul 94 15:29:39 CDT
Received: from icsia.ICSI.Berkeley.EDU by cli.com (4.1/SMI-4.1)
	id AA21383; Tue, 5 Jul 94 14:24:55 CDT
Received: from tiramisu (stolcke@tiramisu.ICSI.Berkeley.EDU [128.32.201.72])  by icsia.ICSI.Berkeley.EDU (8.6.8/HUB+V8$Revision: 1.21 $) with ESMTP id MAA01102; Tue, 5 Jul 1994 12:10:17 -0700
Received: from localhost (stolcke@localhost) 
	by tiramisu (8.6.8/1.8) with ESMTP
	id MAA05980; Tue, 5 Jul 1994 12:10:14 -0700
Message-Id: <199407051910.MAA05980@tiramisu>
X-Authentication-Warning: tiramisu: stolcke owned process doing -bs
To: schelter@posso.ibp.fr (William Schelter)
Cc: gcl@cli.com, tkunze@vader.kgw.TU-Berlin.DE, poirot@aio.jsc.nasa.gov,
        cwitty@csl.sri.com, kcng@iet.com, bm1822@adasv2.sbc.com
Subject: Re: pcl (clos) under gcl 1.0 
In-Reply-To: Your message of Tue, 05 Jul 1994 18:59:00 +0200.
             <9407051659.AA14629@posso.ibp.fr> 
Date: Tue, 05 Jul 1994 12:10:13 PDT
From: Andreas Stolcke <stolcke@ICSI.Berkeley.EDU>

In message <9407051659.AA14629@posso.ibp.fr>you wrote:
> I have put a complete version of PCL (the xerox common lisp object system)
> adapted for GNU common lisp (GCL version 1.0) on 
> 

great! a small problem seems to remain:  defclass.lisp makes use of
the CltL2 macro `declaim' which is not defined in GCL.  It's trivial
to fix it to use the old `proclaim' instead.

I was successful in build pcl-gcl for sun4 and testing it on 
some 20k lines of CLOS code from my thesis.  I wasn't as lucky
with the sgi4d version.  I fails to compile gcl-low.c because cc complains
about the line 

use_fast_links();

generated at line 1877.  Any ideas?
s
--Andreas

*** defclass.lisp.orig	Mon Dec 21 13:24:38 1992
--- defclass.lisp	Tue Jul  5 10:39:11 1994
***************
*** 178,189 ****
                     (if defstruct-p '(load eval) *defclass-times*)
  		   `(progn
  		      ,@(mapcar #'(lambda (x)
! 				    `(declaim (ftype (function (t) t) ,x)))
  				#+cmu *readers* #-cmu nil)
  		      ,@(mapcar #'(lambda (x)
  				    #-setf (when (consp x)
  					     (setq x (get-setf-function-name (cadr x))))
! 				    `(declaim (ftype (function (t t) t) ,x)))
  				#+cmu *writers* #-cmu nil)
  		      (let ,(mapcar #'cdr *initfunctions*)
  			(load-defclass ',name
--- 178,189 ----
                     (if defstruct-p '(load eval) *defclass-times*)
  		   `(progn
  		      ,@(mapcar #'(lambda (x)
! 				    `(proclaim '(ftype (function (t) t) ,x)))
  				#+cmu *readers* #-cmu nil)
  		      ,@(mapcar #'(lambda (x)
  				    #-setf (when (consp x)
  					     (setq x (get-setf-function-name (cadr x))))
! 				    `(proclaim '(ftype (function (t t) t) ,x)))
  				#+cmu *writers* #-cmu nil)
  		      (let ,(mapcar #'cdr *initfunctions*)
  			(load-defclass ',name

From chrisp@max.tiac.net  Fri Jul 15 07:26:13 1994
Return-Path: <chrisp@max.tiac.net>
Received: from cli.com by jingles.cli.com.cliftp (4.1/SMI-4.1)
	id AA03840; Fri, 15 Jul 94 07:26:13 CDT
Received: from max.tiac.net by cli.com (4.1/SMI-4.1)
	id AA13439; Fri, 15 Jul 94 06:26:51 CDT
Received: (from chrisp@localhost) by max.tiac.net (8.6.8/8.6.6.Beta9) id HAA13751; Fri, 15 Jul 1994 07:23:42 -0400
Date: Fri, 15 Jul 1994 07:23:42 -0400
From: Chris Patti { Feoh } <chrisp@max.tiac.net>
Message-Id: <199407151123.HAA13751@max.tiac.net>
To: wfs@math.utexas.edu
Cc: gcl@cli.com
Subject: Here are the diffs to gcl.el that made it work for me..


Hi.

I had to bash gcl.el a bit to get it to work. Here is the diff:

83c83,84
<   (require 'shell)
---
>   (require 'sshell)
>   (load "inf-lisp")
97c98,100
< 	  (t  (inferior-lisp-mode))))
---
> 	  (t
> 	   (inferior-lisp-mode)
> 	   (setq inferior-lisp-buffer (get-buffer "*gcl-lisp*")))))
347d349
< 

'run' was failing on make-shell because you had required 'shell instead of 
'sshell.

The bigger problem was that you were trying to use inferior-lisp-mode which
doesn't come pre-loaded <at least not with emacs 19.22>. it's only loaded 
after inferior-lisp is called which autoloads the rest of the package.. The
way I got around this <inelegant?> is to load inf-lisp.el which contains the 
appropriate code.

The only other problem was that once we'd successfully entered inferior-lisp-
mode emacs didn't know which lisp to send to, so I set the inferior-lisp-buffer
variable to the buffer named *gcl-lisp* which gets created by make-shell.

That's about it.

Am I missing something blatantly obvious? Did I do all this for naught because
I forgot some subtle trick in the installation procedure?

-Chris
P.S. It's so short I'm going to include the full gcl.el here since I'm not
sure I did the right thing with diff. <My man page is missing, Uhgh.>


From rcthakur@map.iitd.ernet.in  Tue Oct 18 04:51:55 1994
Return-Path: <rcthakur@map.iitd.ernet.in>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02281; Tue, 18 Oct 94 04:51:55 CDT
Received: from sangam.ncst.ernet.in by cli.com (4.1/SMI-4.1)
	id AA19734; Tue, 18 Oct 94 03:41:41 CDT
Received: (from root@localhost) by sangam.ncst.ernet.in (8.6.8.1/8.6.6) with UUCP id OAA22204; Tue, 18 Oct 1994 14:11:10 +0500
Received: from map.iitd.ernet.in (netearth) by henna.iitd.ernet.in (4.1/SMI-4.1-MHS-7.0
 )
	id AA16123; Tue, 18 Oct 94 14:10:49 IST
X-Organisation: Indian Institute of Technology, New Delhi.
Received: by map.iitd.ernet.in; id AA01059; Tue, 18 Oct 1994 14:10:48 +0530
Received: by map; Tue, 18 Oct 1994 14:10:48 +0530
	id AA01059; Tue, 18 Oct 1994 14:10:48 +0530
Date: Tue, 18 Oct 1994 14:10:47 +0530 (IST)
From: "Mr. R.C. Thakur SSO-II" <rcthakur@map.iitd.ernet.in>
Subject: 
To: gcl-request@cli.com
Cc: gcl@cli.com
Message-Id: <Pine.3.89.9410181412.A947-0100000@map.iitd.ernet.in>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

subscribe mailing list


From @festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk  Tue Oct 18 13:05:13 1994
Return-Path: <@festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02318; Tue, 18 Oct 94 13:05:13 CDT
Received: from sun2.nsfnet-relay.ac.uk by cli.com (4.1/SMI-4.1)
	id AA20943; Tue, 18 Oct 94 11:46:04 CDT
Via: uk.ac.edinburgh.festival; Tue, 18 Oct 1994 16:43:48 +0100
Received: from skye-alter.aiai.ed.ac.uk by festival.ed.ac.uk id aa03962;
          18 Oct 94 16:44 BST
Received: from subnode.aiai.ed.ac.uk (bute) by aiai.ed.ac.uk;
          Tue, 18 Oct 94 16:42:48 BST
Date: Tue, 18 Oct 94 16:42:47 BST
Message-Id: <22533.9410181542@subnode.aiai.ed.ac.uk>
From: Jeff Dalton <jeff@aiai.edinburgh.ac.uk>
Subject: null-terminated strings?
To: gcl@cli.com

Are strings in GCL null-terminated?  It would make it much easier
to pass them to C functions if they were.

-- jeff

From wfs@math.utexas.edu  Tue Oct 18 16:53:20 1994
Return-Path: <wfs@math.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02360; Tue, 18 Oct 94 16:53:20 CDT
Received: from fireant.ma.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA21644; Tue, 18 Oct 94 15:21:00 CDT
Received: from nicolas.ma.utexas.edu by fireant.ma.utexas.edu (5.64/5.51)
	id AA25421; Tue, 18 Oct 94 15:18:00 -0500
Date: Tue, 18 Oct 94 15:17:53 -0500
From: wfs@math.utexas.edu (Bill Schelter)
Posted-Date: Tue, 18 Oct 94 15:17:53 -0500
Message-Id: <9410182017.AA06001@nicolas.ma.utexas.edu>
Received: by nicolas.ma.utexas.edu (5.61/5.51)
	id AA06001; Tue, 18 Oct 94 15:17:53 -0500
To: gcl@cli.com
Cc: jeff@aiai.edinburgh.ac.uk
In-Reply-To: Jeff Dalton's message of Tue, 18 Oct 94 16:42:47 BST <22533.9410181542@subnode.aiai.ed.ac.uk>
Subject: Re: null-terminated strings?
Reply-To: wfs@math.utexas.edu


They are not null terminated.

but the function object_to_string(x) takes a lisp string and returns a C string
which is null terminated.

In either the case the string is with fill pointer and fill pointer < length
or in the case length mod 4 is not 0, the result will not require a copy.
Otherwise it is copied.

The functions like defentry automatically invoke this.

Another thing to worry about is that if your string is relocatable,
then it will move on gc, so be careful if you let C hang onto it past
a garbage collection.

















From attardi@DI.UniPi.IT  Wed Oct 19 05:54:06 1994
Return-Path: <attardi@DI.UniPi.IT>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02423; Wed, 19 Oct 94 05:54:06 CDT
Received: from apollo.di.unipi.it by cli.com (4.1/SMI-4.1)
	id AA23119; Wed, 19 Oct 94 04:47:31 CDT
Received: from omega.di.unipi.it by apollo.di.unipi.it with SMTP
	(1.37.109.4/16.2) id AA08170; Wed, 19 Oct 94 10:46:24 +0100
Organization: Dipartimento di Informatica - Universita' di Pisa - Italy
Received: by omega (5.0/SMI-4.1)
	id AA01232; Wed, 19 Oct 1994 10:45:45 --100
Date: Wed, 19 Oct 1994 10:45:45 --100
From: attardi@DI.UniPi.IT
Message-Id: <9410190945.AA01232@omega>
To: jeff@aiai.edinburgh.ac.uk
Cc: gcl@cli.com
In-Reply-To: <22533.9410181542@subnode.aiai.ed.ac.uk> (message from Jeff Dalton on Tue, 18 Oct 94 16:42:47 BST)
Subject: Re: null-terminated strings?
Content-Length: 568


   >From <@festival.ed.ac.uk:jeff@aiai.edinburgh.ac.uk> Tue Oct 18 18:55:26 1994
   Date: Tue, 18 Oct 94 16:42:47 BST
   From: Jeff Dalton <jeff@aiai.edinburgh.ac.uk>

   Are strings in GCL null-terminated?  It would make it much easier
   to pass them to C functions if they were.

ECoLisp has null terminated strings, stored in non relocatable pages to
avoid the problems mentioned by Schelter.
Many changes were required to the original KCL code to support this feature.
You may look at the ECoLisp code:

	ftp.di.unipi.it:/pub/lang/lisp/ecl-0.15.tar.gz

-- Beppe

From wfs@math.utexas.edu  Wed Oct 19 13:57:54 1994
Return-Path: <wfs@math.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02633; Wed, 19 Oct 94 13:57:54 CDT
Received: from fireant.ma.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA24249; Wed, 19 Oct 94 12:39:38 CDT
Received: from nicolas.ma.utexas.edu by fireant.ma.utexas.edu (5.64/5.51)
	id AA18540; Wed, 19 Oct 94 12:36:18 -0500
Date: Wed, 19 Oct 94 12:36:06 -0500
From: wfs@math.utexas.edu (Bill Schelter)
Posted-Date: Wed, 19 Oct 94 12:36:06 -0500
Message-Id: <9410191736.AA07089@nicolas.ma.utexas.edu>
Received: by nicolas.ma.utexas.edu (5.61/5.51)
	id AA07089; Wed, 19 Oct 94 12:36:06 -0500
To: gcl@cli.com
Cc: jeff@aiai.edinburgh.ac.uk, attardi@DI.UniPi.IT
In-Reply-To: attardi@DI.UniPi.IT's message of Wed, 19 Oct 1994 10:45:45 --100 <9410190945.AA01232@omega>
Subject: Re: null-terminated strings?
Reply-To: wfs@math.utexas.edu


 
   has null terminated strings, stored in non relocatable pages to
   avoid the problems mentioned by Schelter.

Perhaps I was not sufficiently precise.    If you are passing information
frequently to C via a string, to avoid any consing you may reuse a string:

(setq s (make-array (+ n 1) :element-type 'string-char :static t :fill-pointer 0))

if n is the longest string you are interested in.  A convenient way to
copy into a string with fill pointer is to use format..

(format s "~a" x)













From hxl@epic.com  Thu Oct 20 19:22:32 1994
Return-Path: <hxl@epic.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA03386; Thu, 20 Oct 94 19:22:32 CDT
Received: from epic.com ([192.58.180.22]) by cli.com (4.1/SMI-4.1)
	id AA28579; Thu, 20 Oct 94 18:02:24 CDT
Received: from weber.epic ([192.58.180.44]) by epic.com (4.1/JMA.3)
	id AA13483; Thu, 20 Oct 94 16:06:49 PDT
Received: by weber.epic (4.1/SMI-4.1)
	id AA17430; Thu, 20 Oct 94 16:02:19 PDT
Date: Thu, 20 Oct 94 16:02:19 PDT
From: hxl@epic.com (Charlie Xiaoli Huang)
Message-Id: <9410202302.AA17430@weber.epic>
To: gcl@cli.com
Subject: ftp.cli.com not responding?
Reply-To: hxl@epic.com

Hi,

I'm having trouble with ftp.cli.com, which is supposedly the archive
site for gcl related materials. It doesn't seem to allow anonymous
ftp. Am I doing something wrong?

hxl

From boyer@cli.com  Fri Oct 21 13:25:22 1994
Return-Path: <boyer@cli.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA03796; Fri, 21 Oct 94 13:25:22 CDT
Received: from rita (rita.cli.com) by cli.com (4.1/SMI-4.1)
	id AA00759; Fri, 21 Oct 94 12:17:13 CDT
From: boyer@cli.com (Robert S. Boyer)
Received: by rita (4.1) id AA11522; Fri, 21 Oct 94 12:17:13 CDT
Date: Fri, 21 Oct 94 12:17:13 CDT
Message-Id: <9410211717.AA11522@rita>
To: nqthm-users@cli, gcl@cli
Subject: anonymous ftp access to ftp.cli.com is impossible for some

In the past, some software such as GCL and Nqthm has been advertised
as being available through anonymous ftp from ftp.cli.com.  Yesterday
I learned, however, that anonymous ftp to ftp.cli.com does not work
from some Internet sites, namely from any site whose IP number cannot
be resolved into a hostname.

Until yesterday, people encountering such difficulties simply had
their attempted connections broken, without explanation, immediately
after supplying the "anonymous" login name.  Now at least they should
receive a message that suggests that they try to initiate the ftp
connection from some machine whose hostname is published in some way
that ftp.cli.com can detect.

I regret that this restriction exists.  It is certainly not something
I favor.

I apologize to those who have been disconnected without explanation.

Bob



From hxl@epic.com  Mon Oct 24 17:33:02 1994
Return-Path: <hxl@epic.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA04495; Mon, 24 Oct 94 17:33:02 CDT
Received: from epic.com ([192.58.180.22]) by cli.com (4.1/SMI-4.1)
	id AA06756; Mon, 24 Oct 94 15:43:44 CDT
Received: from healy.epic ([192.58.180.73]) by epic.com (4.1/JMA.3)
	id AA29314; Mon, 24 Oct 94 13:49:19 PDT
Received: by healy.epic (4.1/SMI-4.1)
	id AA29489; Mon, 24 Oct 94 13:43:55 PDT
Date: Mon, 24 Oct 94 13:43:55 PDT
From: hxl@epic.com (Charlie Xiaoli Huang)
Message-Id: <9410242043.AA29489@healy.epic>
To: gcl@cli.com
Cc: wfs@math.utexas.edu
Subject: compiler optimization --- what am i doing wrong?
Reply-To: hxl@epic.com

Hi,

I'm trying to assess the efficiency of compiled code in gcl (1.1
beta.) I've got the following piece of code to do the hanoi tower
problem:

	(defun hanoi (n)
	  (labels ((move-them (n from to helper)
			      (if (> n 1)
				(progn
				 (move-them (- n 1) from helper to)
	;			 (format t "~a --> ~a~%" from to)
				 (move-them (- n 1) helper to from)))))
		  (move-them n 'L 'C 'R)))

When I compile and run this on a Sparc 10-50, the run times I got are:

	(hanoi 20)	-> 3.7 sec.
	(hanoi 25)	-> 151.56 sec.
	(hanoi 30)	-> (killed after a hour)

Whereas an almost identical program in scheme, when compiled and run
in Scheme->C from DEC, yields:

  	(hanoi 20)	-> 0.3 sec.
	(hanoi 25) 	-> 13.50 sec.
	(hanoi 30)	-> 447.20 sec.

(By the way, I also coded it in C, which run about 3 times faster than
 Scheme->C, and about 20-30 times that of gcl.)

I looked at the C code generated. Here's the guts of the c code from
gcl:

/*      local function MOVE-THEM        */

static L2(base0)
register object *base0;
{       register object *base=vs_base;
        register object *sup=base+VM2; VC2
        vs_check;
        {object V2;
        object V3;
        object V4;
        object V5;
        V2=(base[0]);
        V3=(base[1]);
        V4=(base[2]);
        V5=(base[3]);
        vs_top=sup;
TTL:;
        if(!(number_compare((V2),small_fixnum(1))>0)){
        goto T6;}
        base[4]= number_minus((V2),small_fixnum(1));
        base[5]= (V3);
        base[6]= (V5);
        base[7]= (V4);
        vs_top=(vs_base=base+4)+4;
        L2(base0);
        vs_top=sup;
        V2= number_minus((V2),small_fixnum(1));
        {object V6;
        V6= (V5);
        V5= (V3);
        V3= (V6);}
        goto TTL;
        return;
T6:;
T6:;
        base[4]= Cnil;
        vs_top=(vs_base=base+4)+1;
        return;
        }
}

[ Admittedly I could have added type information and other minor
  tuning. But my scheme code didn't have any of that anyway.]

As much as I can tell, this isn't significantly different from what
Scheme-> produces:

TSCP  hanoi_m2004( n2006, f2007, t2008, h2009 )
        TSCP  n2006, f2007, t2008, h2009;
{
        TSCP  X2, X1;

L2042:
        if  ( LTE( _S2CINT( n2006 ), _S2CINT( _TSCP( 4 ) ) ) )  goto L2043;
        X1 = _TSCP( DIFFERENCE( _S2CINT( n2006 ), 
                                _S2CINT( _TSCP( 4 ) ) ) );
        hanoi_m2004( X1, f2007, h2009, t2008 );
        X1 = _TSCP( DIFFERENCE( _S2CINT( n2006 ), 
                                _S2CINT( _TSCP( 4 ) ) ) );
        X2 = h2009;
        h2009 = f2007;
        f2007 = X2;
        n2006 = X1;
        GOBACK( L2042 );
L2043:
        return( FALSEVALUE );
}

Yet the run time difference is close to 10-fold. I wonder if anyone has
looked at the cause of such differences. Since the generated code is
almost the same, it would be a pity for gcl's run time to be so much
slower than Scheme->C's. Is it caused by the fact that all parameters
in gcl's functions are passed in arrays and therefore indirectly
accessed, whereas in Scheme->C's code they are scalars? 

Regards,

hxl










From wfs@math.utexas.edu  Mon Oct 24 18:20:58 1994
Return-Path: <wfs@math.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA04540; Mon, 24 Oct 94 18:20:58 CDT
Received: from fireant.ma.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA06990; Mon, 24 Oct 94 16:59:02 CDT
Received: from nicolas.ma.utexas.edu by fireant.ma.utexas.edu (5.64/5.51)
	id AA17779; Mon, 24 Oct 94 16:55:34 -0500
Date: Mon, 24 Oct 94 16:55:08 -0500
From: wfs@math.utexas.edu (Bill Schelter)
Posted-Date: Mon, 24 Oct 94 16:55:08 -0500
Message-Id: <9410242155.AA12954@nicolas.ma.utexas.edu>
Received: by nicolas.ma.utexas.edu (5.61/5.51)
	id AA12954; Mon, 24 Oct 94 16:55:08 -0500
To: hxl@epic.com, gcl@cli.com
Cc: 
In-Reply-To: Charlie Xiaoli Huang's message of Mon, 24 Oct 94 13:43:55 PDT <9410242043.AA29489@healy.epic>
Subject: Re: compiler optimization --- what am i doing wrong?
Reply-To: wfs@math.utexas.edu



Unfortunately labels constructs are currently slow in gcl [as you noted
the argument passing is slow], and will be
improved.

However when I code this as a regular function, and add the
information that n will be a fixnum, you can see that the gcl times
are almost half the times you reported for scheme.  I suspect the only
difference between what you see in this and what hand written C would
get, is that we do the recursive calls thru a pointer, to allow things
like tracing and redefines to take place.


; hanoi N  gcl  scheme->c   gcl (sun c)
;      20  .27     .39 
;      25  7.8   13.5         7.4
;      30  251  442

I am using your figures for scheme-c Note that if I set the compiler
to not do the link calls [ie no tracing possible], then the time is
6.4 for hanoi 25 using sun c compiler [free version].

Inserting file ~/foo.lisp
---Begin File ~/foo.lisp---

(proclaim '(ftype (function (fixnum t t t) t) hanoi-move))
(defun hanoi-move (n from to helper)
  (declare (fixnum n))
  (if (> n 1)
      (progn
	(hanoi-move (the fixnum (- n 1)) from helper to)
        ;                        (format t "~a --> ~a~%" from to)
	(hanoi-move (the fixnum (- n 1)) helper to from))))


;When I compile and run this on a Sparc 10 the run times I got are:
;
; hanoi N  gcl  scheme->c
;      20  .27     .39
;      25  7.8   13.5
;      30  251  442  

      

---End File ~/foo.lisp---



From attardi@DI.UniPi.IT  Tue Oct 25 04:29:12 1994
Return-Path: <attardi@DI.UniPi.IT>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA04741; Tue, 25 Oct 94 04:29:12 CDT
Received: from apollo.di.unipi.it by cli.com (4.1/SMI-4.1)
	id AA08146; Tue, 25 Oct 94 03:31:20 CDT
Received: from omega.di.unipi.it by apollo.di.unipi.it with SMTP
	(1.37.109.4/16.2) id AA18759; Tue, 25 Oct 94 09:30:25 +0100
Organization: Dipartimento di Informatica - Universita' di Pisa - Italy
Received: by omega (5.0/SMI-4.1)
	id AA04465; Tue, 25 Oct 1994 09:29:58 --100
Date: Tue, 25 Oct 1994 09:29:58 --100
From: attardi@DI.UniPi.IT
Message-Id: <9410250829.AA04465@omega>
To: hxl@epic.com
Cc: gcl@cli.com
In-Reply-To: <9410242043.AA29489@healy.epic> (hxl@epic.com)
Subject: Re: compiler optimization --- what am i doing wrong?
Content-Length: 1180


I have tried your example with ECoLisp, a Lisp->C compiler
derived from (A)KCL which uses standard C calling conventions.

This is the compiled code:

/*      function definition for HANOI                                 */
static L1(int narg, object V1)
{ VT3 VLEX3 CLSR3
TTL:
        RETURN(LC2(4,(V1),VV[0],VV[1],VV[2])      /*  MOVE-THEM       */);
}
;;; Emitting code for MOVE-THEM.
 
/*      local function MOVE-THEM                                      */
static LC2(int narg, object V1, object V2, object V3, object V4)
{ VT4 VLEX4 CLSR4
        {int V5;
        V5= fix(V1);
TTL:
        if(!((V5)>(1))){
        goto L2;}
        LC2(4,MAKE_FIXNUM((V5)-(1)),(V2),(V4),(V3))/*  MOVE-THEM      */;
        V5= (V5)-(1);
        {object V6;
        V6= (V4);
        V4= (V2);
        V2= (V6);}
        goto TTL;
L2:
        VALUES(0) = Cnil;
        RETURN(1);
        }
}

by adding (declare (fixnum n)) in move-them.

Even if this code could still be improved, the times are similar to
those of Scheme->C:

	(hanoi 20)	-> 0.233 sec.
	(hanoi 25)	-> 13.717 sec.
	(hanoi 30)	-> 486.817 sec.

-- Beppe

PS
ECoLisp is available for ftp from ftp.di.unipi.it:/pub/lang/lisp.

From loosemore-sandra@CS.YALE.EDU  Wed Dec  7 13:01:09 1994
Return-Path: <loosemore-sandra@CS.YALE.EDU>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02781; Wed, 7 Dec 94 13:01:09 CST
Received: from NEBULA.SYSTEMSZ.CS.YALE.EDU (SYSTEMSZ-GW.CS.YALE.EDU) by cli.com (4.1/SMI-4.1)
	id AA06057; Wed, 7 Dec 94 11:52:31 CST
Received: from FUNCTOR.SYSTEMSZ.CS.YALE.EDU by NEBULA.SYSTEMSZ.CS.YALE.EDU via SMTP; Wed, 7 Dec 1994 12:54:22 -0500
Received: by FUNCTOR.SYSTEMSZ.CS.YALE.EDU (Sendmail-5.67b/res.client.cf-3.7)
	id AA03228; Wed, 7 Dec 1994 12:54:07 -0500
Date: Wed, 7 Dec 1994 12:54:07 -0500
From: loosemore-sandra@CS.YALE.EDU (Sandra Loosemore)
Message-Id: <199412071754.AA03228@FUNCTOR.SYSTEMSZ.CS.YALE.EDU>
To: gcl@cli.com
Subject: problems building gcl-1.1

We're having troubles building gcl-1.1 here (on a sparc running SunOS
4.1.3).  It's croaking with a zillion error messages trying to compile
c/sfasl.c (and rel_sun4.c, which it includes).  As far as I can figure
out, it looks like this file isn't even intended to be compiled by
itself (it says it's supposed to be included in unixfasl.c) and is
missing some critical #includes.  Any clue as to what's going on here?
Is the problem in the makefile or the sun4-specific code files?

-Sandra

From smith@io.litton.com  Fri Dec  9 14:20:40 1994
Return-Path: <smith@io.litton.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA03352; Fri, 9 Dec 94 14:20:40 CST
Received: from lcsdns1.litton.com by cli.com (4.1/SMI-4.1)
	id AA12827; Fri, 9 Dec 94 13:13:25 CST
Received: from io.dsd.litton.com by lcsdns1.litton.com (4.1/SMI-4.1)
	id AA09032; Fri, 9 Dec 94 11:10:56 PST
Received: by io.dsd.litton.com (Concentrix-2800 3.0/SMI-4.1)
	id AA12190; Fri, 9 Dec 94 11:05:36 PST
Date: Fri, 9 Dec 94 11:05:36 PST
From: Bill Smith <smith@io.dsd.litton.com>
Message-Id: <9412091905.AA12190@io.dsd.litton.com>
To: gcl@cli.com
Subject: Solaris 2.3 port

We're trying to build gcl 1.1 on a Solaris 2.3 system using the
Sparcworks C compiler, but we're running into lots of difficulty.  Has
anyone done this?  Any advice?

We get lots of compiler warnings (which we're ignoring for the time
being), but finally get some errors with data types we can't resolve
and which are making us suspicious that we haven't built our
configuration files correctly.

Thanks
Bill Smith
smith@io.dsd.litton.com (header address probably incorrect)

From Chandan.Haldar@blr.sni.de  Wed Dec 14 06:07:36 1994
Return-Path: <Chandan.Haldar@blr.sni.de>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA04593; Wed, 14 Dec 94 06:07:36 CST
Received: from mail.sni.de by cli.com (4.1/SMI-4.1)
	id AA23211; Wed, 14 Dec 94 05:02:17 CST
Received: from blrsn01.blr.sni.de by mail.sni.de with SMTP (PP) id <17748-0@mail.sni.de>; Wed, 14 Dec 1994 11:59:30 +0100
Received: by blr.sni.de (4.1/SMI-4.1)
	id AA19894; Wed, 14 Dec 94 13:00:18+050
Date: Wed, 14 Dec 94 13:00:18+050
From: Chandan.Haldar@blr.sni.de (Dr. Chandan Haldar)
Message-Id: <9412140800.AA19894@blr.sni.de>
To: gcl@cli.com
Subject: Japanese ...


Apology for non-GCL query, but this is the most likely place I know
where I could ask this!  Does anybody know of a public domain
Japanese-English dictionary (either Kana-English or Kanji-English)
and/or a Japanese grammar spec in some machine-readable form?  Where?

Thanks.

--------------------------------------------------------------------------
Dr. Chandan Haldar
--------------------------------------------------------------------------
Siemens Information Systems Limited
29 Infantry Road, Bangalore 560 001, India.
Phone:    +91 80 559 1113                       Fax:      +91 80 559 1214
Internet: Chandan.Haldar@blr.sni.de
--------------------------------------------------------------------------

From leverich@rand.org  Fri Dec 16 22:29:01 1994
Return-Path: <leverich@rand.org>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA05066; Fri, 16 Dec 94 22:29:01 CST
Received: from rand.org by cli.com (4.1/SMI-4.1)
	id AA01765; Fri, 16 Dec 94 21:38:00 CST
Received: from monty.rand.org (monty-cc.rand.org [130.154.8.173]) by rand.org (8.6.9/8.6.9) with ESMTP id TAA28867 for <gcl@cli.com>; Fri, 16 Dec 1994 19:37:34 -0800
Received: from atlantis.rand.org (atlantis.rand.org [130.154.12.124]) by monty.rand.org (8.6.9/8.6.9) with ESMTP id TAA07114 for <gcl@cli.com>; Fri, 16 Dec 1994 19:37:40 -0800
Received: from localhost.rand.org (localhost.rand.org [127.0.0.1]) by atlantis.rand.org (8.6.9/8.6.9) with SMTP id TAA17006 for <gcl@cli.com>; Fri, 16 Dec 1994 19:37:39 -0800
Message-Id: <199412170337.TAA17006@atlantis.rand.org>
To: gcl@cli.com
Reply-To: Brian_Leverich@rand.org
Subject: SGC on Linux
Date: Fri, 16 Dec 94 19:37:37 PST
From: Brian Leverich <leverich@rand.org>



Before the RAND mafia reinvents the wheel, does anyone have the SGC
working under Linux?  The more recent kernels should have the mprotect
functionality, I think, but GCL (at least GCL 1.0) didn't seem to like
what the OS served up.

BTW, with a little help from Scott Musman at MITRE, we've now got CLX,
GARNET, and GNU ROSS all running together under Linux.  Makes for a
nice environment.  We'll be putting the patched versions of everything
up for ftp after a little cleaning up.  Cheers, B.


-----------
Dr. Brian Leverich
Information Systems Scientist, The RAND Corporation
leverich@rand.org

From windley@lal.cs.byu.edu  Mon Dec 19 13:31:36 1994
Return-Path: <windley@lal.cs.byu.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA05367; Mon, 19 Dec 94 13:31:36 CST
Received: from leopard.cs.byu.edu by cli.com (4.1/SMI-4.1)
	id AA05481; Mon, 19 Dec 94 11:47:01 CST
Received: from jaguar.cs.byu.edu by leopard.cs.byu.edu with SMTP
	(1.38.193.4/16.2) id AA26630; Mon, 19 Dec 1994 10:51:45 -0700
Received: from localhost by jaguar.cs.byu.edu (1.38.193.4/CS-Client)
	id AA13985; Mon, 19 Dec 1994 10:49:08 -0700
Message-Id: <9412191749.AA13985@jaguar.cs.byu.edu>
To: gcl@cli.com
Subject: intermitent error: The function NIL is undefined.
Date: Mon, 19 Dec 1994 10:49:07 -0700
From: "Phil Windley" <windley@lal.cs.byu.edu>


I am using GCL 1.0 on an HP7xx to run the HOL theorem proving system.  I've
been having a problem which after some debuggin appears to be something in
LISP, not a problem with HOL.  I get the following message:

    Error: The function NIL is undefined.
    Fast links are on: do (use-fast-links nil) for debugging
    Error signalled by FUN%6115%20.
    Backtrace:  > funcall > lambda > cons > FUN%6115%20
    evaluation failed     lisp error

This happens on some applications *some of the time*.  In other words,
sometimes the expression will work and ither times this message is
generated.  I cannot figure out a pattern as to why it works sometimes.
The expressions are fairly large, but certainly not the largest I do.

These same expressions worked without failure under AKCL 1.615.

Does anyone know what could be causing this?


--phil--



__________________________________________________________________________
Phillip J. Windley, Asst. Professor              |  windley@cs.byu.edu
Laboratory for Applied Logic	                 |  
Dept. of Computer Science, TMCB 3370             |
Brigham Young University                         |  Phone: 801.378.3722
Provo UT                  84602-6576             |  Fax:   801.378.7775
------------------------------------------------------------------------
If you use WWW, I can be found <A
HREF="http://lal.cs.byu.edu/people/windley/windley.html">here</A> or<A
HREF="http://www.imall.com/homepage.html">here</A>.

From jmacd@uclink.berkeley.edu  Sun Jan  1 06:21:12 1995
Return-Path: <jmacd@uclink.berkeley.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA07382; Sun, 1 Jan 95 06:21:12 CST
Received: from uclink3.berkeley.edu by cli.com (4.1/SMI-4.1)
	id AA29957; Sun, 1 Jan 95 05:32:46 CST
Received: from uclink.berkeley.edu by uclink3.berkeley.edu (8.6.8/1.33(web)-OV2)
	id DAA07095; Sun, 1 Jan 1995 03:32:45 -0800
Received: by uclink.berkeley.edu (8.6.9/1.33(web)-OV4)
	id DAA24759; Sun, 1 Jan 1995 03:32:44 -0800
Date: Sun, 1 Jan 1995 03:32:44 -0800
From: jmacd@uclink.berkeley.edu (Joshua Peck Macdonald)
Message-Id: <199501011132.DAA24759@uclink.berkeley.edu>
To: gcl@cli.com
Subject: xakcl question


I'm not sure if this is an appropriate place to post a question
regarding xakcl which I"ve (well sort of I guess) compiled for
FreeBSD.  It builds and loads and saves everything properly, but
I can't seem to get anything done and I'm not sure why because
I try to initialize a display with (setq *default-display*
(XOpenDisplay (get-c-string ""))) as it suggests but get-c-string
causes an error.  It seems to be defined like this:

(defCfun "object get_c_string(s) object s;" 0
  " return(s->st.st_self);"
  )

(defentry get_c_string_2 (object) (object get_c_string))

(defun get-c-string (string)
  (get_c_string_2 (concatenate 'string string "^@")))

but it signals a fatal error in PRIN1.  I'm interested in trying
out thisinterface to X through gcl and would appreciate any help.

I'm sorry if this is a stupid/inappropriate/misplaced question.

thanks in advance,

josh

From leverich@rand.org  Sun Jan  1 17:29:31 1995
Return-Path: <leverich@rand.org>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA07455; Sun, 1 Jan 95 17:29:31 CST
Received: from rand.org by cli.com (4.1/SMI-4.1)
	id AA00440; Sun, 1 Jan 95 16:30:17 CST
Received: from monty.rand.org (monty-cc.rand.org [130.154.8.173]) by rand.org (8.6.9/8.6.9) with ESMTP id OAA16604; Sun, 1 Jan 1995 14:30:04 -0800
Received: from atlantis.rand.org (atlantis.rand.org [130.154.12.124]) by monty.rand.org (8.6.9/8.6.9) with ESMTP id OAA04274; Sun, 1 Jan 1995 14:30:03 -0800
Received: from localhost.rand.org (localhost.rand.org [127.0.0.1]) by atlantis.rand.org (8.6.9/8.6.9) with SMTP id OAA08869; Sun, 1 Jan 1995 14:30:01 -0800
Message-Id: <199501012230.OAA08869@atlantis.rand.org>
To: jmacd@uclink.berkeley.edu (Joshua Peck Macdonald)
Cc: gcl@cli.com, Brian_Leverich@rand.org
Reply-To: Brian_Leverich@rand.org
Subject: Re: xakcl question 
In-Reply-To: Your message of Sun, 01 Jan 95 03:32:44 PST.
             <199501011132.DAA24759@uclink.berkeley.edu> 
Date: Sun, 01 Jan 95 14:29:59 PST
From: Brian Leverich <leverich@rand.org>



We use Linux and CLX rather than FreeBSD and xakcl.  To get that stuff 
to run, we needed the following patch to the header file for the machine
type:

/* Linux version by Scott Musman (MITRE) and Mike Harm (USC) */

#define LISTEN_FOR_INPUT(fp) \
  if((c=0,ioctl((fp)->_fileno, FIONREAD, &c),c<=0) \
	&& ((fp)->_IO_read_ptr >= (fp)->_IO_read_end)) \
     return 0

The other thing we had to do was hack CLX to handle the endianness of
the Intel architecture.

Sorry if these are orthogonal to your problem - I'm still recovering from
last night's partying and I only have 3 neurons confirmed firing.  -B

-- Your message was:   (from "jmacd@uclink.berkeley.edu")
  
  I'm not sure if this is an appropriate place to post a question
  regarding xakcl which I"ve (well sort of I guess) compiled for
  FreeBSD.  It builds and loads and saves everything properly, but
  I can't seem to get anything done and I'm not sure why because
  I try to initialize a display with (setq *default-display*
  (XOpenDisplay (get-c-string ""))) as it suggests but get-c-string
  causes an error.

From hxl@epic.com  Tue Jan  3 19:56:58 1995
Return-Path: <hxl@epic.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA07850; Tue, 3 Jan 95 19:56:58 CST
Received: from epic.com (gate.epic.com) by cli.com (4.1/SMI-4.1)
	id AA03927; Tue, 3 Jan 95 19:10:54 CST
Received: from weber.epic (weber.epic.com) by epic.com (4.1/JMA.3)
	id AA21412; Tue, 3 Jan 95 17:18:04 PST
Received: by weber.epic (4.1/SMI-4.1)
	id AA13538; Tue, 3 Jan 95 17:11:53 PST
Date: Tue, 3 Jan 95 17:11:53 PST
From: hxl@epic.com (Charlie Xiaoli Huang)
Message-Id: <9501040111.AA13538@weber.epic>
To: gcl@cli.com
Subject: gprof doesn't work? (sun4, gcc 2.4.5, gcl 1.1)
Reply-To: hxl@epic.com

I can't seem to compile a profile-able version of gcl1.1. This is what
I did:

	% ./add-defs sun4
	% make			---> saved_gcl and everything was fine!
	% mkdir go
	% rm -f o/*.o
	% (cd go; ln ../o/makefile .)
	% make kcp		---> got as far as raw_gcl 

Here's the error message and a stack trace from the end of "make kcp":

../unixport/raw_gcl ../unixport/ < foo
GCL (GNU Common Lisp)  April 1994  16384 pages
loading ../lsp/export.lsp
Initializing ../lsp/defmacro.o
Initializing ../lsp/evalmacros.o
Initializing ../lsp/top.o
Initializing ../lsp/module.o
loading ../lsp/autoload.lsp

>#<"COMPILER" package>

COMPILER>#<"SYSTEM" package>

SYSTEM>*COMMAND-ARGS*

SYSTEM>#<"USER" package>

>#<"LISP" package>

LISP>#<"SLOOP" package>

SLOOP>6

SLOOP>#<"USER" package>

>Initializing ../lsp/predlib.o

Error: Someone tried to RETURN-FROM a TAGBODY.
Error signalled by TAGBODY.
Broken at BREAK-LEVEL.  Type :H for Help.
SYSTEM>>Bye.

Thanks,

hxl

From hxl@epic.com  Tue Jan  3 19:57:48 1995
Return-Path: <hxl@epic.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA07854; Tue, 3 Jan 95 19:57:48 CST
Received: from epic.com (gate.epic.com) by cli.com (4.1/SMI-4.1)
	id AA03920; Tue, 3 Jan 95 19:06:18 CST
Received: from weber.epic (weber.epic.com) by epic.com (4.1/JMA.3)
	id AA21399; Tue, 3 Jan 95 17:13:27 PST
Received: by weber.epic (4.1/SMI-4.1)
	id AA13509; Tue, 3 Jan 95 17:07:17 PST
Date: Tue, 3 Jan 95 17:07:17 PST
From: hxl@epic.com (Charlie Xiaoli Huang)
Message-Id: <9501040107.AA13509@weber.epic>
To: gcl@cli.com
Subject: FFI questions 
Reply-To: hxl@epic.com

Hello,

I'm trying to do some work with the FFI provided by gcl. I read the
kcl report and the defCfun/defentry/clines stuff are farily
clear. But there're a few things that are done but are "officially
documented", which I'd like to seek some clarifications of, so that I
can be sure my code will continue to work when I upgrade the version
of my gcl:

First, when I look at some of the code in the lsp and misc directory,
I see access to things like (from misc/rusage.lsp):

	(clines "static mygetrusage(x,y) int x; object y;{return getrusage(x,y->str.str_self);}")

which accesses the internals of an object, and assumes it can be
implicitly used as a struct pointer. Is this supported and documented?
If not, what is the proper way to achieve the same or similar effect?

Second, the chapter on FFI in the kcl report includes things like:

	('nil a)
and
	((cons a b) c)

that can be embedded in a defCfun, but didn't explain the full syntax
and semantics of them. Anywhere else I can look them up? 

In general, what are the C functions (or lisp-ish helper functions
like the ones above) that one can use in defCfun to talk to the lisp
side? I see there're things like make_simple_string and
CMPmakefix_num. But would like to see a formal list and definitions if
possible. 

Please email response to hxl@epic.com.

Thanks,

hxl



From reading@io.litton.com  Wed Jan  4 17:42:27 1995
Return-Path: <reading@io.litton.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA08190; Wed, 4 Jan 95 17:42:27 CST
Received: from lcsdns1.litton.com by cli.com (4.1/SMI-4.1)
	id AA07178; Wed, 4 Jan 95 16:47:05 CST
Received: from io.dsd.litton.com by lcsdns1.litton.com (4.1/SMI-4.1)
	id AA01076; Wed, 4 Jan 95 14:44:23 PST
Received: by io.dsd.litton.com (Concentrix-2800 3.0/SMI-4.1)
	id AA05683; Wed, 4 Jan 95 14:47:17 PST
Date: Wed, 4 Jan 95 14:47:17 PST
From: John D. Reading <reading@io.dsd.litton.com>
Message-Id: <9501042247.AA05683@io.dsd.litton.com>
To: gcl@cli.com
Subject: Problems building PCL

Sorry to bother you all, but I am not sure where else to ask.  I have
downloaded pcl-gcl-1.0 and tried to build it (I also have gcc version
2.6.3 and gcl version 1.1), and things proceeded fine right up until
it core dumped.  The last few lines of output follow:

Compiling VECTOR...
Compiling vector.lisp.
End of Pass 1.  
;; Note: Tail-recursive call of SYMBOL-OR-CONS-LESSP was replaced by iteration.
;; Note: Tail-recursive call of SYMBOL-OR-CONS-LESSP was replaced by iteration.
End of Pass 2.  
OPTIMIZE levels: Safety=0 (No runtime error checking), Space=0, Speed=3
Finished compiling vector.o.
Loading binary of VECTOR...
Compiling SLOTS-BOOT...
Compiling slots-boot.lisp.
; (DEFMACRO ACCESSOR-SLOT-BOUNDP ...) is being compiled.
;; Warning: The variable SYM is not used.
Segmentation Fault - core dumped
*** Error code 139
make: Fatal error: Command failed for target `compile' (on host callisto)


I really don't have the faintest idea of what to do.  Can anybody give
me any help?

Thanks,

John

--
John D. Reading           | Where there is no solution, there is no problem.
reading@io.dsd.litton.com | -- John G. Price III
(818) 597-5152            | 

From horrocks@cs.man.ac.uk  Fri Jan 13 15:11:59 1995
Return-Path: <horrocks@cs.man.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA09998; Fri, 13 Jan 95 15:11:59 CST
Received: from m1.cs.man.ac.uk by cli.com (4.1/SMI-4.1)
	id AA28740; Fri, 13 Jan 95 13:55:58 CST
Received: from r9.cs.man.ac.uk by m1.cs.man.ac.uk (4.1/SMI-4.1:AL5l)
	id AA21218; Fri, 13 Jan 95 00:55:33 GMT
From: Ian Horrocks <horrocks@cs.man.ac.uk>
Message-Id: <9501130055.AA06816@r9.cs.man.ac.uk>
Subject: macroexpand/evaluate
To: gcl@cli.com
Date: Fri, 13 Jan 1995 00:55:31 +0000 (GMT)
X-Mailer: ELM [version 2.4 PL23]
Content-Type: text
Content-Length: 361       

I am having problems with the GCL compiler due to the way it evaluates
macro expansions at compile time. I read in the documentation that this
behavior can be altered using one of the system flags but it didn't say
which one - can anyone assist?

Talking of documentation is fuller documentation available from any source?

Ian Horrocks
horrocks@cs.man.ac.uk



From hxl@epic.com  Tue Jan 17 19:28:41 1995
Return-Path: <hxl@epic.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA10673; Tue, 17 Jan 95 19:28:41 CST
Received: from epic.com (gate.epic.com) by cli.com (4.1/SMI-4.1)
	id AA03839; Tue, 17 Jan 95 18:03:24 CST
Received: from weber.epic (weber.epic.com) by epic.com (4.1/JMA.3)
	id AA20565; Tue, 17 Jan 95 16:10:47 PST
Received: by weber.epic (4.1/SMI-4.1)
	id AA09898; Tue, 17 Jan 95 16:04:26 PST
Date: Tue, 17 Jan 95 16:04:26 PST
From: hxl@epic.com (Charlie Xiaoli Huang)
Message-Id: <9501180004.AA09898@weber.epic>
To: gcl@cli.com, wfs@math.utexas.edu
Subject: gcl: is there a better way to do this?
Reply-To: hxl@epic.com

I need to interface an application with GCL. One of the API's provided
by the application is something like

	int foo(int argc, char **argv)  

(the API was originally written with TCL in mind...)

How do I accomplish an FFI in GCL with such an interface? 

This is what I'm doing now, but I'd like a more elegant solution:

-----

(clines "static int argc; char *argv[512];"
	"static void reset_args() { argc = 0;}"
	"static int give_me_argv() { return (int)argv;}"
	"static int give_me_argc() { return argc;}"
	"static void add_args(s) char *s; "
	"  { argv[argc++] = s; argv[argc] = 0;}")
(defentry reset-args () (void "reset_args"))
(defentry add-args (string) (void "add_args"))
(defentry give-me-argv () (int "give_me_argv"))
(defentry give-me-argc () (int "give_me_argc"))

(defentry foo1 (int int) (int "foo"))

(defun foo (arg &rest others)
  (reset-args)
  (add-args arg)
  (dolist (x others)
	  (add-args x))
  (foo1 (give-me-argc) (give-me-argv)))

----

Thanks in advance,

hxl


From anders.vinjar@notam.uio.no  Sat Jan 21 13:19:06 1995
Return-Path: <anders.vinjar@notam.uio.no>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA11386; Sat, 21 Jan 95 13:19:06 CST
Received: from pat.uio.no by cli.com (4.1/SMI-4.1)
	id AA14214; Sat, 21 Jan 95 12:20:57 CST
Received: from ulrik.uio.no by pat.uio.no with local-SMTP (PP) 
          id <19220-0@pat.uio.no>; Sat, 21 Jan 1995 18:00:52 +0100
Received: by alban.notam.uio.no ; Sat, 21 Jan 95 17:59:28 +0100
Date: Sat, 21 Jan 95 17:59:28 +0100
From: anders.vinjar@notam.uio.no
Message-Id: <9501211659.AA02885@alban.notam.uio.no>
To: gcl@cli.com
Subject: SGI-Indy (IRIX 5.2) and GCL-1.1: What is "FASD"?

Hello.

I get som strange results while trying to build GCL-1.1 on the above
system.  Can anyone tell me what the following error message means?


            ....... (cut away)
            ../unixport/raw_gcl ../unixport/ < foo
    GCL (GNU Common Lisp)  April 1994  16384 pages
    loading ../lsp/export.lsp
    Initializing ../lsp/defmacro.o
    This file was dumped with FASD version ~a not ~a.         <------!!
    Lisp initialization failed.
            make command
            rm -f xbin/gcl ; echo "#!/bin/sh" > xbin/gcl; \
            echo "/hf/notam/u1/andersvi/lisp/gcl-1.1/unixport/saved_gcl -dir /hf/notam/u1/andersvi/lisp/gcl-1.1/unixport/ \$@ " \
            >> xbin/gcl
            chmod 755 xbin/gcl
            (cd  cmpnew ; make collectfn.o)
            ../unixport/saved_gcl ../unixport/ -compile collectfn
    ../unixport/saved_gcl: Not found
    *** Error code 1 (bu21)

    make: fatal error.
    *** Error code 1 (bu21)

    make: fatal error.
    my-prompt>  


To get any way on the Indy i had to change the following in "c/save_sgi.c":

     /* extern char *sbrk();       changed to the following line:*/ 
        extern void *sbrk(); 

I also had to change a definition of

        _iob() to
        __iob() (with two underscores)

in "c/save-sgi4.c".


Anders Vinjar


From cheimets@blynken.harvard.edu  Sun Jan 22 09:35:47 1995
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA11485; Sun, 22 Jan 95 09:35:47 CST
Received: from cfa.harvard.edu by cli.com (4.1/SMI-4.1)
	id AA15114; Sun, 22 Jan 95 08:39:56 CST
Return-Path: <cheimets@blynken.harvard.edu>
Received: by cfa.harvard.edu; Sun, 22 Jan 95 09:39:50 -0500
Received: by blynken.harvard.edu (931110.SGI/920502.SGI)
	for @cfa.harvard.edu:gcl@cli.com id AA02035; Sun, 22 Jan 95 09:40:25 -0500
Date: Sun, 22 Jan 95 09:40:25 -0500
From: cheimets@blynken.harvard.edu (Peter Cheimets)
Message-Id: <9501221440.AA02035@blynken.harvard.edu>
To: anders.vinjar@notam.uio.no
Cc: gcl@cli.com
In-Reply-To: anders.vinjar@notam.uio.no's message of Sat, 21 Jan 95 17:59:28 +0100 <9501211659.AA02885@alban.notam.uio.no>
Subject: SGI-Indy (IRIX 5.2) and GCL-1.1: What is "FASD"?

I had to make the exact same changes, and got the exact same results.  If you
get any further please let me know.

When I got a hold of Schelter this is the reply I got:

>The point is that the format of the .o files may well have changed.
>Try to determine if when you come to beginning of the read_fasd
>that you are indeed positioned at what was the end of the .o file.
>[put some printf("(%d)",ftell(fp));
>or some such in..]

I am not a C kinda guy, so I could do nothing with this.


Peter Cheimets
Smithsonian Astrophysical Observatory             ,__o-
Smithsonian Institution                         _-\_<,
60 Garden St.                                  (*)/'(*)-
Cambridge, MA 01238                   

cheimets@cfa.harvard.edu
(617)495-7384 X134 (voice)
(617)495-7098      (FAX)


From donhan@engin.umich.edu  Mon Jan 23 13:59:00 1995
Return-Path: <donhan@engin.umich.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA11704; Mon, 23 Jan 95 13:59:00 CST
Received: from maize.engin.umich.edu by cli.com (4.1/SMI-4.1)
	id AA16936; Mon, 23 Jan 95 12:53:44 CST
Received: (donhan@localhost) by maize.engin.umich.edu (8.6.8/8.6.4) id NAA08290; Mon, 23 Jan 1995 13:53:36 -0500
Date: Mon, 23 Jan 1995 13:53:36 -0500
From: Dongsuk Han <donhan@engin.umich.edu>
Message-Id: <199501231853.NAA08290@maize.engin.umich.edu>
To: anders.vinjar@notam.uio.no
Subject: Re: SGI-Indy (IRIX 5.2) and GCL-1.1: What is "FASD"?
Cc: gcl@cli.com

Hi,

I stopped building GCL-1.1 on IRIX 5.3 exactly at the same place.
Please let me know if you hear from anyone on the net.

ps) Are we getting enough attentions yet?

==================================================================
Dongsuk "Don" Han                        Phone:  (313) 764-2410
Transportation Research Institute        Fax:    (313) 936-1068
University of Michigan                   E-mail: donhan@umich.edu
2901 Baxter Road
Ann Arbor, MI 48109-2150

From pw@snoopy.mv.com  Mon Jan 23 15:58:50 1995
Return-Path: <pw@snoopy.mv.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA11728; Mon, 23 Jan 95 15:58:50 CST
Received: from snoopy.mv.com by cli.com (4.1/SMI-4.1)
	id AA17319; Mon, 23 Jan 95 14:40:02 CST
Received: (from pw@localhost) by snoopy.mv.com (8.6.9/8.6.6) id PAA12941; Mon, 23 Jan 1995 15:39:20 -0500
Date: Mon, 23 Jan 1995 15:39:20 -0500
From: "Paul F. Werkowski" <pw@snoopy.mv.com>
Message-Id: <199501232039.PAA12941@snoopy.mv.com>
To: donhan@engin.umich.edu
Cc: anders.vinjar@notam.uio.no, gcl@cli.com
In-Reply-To: <199501231853.NAA08290@maize.engin.umich.edu> (message from Dongsuk Han on Mon, 23 Jan 1995 13:53:36 -0500)
Subject: Re: SGI-Indy (IRIX 5.2) and GCL-1.1: What is "FASD"?

>>>>> "Dongsuk" == Dongsuk Han <donhan@engin.umich.edu> writes:

    Dongsuk> Hi, I stopped building GCL-1.1 on IRIX 5.3 exactly at the
    Dongsuk> same place.  Please let me know if you hear from anyone
    Dongsuk> on the net.

    Dongsuk> ps) Are we getting enough attentions yet?

	Some of us learned a lot more that we wanted to about the
	innards of unix and how they vary with different vendors
	implementations by wanting to run AKCL/GCL on some new box.
	At one time I also was faced with total ignorance of "FASD"
	and had to do a lot of debugging in totally foreign territory
	at a time when I just wanted to deal in Lisp. If I had an
	INDY box and wanted to run GCL I would have several options,

	a) Appeal to Internet readers to see if someone had already
	blazed that trail. (You've sort of done that already)

	b) Try and debug the problem myself - and send any changes to
	the maintainer for inclusion in the next version.

	c) Wait for the next release and hope someone did one of the above.

	d) Buy a commercial Lisp implementation.

	e) Buy hardware and an OS that is known to be compatible with GCL.

	"Anything for free has no guarantee"

	Paul


From donhan@engin.umich.edu  Mon Jan 23 17:33:56 1995
Return-Path: <donhan@engin.umich.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA11774; Mon, 23 Jan 95 17:33:56 CST
Received: from maize.engin.umich.edu by cli.com (4.1/SMI-4.1)
	id AA17641; Mon, 23 Jan 95 16:19:53 CST
Received: (donhan@localhost) by maize.engin.umich.edu (8.6.8/8.6.4) id RAA12223; Mon, 23 Jan 1995 17:19:32 -0500
Date: Mon, 23 Jan 1995 17:19:32 -0500
From: Dongsuk Han <donhan@engin.umich.edu>
Message-Id: <199501232219.RAA12223@maize.engin.umich.edu>
To: pw@snoopy.mv.com
Subject: Re: SGI-Indy (IRIX 5.2) and GCL-1.1: What is "FASD"?
Cc: anders.vinjar@notam.uio.no, gcl@cli.com

>>	Some of us learned a lot more that we wanted to about the
>>	innards of unix and how they vary with different vendors
>>	implementations by wanting to run AKCL/GCL on some new box.
>>	At one time I also was faced with total ignorance of "FASD"
>>	and had to do a lot of debugging in totally foreign territory
>>	at a time when I just wanted to deal in Lisp. If I had an
>>	INDY box and wanted to run GCL I would have several options,
>> 
>>	a) Appeal to Internet readers to see if someone had already
>>	   blazed that trail. (You've sort of done that already)

I sent a message to gcl mailing group 
 - to see if anyone had gone through this and solved the problem and
 - to let the maintainer know that not only one or two are interested
   in porting GCL on SGI machines.
I was succesful last time when I posted similar message about GCL 1.0 on IRIX
4.0.5. A few of kind netters helped me by sending me E-mails.

>>	b) Try and debug the problem myself - and send any changes to
>>	   the maintainer for inclusion in the next version.

I spent several hours until I hit the error shown on anders.vinjar's
message. I admit that I have not gone into a real "debugging" yet
but I am pretty sure that I've reached the limit of my (LISP + C) knowledge.
I spent more than a week debugging version 1.0 on IRIX 4.0.5 without
any clue on how things are working.

I haven't checked if version 1.1 include the fixes for IRIX 4.0.5 yet.
If not, I will send the patches to the maintainer.

>>	c) Wait for the next release and hope someone did one of the above.

To make the hope bigger, I am telling the people who know more than I do 
about GCL (and who love GCL more than I do) that GCL is not easy to
port on SGI machines. I've seen many messages like mine from the archive of 
this mailing list but porting AKCL/KCL/GCL on SGI has not been very successful 
for a long time.

>>	d) Buy a commercial Lisp implementation.

Do you have any suggestion?

>>	e) Buy hardware and an OS that is known to be compatible with GCL.

I compiled AKCL/GCL on Solaris, SUN OS, HP UX and IRIX 4.0.5. Now I have a
reason to make GCL working on SGI. If I remember correctly, SGI is in the 
machine list that GCL is "supposed" to run on. I am not asking a question of 
porting GCL on Apollo DN3XX.

>>	"Anything for free has no guarantee"

Thank you for your tips, and I am sorry if I bothered you with message that
you did not want to read. 


>>		Paul

-- Don --

PS) I am truely sorry for sending rather personal message to this group.
    I just wish Paul did not CC to the whole group :(

From pw@snoopy.mv.com  Mon Jan 23 17:54:12 1995
Return-Path: <pw@snoopy.mv.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA11779; Mon, 23 Jan 95 17:54:12 CST
Received: from snoopy.mv.com by cli.com (4.1/SMI-4.1)
	id AA17705; Mon, 23 Jan 95 16:44:39 CST
Received: (from pw@localhost) by snoopy.mv.com (8.6.9/8.6.6) id RAA16274; Mon, 23 Jan 1995 17:44:16 -0500
Date: Mon, 23 Jan 1995 17:44:16 -0500
From: "Paul F. Werkowski" <pw@snoopy.mv.com>
Message-Id: <199501232244.RAA16274@snoopy.mv.com>
To: gcl@cli.com
In-Reply-To: <199501232219.RAA12223@maize.engin.umich.edu> (message from Dongsuk Han on Mon, 23 Jan 1995 17:19:32 -0500)
Subject: Re: SGI-Indy (IRIX 5.2) and GCL-1.1: What is "FASD"?

>>>>> "Dongsuk" == Dongsuk Han <donhan@engin.umich.edu> writes:


    Dongsuk> I spent several hours until I hit the error shown on
    Dongsuk> anders.vinjar's message. I admit that I have not gone
    Dongsuk> into a real "debugging" yet but I am pretty sure that
    Dongsuk> I've reached the limit of my (LISP + C) knowledge.  I
    Dongsuk> spent more than a week debugging version 1.0 on IRIX
    Dongsuk> 4.0.5 without any clue on how things are working.

	A week or two, or maybe a month of Sundays is about right
	for this one.

    >>> d) Buy a commercial Lisp implementation.

    Dongsuk> Do you have any suggestion?

	Nope, since my personal budget prohibits it and my employer
	can't afford it, I find GCL to be superb! I just have to be
	prepared for new debugging challenges when OS things change.
	I use FreeBSD (freebieSD). The price is right and the value
	per buck is infinitely high.

    >>> e) Buy hardware and an OS that is known to be compatible with
    >>> GCL.

    >>> "Anything for free has no guarantee"

    Dongsuk> Thank you for your tips, and I am sorry if I bothered you
    Dongsuk> with message that you did not want to read.

	Not bothered at all, and I apologize if I offended. I was
	responding to the apparent complaint of not enough attention.

    Dongsuk> PS) I am truely sorry for sending rather personal message
    Dongsuk> to this group.  I just wish Paul did not CC to the whole
    Dongsuk> group :(

	Again, sorry to offend.

	Paul

From attardi@DI.UniPi.IT  Tue Jan 24 05:34:05 1995
Return-Path: <attardi@DI.UniPi.IT>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA11854; Tue, 24 Jan 95 05:34:05 CST
Received: from apollo.di.unipi.it by cli.com (4.1/SMI-4.1)
	id AA18762; Tue, 24 Jan 95 04:15:10 CST
Received: from omega.di.unipi.it by apollo.di.unipi.it with SMTP
	(1.37.109.4/16.2) id AA07563; Tue, 24 Jan 95 11:09:23 +0100
Organization: Dipartimento di Informatica - Universita' di Pisa - Italy
Received: by omega (5.0/SMI-4.1)
	id AA00620; Tue, 24 Jan 1995 11:09:06 --100
Date: Tue, 24 Jan 1995 11:09:06 --100
From: attardi@DI.UniPi.IT
Message-Id: <9501241009.AA00620@omega>
To: donhan@engin.umich.edu
Cc: pw@snoopy.mv.com, anders.vinjar@notam.uio.no, gcl@cli.com
In-Reply-To: <199501232219.RAA12223@maize.engin.umich.edu> (message from Dongsuk Han on Mon, 23 Jan 1995 17:19:32 -0500)
Subject: Re: SGI-Indy (IRIX 5.2) and GCL-1.1: What is "FASD"?
Content-Length: 487


I am making available ECoLisp version 0.17, which runs on SGI with IRIX 4.0.5H,
for anonymous ftp from:

 - ftp.icsi.berkeley.edu [128.32.201.7], directory /pub/ai/ecl
 - ftp.di.unipi.it [131.114.4.36], directory /pub/lang/lisp

ECoLisp is a derivative of KCL which incorporates many of the changes
in AKCL.

To install it, after unpacking it, just run:

	configure

This will create a directory sgi, then

	cd sgi
	make

To see configuration options, issue configure --help.

-- Beppe

From anders.vinjar@notam.uio.no  Tue Jan 24 11:17:32 1995
Return-Path: <anders.vinjar@notam.uio.no>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA11893; Tue, 24 Jan 95 11:17:32 CST
Received: from pat.uio.no ([129.240.2.50]) by cli.com (4.1/SMI-4.1)
	id AA19095; Tue, 24 Jan 95 08:51:28 CST
Received: from ulrik.uio.no by pat.uio.no with local-SMTP (PP) 
          id <03078-0@pat.uio.no>; Tue, 24 Jan 1995 15:42:59 +0100
Received: by alban.notam.uio.no ; Tue, 24 Jan 95 15:41:26 +0100
Date: Tue, 24 Jan 95 15:41:26 +0100
From: anders.vinjar@notam.uio.no
Message-Id: <9501241441.AA15734@alban.notam.uio.no>
To: cheimets@blynken.harvard.edu
Cc: anders.vinjar@notam.uio.no, gcl@cli.com
In-Reply-To: <9501221440.AA02035@blynken.harvard.edu> (cheimets@blynken.harvard.edu)
Subject: Re: SGI-Indy (IRIX 5.2) and GCL-1.1: What is "FASD"?

   I had to make the exact same changes, and got the exact same results.  If you
   get any further please let me know.

I will.  Thanks for a decent reply.

-anders


From eblood@winky.reno.nv.us  Wed Jan 25 00:44:05 1995
Return-Path: <eblood@winky.reno.nv.us>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA11993; Wed, 25 Jan 95 00:44:05 CST
Received: from heather.greatbasin.com by cli.com (4.1/SMI-4.1)
	id AA21767; Tue, 24 Jan 95 23:48:28 CST
Received: from winky.reno.nv.us (winky.reno.nv.us [140.174.194.250]) by heather.greatbasin.com (8.6.9/8.6.5) with SMTP id VAA09583; Tue, 24 Jan 1995 21:32:05 -0800
Message-Id: <199501250532.VAA09583@heather.greatbasin.com>
X-Authentication-Warning: heather.greatbasin.com: Host winky.reno.nv.us didn't use HELO protocol
To: gcl@cli.com
Cc: eblood@winky.reno.nv.us
Subject: Porting to FreeBSD 2.0
Date: Mon, 23 Jan 1995 14:07:41 -0800
From: Eric Blood <eblood@winky.reno.nv.us>


I'm getting an unreferenced symbol when compiling for 386-bsd target.
It's looking for _sigstack.  I tracked down the module to main.o, and
then checked main.c.  I'm not quite sure what the sigstack code is
supposed to be doing.  The documentation on my side says that sigstack
has been changed to sigaltstack.  So, I tried to hack (hack being the
keyword) sigstack into a sigaltstack.  It compiles a little bit farther
but fails with:

Script started on Mon Jan 23 14:04:52 1995
$ make
(cd bin; make all)
(cd mp ; make all)
make all1 "MPFILES=./mpi-386.o   ./libmport.a"
rm -f o/cmpinclude.h ; ln h/cmpinclude.h o
(cd o; make all)
(cd lsp; make all)
(cd cmpnew; make all)
(cd unixport; make saved_gcl)
`saved_gcl' is up to date.
make command
rm -f xbin/gcl ; echo "#!/bin/sh" > xbin/gcl;  echo "/usr/users/eblood/gcl-1.1/unixport/saved_gcl -dir /usr/users/eblood/gcl-1.1/unixport/ \$@ "  >> xbin/gcl
chmod 755 xbin/gcl
(cd  cmpnew ; make collectfn.o)
../unixport/saved_gcl ../unixport/ -compile collectfn
P: not found
../unixport/saved_gcl: 10: Syntax error: ")" unexpected
*** Error code 2

Stop.
*** Error code 1

Stop.

Tell me what I should do next to help port.  Thanks.

EVB

From eblood@cs.unr.edu  Wed Jan 25 02:45:21 1995
Return-Path: <eblood@cs.unr.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12001; Wed, 25 Jan 95 02:45:21 CST
Received: from echo.cs.unr.edu by cli.com (4.1/SMI-4.1)
	id AA21954; Wed, 25 Jan 95 01:45:41 CST
Received: from localhost (localhost [127.0.0.1]) by echo.cs.unr.edu (8.6.9/8.6.9) with SMTP id WAA29270 for gcl@cli.com; Tue, 24 Jan 1995 22:54:52 -0800
From: Eric V Blood <eblood@cs.unr.edu>
Message-Id: <199501250654.WAA29270@echo.cs.unr.edu>
X-Authentication-Warning: echo.cs.unr.edu: Host localhost didn't use HELO protocol
To: gcl@cli.com
Subject: Porting to FreeBSD 2.0
Date: Tue, 24 Jan 95 22:54:46 -0800
X-Mts: smtp



I'm getting an unreferenced symbol when compiling for 386-bsd target.
It's looking for _sigstack.  I tracked down the module to main.o, and
then checked main.c.  I'm not quite sure what the sigstack code is
supposed to be doing.  The documentation on my side says that sigstack
has been changed to sigaltstack.  So, I tried to hack (hack being the
keyword) sigstack into a sigaltstack.  It compiles a little bit farther
but fails with:

Script started on Mon Jan 23 14:04:52 1995
$ make
(cd bin; make all)
(cd mp ; make all)
make all1 "MPFILES=./mpi-386.o   ./libmport.a"
rm -f o/cmpinclude.h ; ln h/cmpinclude.h o
(cd o; make all)
(cd lsp; make all)
(cd cmpnew; make all)
(cd unixport; make saved_gcl)
`saved_gcl' is up to date.
make command
rm -f xbin/gcl ; echo "#!/bin/sh" > xbin/gcl;  echo "/usr/users/eblood/gcl-1.1/unixport/saved_gcl -dir /usr/users/eblood/gcl-1.1/unixport/ \$@ "  >> xbin/gcl
chmod 755 xbin/gcl
(cd  cmpnew ; make collectfn.o)
../unixport/saved_gcl ../unixport/ -compile collectfn
P: not found
../unixport/saved_gcl: 10: Syntax error: ")" unexpected
*** Error code 2

Stop.
*** Error code 1

Stop.

Tell me what I should do next to help port.  Thanks.

EVB

Eric V. Blood
eblood@cs.unr.edu

From nils@guru.ims.uni-stuttgart.de  Wed Jan 25 09:12:13 1995
Return-Path: <nils@guru.ims.uni-stuttgart.de>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12047; Wed, 25 Jan 95 09:12:13 CST
Received: from guru.ims.uni-stuttgart.de by cli.com (4.1/SMI-4.1)
	id AA22424; Wed, 25 Jan 95 08:06:34 CST
Received: by guru.ims.uni-stuttgart.de (Smail3.1.28.1 #16)
	id m0rX8Q9-0003UwC; Wed, 25 Jan 95 15:10 MET
Message-Id: <m0rX8Q9-0003UwC@guru.ims.uni-stuttgart.de>
Date: Wed, 25 Jan 95 15:10 MET
From: nils@guru.ims.uni-stuttgart.de (Cornelis van der Laan)
To: eblood@cs.unr.edu, gcl@cli.com
Subject: Re: Porting to FreeBSD 2.0

You have successfully built a saved_kcl which isn't executable
(wrong header or so...).

Here is how to dump it correctly as a static demand paged image:

Use the appended h/386-bsd.h, get the unexec.c code from the latest
emacs distribution (I think since 19.24 the code works), install
it as c/unexfreebsd.c and recompile the whole stuff.

Note though, that under FreeBSD 1.1.5 the gcl-1.x dists don't work
for me, they crash with bus errors when using pcl and/or clx. 
akcl-1.624 works without problems, including the sgc code 
(ca. 25% faster garbage collection).

Feel free to contact me for more info and, if you succeed in building
on FreeBSD 2.0, would you please tell me how you did it? I'm still to 
upgrade but I'm waiting for the 2.1 cd...

Nils

h/386-bsd.h:
= = = = = = = = = = = = = = = = = = = = = = = =

#include "bsd.h"

#define ADDITIONAL_FEATURES \
		     ADD_FEATURE("386BSD");\
                     ADD_FEATURE("CLX-LITTLE-ENDIAN");

#define	I386			/* ?? this is apparently not used anywhere */
#define	IEEEFLOAT

#define HAVE_YP_UNBIND
#define HAVE_XDR		/* put xdr_float into libc first... */

#define USE_ATT_TIME

/* begin listen for input */
#undef LISTEN_FOR_INPUT		/* default in bsd.h is loser in 386bsd */
#if 1				/* Required for CLX to work correctly  */
#if defined IN_FILE
#include <unistd.h>
#include <sys/types.h>
#include <sys/time.h>
#include <stdio.h>
#endif
#define LISTEN_FOR_INPUT(fp) \
{\
  int fd = (fp)->_file;\
  static struct timeval tv = {0,0};\
  static fd_set rmask; FD_ZERO(&rmask); FD_SET(fd,&rmask);\
  select(fd+1,&rmask,NULL,NULL,&tv);\
  return (FD_ISSET(fd,&rmask));\
}
#endif
/* end listen for input */

/* we dont need to worry about zeroing fp->_base , to prevent  */
#define FCLOSE_SETBUF_OK 

#undef  LD_COMMAND
#define LD_COMMAND(command,main,start,input,ldarg,output) \
  sprintf(command, "ld -N -x -A %s -T %x %s %s -o %s", \
            main,start,input,ldarg,output)

#define DATA_BEGIN (char *)N_DATADDR(header)
#define A_TEXT_OFFSET(x) (sizeof (struct exec))
#define A_TEXT_SEEK(hdr) (N_TXTOFF(hdr) + A_TEXT_OFFSET(hdr))
#define TEXT_START 0
#define DATA_START 0
#define UNIXSAVE "unexfreebsd.c"	/* from emacs distribution */

#define RELOC_FILE "rel_sun3.c"	/* for SFASL - enabled in bsd.h */

#define LITTLE_ENDIAN		/* also in <machine/endian.h> */

#define HZ		100	/* in FreeBSD 1.1.5 - check for 2.0 */

/* this for GC */
/* #define PAGEWIDTH 12		/* i386 sees 4096 byte pages */
/* try out the gnu malloc */
#define GNU_MALLOC		/* works if PAGEWIDTH==11 */
#define GNUMALLOC

#define INSTALL_SEGMENTATION_CATCHER \
  	 (void) signal(SIGSEGV,segmentation_catcher); \
  	 (void) signal(SIGBUS,segmentation_catcher)

/* Begin for cmpinclude */
/* yes we have alloca */
#define HAVE_ALLOCA

#define WANT_SGC

#ifdef WANT_SGC			/* begin defines for SGC */
/*
  SGC is a performance winner for large applications as it doesn't
  run the entire image through the pager during collection. SGC requires
  the 'mprotect' function.

  Need Jeffrey Hsu's kernel patch for signal handlers.  Should be in
FreeBSD versions later than 1.0.2.

  Also need to add
#include <sys/types.h> before
#include <sys/mman.h> in c/sgc.c

  Also - the above handler conflicts with use of '(un)catch-bad-signals'
  You may want to modify unixint.c to account for SGC use.

*/
#define SGC
#define SIGPROTV SIGBUS
#endif				/* end of SGC mods */

/* _setjmp and _longjmp exist on bsd and are more efficient
   and handle the C stack which is all we need. [I think!]
*/
#define setjmp _setjmp
#define longjmp _longjmp

= = = = = = = = = = = = = = = = = = = = = = = =

From pw@snoopy.mv.com  Wed Jan 25 15:52:26 1995
Return-Path: <pw@snoopy.mv.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12131; Wed, 25 Jan 95 15:52:26 CST
Received: from snoopy.mv.com by cli.com (4.1/SMI-4.1)
	id AA23863; Wed, 25 Jan 95 14:45:21 CST
Received: (from pw@localhost) by snoopy.mv.com (8.6.9/8.6.6) id PAA00499; Wed, 25 Jan 1995 15:44:58 -0500
Date: Wed, 25 Jan 1995 15:44:58 -0500
From: "Paul F. Werkowski" <pw@snoopy.mv.com>
Message-Id: <199501252044.PAA00499@snoopy.mv.com>
To: gcl@cli.com
In-Reply-To: <199501250654.WAA29270@echo.cs.unr.edu> (message from Eric V Blood on Tue, 24 Jan 95 22:54:46 -0800)
Subject: Re: Porting to FreeBSD 2.0

Here is the FreeBSD.h/ that work for me. You also need unexfreebsd.c
from the emacs kit.
----------- FreeBSD.h -----------
/*
 * FreeBSD.h for akcl-1-624 akcl-1-625 ...
 *
 * Hacked Jan/94 by Werkowski (pw@snoopy.mv.com)for FreeBSD 2.0R
 *
 */

#include "bsd.h"

#undef LD_COMMAND
#define LD_COMMAND(command,main,start,input,ldarg,output) \
  sprintf(command, "ld -dc -Bstatic -N -x -A %s -T %x %s %s -o %s", \
            main,start,input,ldarg,output)

#define ADDITIONAL_FEATURES \
		     ADD_FEATURE("386BSD");\
                     ADD_FEATURE("FreeBSD");\
                     ADD_FEATURE("CLX-LITTLE-ENDIAN");
#define	IEEEFLOAT
#undef HAVE_XDR
#define USE_ATT_TIME

/* begin listen for input */
#undef LISTEN_FOR_INPUT		/* default in bsd.h is loser in 386bsd */
#if 1				/* Required for CLX to work correctly  */
#if defined IN_FILE
#include <unistd.h>
#include <sys/types.h>
#include <sys/time.h>
#include <stdio.h>
#endif
#define LISTEN_FOR_INPUT(fp) \
{\
  int fd = (fp)->_file;\
  static struct timeval tv = {0,0};\
  static fd_set rmask; FD_ZERO(&rmask); FD_SET(fd,&rmask);\
  select(fd+1,&rmask,NULL,NULL,&tv);\
  return (FD_ISSET(fd,&rmask));\
}
#endif
/* end listen for input */

#ifdef IN_GBC
#include <sys/types.h>
#endif

/* we dont need to worry about zeroing fp->_base , to prevent  */
#define FCLOSE_SETBUF_OK 

#define DATA_BEGIN (char *)N_DATADDR(header);
/*
 * need to ensure following is appended to any imported unex? file
 *#ifdef UNIXSAVE
 *#include "save.c"
 *#endif
*/
/* /pfw: this from freebsd 1.1 */
#define UNIXSAVE "unexfreebsd.c"

#define RELOC_FILE "rel_sun3.c"	/* for SFASL - enabled in bsd.h */


/* this for GC */

#define PAGEWIDTH 12		/* i386 sees 4096 byte pages */

#undef  HAVE_SIGVEC
#undef HAVE_SIGACTION

#define SETUP_SIG_STACK \
{ static struct sigaltstack estack ; \
  estack.ss_size = SIGSTKSZ ; \
  estack.ss_flags = 0; \
  if (sigaltstack(&estack, 0) < 0) \
               perror("sigaltstack");} \

#define INSTALL_SEGMENTATION_CATCHER \
  	 (void) signal(SIGSEGV,segmentation_catcher); \
  	 (void) signal(SIGBUS,segmentation_catcher)

#define WANT_SGC
#ifdef  WANT_SGC			/* begin defines for SGC */

#define SGC
#define SIGPROTV SIGBUS
#endif				/* end of SGC mods */


/* Begin for cmpinclude */
#ifndef __GNUC__
#define HAVE_ALLOCA
#include <alloca.h>
#endif
 /* If can mprotect pages and so selective gc will work */
#define SGC  

/* End for cmpinclude */

From pw@snoopy.mv.com  Wed Jan 25 17:34:59 1995
Return-Path: <pw@snoopy.mv.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12155; Wed, 25 Jan 95 17:34:59 CST
Received: from snoopy.mv.com by cli.com (4.1/SMI-4.1)
	id AA24329; Wed, 25 Jan 95 16:36:49 CST
Received: (from pw@localhost) by snoopy.mv.com (8.6.9/8.6.6) id RAA00379; Wed, 25 Jan 1995 17:36:26 -0500
Date: Wed, 25 Jan 1995 17:36:26 -0500
From: "Paul F. Werkowski" <pw@snoopy.mv.com>
Message-Id: <199501252236.RAA00379@snoopy.mv.com>
To: gcl@cli.com
Subject: Re: GCL on FreeBSD 2.0


There is one critical thing for the subject combo. The 'libc/vprintf.c'
code found in the 2.0 kit is broken such that GCL will not properly
compile certain files such as found in PCL. Vprintf.c has  been fixed
in the FreeBSD-current distribution and you should pull the new version
from FreeBSD.cdrom.com:/pub/FreeBSD/src/lib/libc/stdio/vfprintf.c.

If you need this file and can't get it, please contact me directly and I
will send you a patch.

Paul

From starnet!bass!lakin@apple.com  Wed Jan 25 18:03:55 1995
Return-Path: <starnet!bass!lakin@apple.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12160; Wed, 25 Jan 95 18:03:55 CST
Received: from apple.com by cli.com (4.1/SMI-4.1)
	id AA24471; Wed, 25 Jan 95 17:14:07 CST
Received: by apple.com (5.61/8-Oct-1993-eef)
	id AA16265; Wed, 25 Jan 95 14:50:04 -0800
Received: from bass by StarConn.com with uucp
	(Smail3.1.28.1 #1) id m0rXF1O-00024QC; Wed, 25 Jan 95 13:12 PST
Received: by pgc.com (4.1/SMI-4.1)
	id AA03227; Wed, 25 Jan 95 13:21:00 PST
Date: Wed, 25 Jan 95 13:21:00 PST
From: starnet!bass!lakin@apple.com (Fred Lakin)
Message-Id: <9501252121.AA03227@pgc.com>
To: gcl@cli.com
Subject: speed of CLX under GCL
Reply-To: lakin@pgc.com

About 4 years ago I was using AKCL and CLX for a large graphics
program. The time required to draw stuff on the screen [text and
lines, not pixmaps] was quite slow. A friend convinced me to do a
test with one of the commerical lisps, and without change to the
code I saw a speedup of 10X to 20X.

Now I would like to try GCL/AKCL again. Has CLX speed been
improved?  [I believe some of the slowdown was attributed to
ACKL's boxing of small integers, but I could be wrong].

I also note in the GNU mailing of June 94 that "There is an Xlib
interface via C." Is this different than just using the foreign
function interface to C code which uses the Xlib? I do like the
convenience of CLX but not the peformance penalties.

Thanks in advance to anyone with experience or opinions.

regards,
-f

Fred Lakin  ::  lakin@pgc.com  ::  (415) 424-1086
The Performing Graphics Company  ::  512 Military Way, Palo Alto, CA 94306  USA
http://www.internex.net/pgc/webdog.html


From attardi@DI.UniPi.IT  Thu Jan 26 03:37:33 1995
Return-Path: <attardi@DI.UniPi.IT>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12199; Thu, 26 Jan 95 03:37:33 CST
Received: from apollo.di.unipi.it by cli.com (4.1/SMI-4.1)
	id AA25576; Thu, 26 Jan 95 02:25:50 CST
Received: from omega.di.unipi.it by apollo.di.unipi.it with SMTP
	(1.37.109.4/16.2) id AA02062; Thu, 26 Jan 95 09:23:24 +0100
Organization: Dipartimento di Informatica - Universita' di Pisa - Italy
Received: by omega (5.0/SMI-4.1)
	id AA03208; Thu, 26 Jan 1995 09:23:20 --100
Date: Thu, 26 Jan 1995 09:23:20 --100
From: attardi@DI.UniPi.IT
Message-Id: <9501260823.AA03208@omega>
To: lakin@pgc.com
Cc: gcl@cli.com
In-Reply-To: <9501252121.AA03227@pgc.com> (starnet!bass!lakin@apple.com)
Subject: Re: speed of CLX under GCL
Content-Length: 415


I have built a version of CLX which runs over 20X faster than in AKCL.
To do this I had to create a new C interface mechanism (definline), and
to make several changes to the original CLX code.

All of this is part of my own variant of KCL, called ECoLisp, which you can
ftp from:

 - ftp.icsi.berkeley.edu [128.32.201.7], directory /pub/ai/ecl
 - ftp.di.unipi.it [131.114.4.36], directory /pub/lang/lisp

-- Beppe

From siochil@csgrad.cs.vt.edu  Thu Jan 26 11:29:56 1995
Return-Path: <siochil@csgrad.cs.vt.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12249; Thu, 26 Jan 95 11:29:56 CST
Received: from csgrad.cs.vt.edu by cli.com (4.1/SMI-4.1)
	id AA26423; Thu, 26 Jan 95 10:21:07 CST
Received: by csgrad.cs.vt.edu; (5.65/1.1.8.2/19Sep94-1023AM)
	id AA12989; Thu, 26 Jan 1995 11:21:01 -0500
Message-Id: <9501261621.AA12989@csgrad.cs.vt.edu>
Subject: UNSUBSCRIBE
To: gcl@cli.com
Date: Thu, 26 Jan 1995 11:21:00 -0500 (EST)
From: "Lucia Siochi" <siochil@csgrad.cs.vt.edu>
X-Mailer: ELM [version 2.4 PL23]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Content-Length: 16        

UNSUBSCRIBE GCL

From rpeters2@d.umn.edu  Thu Jan 26 11:35:06 1995
Return-Path: <rpeters2@d.umn.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12255; Thu, 26 Jan 95 11:35:06 CST
Received: from ub.d.umn.edu by cli.com (4.1/SMI-4.1)
	id AA26278; Thu, 26 Jan 95 09:50:12 CST
Received: (from rpeters2@localhost) by ub.d.umn.edu (8.6.9/8.6.9) id JAA15321 for gcl@cli.com; Thu, 26 Jan 1995 09:50:04 -0600
From: "Randy J. Peterson" <rpeters2@d.umn.edu>
Message-Id: <199501261550.JAA15321@ub.d.umn.edu>
Subject: UNSUBSCRIBE
To: gcl@cli.com
Date: Thu, 26 Jan 1995 09:50:03 -0600 (CST)
X-Mailer: ELM [version 2.4 PL22]
Content-Type: text
Content-Length: 16        

UNSUBSCRIBE GCL

From harmon@xn.ll.mit.edu  Thu Jan 26 14:13:12 1995
Return-Path: <harmon@xn.ll.mit.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12270; Thu, 26 Jan 95 14:13:12 CST
Received: from xn.ll.mit.edu by cli.com (4.1/SMI-4.1)
	id AA26907; Thu, 26 Jan 95 12:59:20 CST
Received: from saturn.mi.ll.mit.edu by xn.ll.mit.edu id AA01803g; Thu, 26 Jan 95 14:00:40 EST
Received: by saturn.mi.ll.mit.edu; Thu, 26 Jan 95 13:57:34 EST
Date: Thu, 26 Jan 95 13:57:34 EST
From: harmon@xn.ll.mit.edu
Message-Id: <9501261857.AA06133@saturn.mi.ll.mit.edu>
To: gcl@cli.com
Subject: please unsubscribe me


UNSUBSCRIBE GCL

From @festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk  Fri Jan 27 19:59:28 1995
Return-Path: <@festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12653; Fri, 27 Jan 95 19:59:28 CST
Received: from sun2.nsfnet-relay.ac.uk by cli.com (4.1/SMI-4.1)
	id AA01577; Fri, 27 Jan 95 19:04:55 CST
Via: uk.ac.edinburgh.festival; Sat, 28 Jan 1995 01:04:51 +0000
Received: from skye-alter.aiai.ed.ac.uk by festival.ed.ac.uk id aa03958;
          28 Jan 95 1:04 GMT
Received: from subnode.aiai.ed.ac.uk (bute) by aiai.ed.ac.uk;
          Sat, 28 Jan 95 01:04:16 GMT
Date: Sat, 28 Jan 95 01:04:14 GMT
Message-Id: <6578.9501280104@subnode.aiai.ed.ac.uk>
From: Jeff Dalton <jeff@aiai.edinburgh.ac.uk>
Subject: compiler bug w/ catch & throw
To: gcl@cli.com

There seems to be a bug, and it looks like it's been around for
a long time.  The simplest example I've come up with so far is

(defun f () (catch 'a (funcall #'(lambda () (throw 'a 10)))))

(f) should return 10.

Below are two transcripts, one using AKCL 1.615 and the other using
GCL 1.1.  In each case, I show that F works fine interpreted.  But
when a compiled F is called, there's an error: The tag A is undefined.

Similar problems occur when using block and return-from instead
of catch and throw, although this particular F works in GCL 1.1
if rewritten to use block and return-from.

----------------------------------------------------------------------
spottisvax$ akcl
AKCL (Austin Kyoto Common Lisp)  Version(1.615) Sun Oct 10 18:04:32
BST 1993
Contains Enhancements by W. Schelter

>(defun f () (catch 'a (funcall #'(lambda () (throw 'a 10)))))
F

>(f)
10

>(compile 'f)
Compiling gazonk0.lsp.
End of Pass 1.  
End of Pass 2.  
OPTIMIZE levels: Safety=0 (No runtime error checking), Space=0,
Speed=3
Finished compiling gazonk0.lsp.
Loading gazonk0.o
start address -T 1d8e18 Finished loading gazonk0.o
#<compiled-function F>

>(f)

Error: The tag A is undefined.
Fast links are on: do (use-fast-links nil) for debugging
Error signalled by F.
Broken at F.  Type :H for Help.
>>Bye.                          
----------------------------------------------------------------------
spottisvax$ gcl
GCL (GNU Common Lisp)  Version(1.1) Mon Nov 14 00:41:18 GMT 1994
Licensed under GNU Public Library License
Contains Enhancements by W. Schelter

>(defun f () (catch 'a (funcall #'(lambda () (throw 'a 10)))))
F

>(f)
10

>(compile 'f)
Compiling gazonk0.lsp.
End of Pass 1.  
End of Pass 2.  
OPTIMIZE levels: Safety=0 (No runtime error checking), Space=0,
Speed=3
Finished compiling gazonk0.lsp.
Loading gazonk0.o
start address -T 21e234 Finished loading gazonk0.o
#<compiled-function F>

>(f)

Error: The tag A is undefined.
Fast links are on: do (use-fast-links nil) for debugging
Error signalled by F.
Broken at F.  Type :H for Help.
>>Bye.
spottisvax$ 
----------------------------------------------------------------------

-- jeff

From yuasa@katura.tutics.tut.ac.jp  Sat Jan 28 22:25:31 1995
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12765; Sat, 28 Jan 95 22:25:31 CST
Received: from higw.tut.ac.jp by cli.com (4.1/SMI-4.1)
	id AA02863; Sat, 28 Jan 95 21:17:21 CST
Received: from tutuser.tut.ac.jp by higw.tut.ac.jp (5.65+1.6W/6.4J.6)
	id AA03467; Sun, 29 Jan 95 12:20:26 JST
Received: from katura.tutics.tut.ac.jp by tutuser.tut.ac.jp (5.65+1.6W/6.4J.6)
	id AA10869; Sun, 29 Jan 95 12:10:43 +0900
Received: by katura.tutics.tut.ac.jp (5.65+1.6W/6.4JAIN-1.0)
	id AA03278; Sun, 29 Jan 95 12:14:04 JST
Date: Sun, 29 Jan 95 12:14:04 JST
From: yuasa@katura.tutics.tut.ac.jp (Taiichi Yuasa)
Return-Path: <yuasa@katura.tutics.tut.ac.jp>
Message-Id: <9501290314.AA03278@katura.tutics.tut.ac.jp>
To: jeff@aiai.edinburgh.ac.uk
Subject: RE: compiler bug w/ catch & throw
Cc: gcl@cli.com

>> There seems to be a bug, and it looks like it's been around for
>> a long time.  The simplest example I've come up with so far is
>> 
>> (defun f () (catch 'a (funcall #'(lambda () (throw 'a 10)))))
>> 
>> (f) should return 10.

In the original KCL, both interpreted and compiled f return 10.

-- Taiichi

From @festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk  Sun Jan 29 12:21:37 1995
Return-Path: <@festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12828; Sun, 29 Jan 95 12:21:37 CST
Received: from sun2.nsfnet-relay.ac.uk by cli.com (4.1/SMI-4.1)
	id AA03486; Sun, 29 Jan 95 11:32:32 CST
Via: uk.ac.edinburgh.festival; Sun, 29 Jan 1995 17:31:13 +0000
Received: from skye-alter.aiai.ed.ac.uk by festival.ed.ac.uk id aa16733;
          29 Jan 95 17:31 GMT
Received: from subnode.aiai.ed.ac.uk (bute) by aiai.ed.ac.uk;
          Sun, 29 Jan 95 17:30:48 GMT
Date: Sun, 29 Jan 95 17:30:48 GMT
Message-Id: <7152.9501291730@subnode.aiai.ed.ac.uk>
From: Jeff Dalton <jeff@aiai.edinburgh.ac.uk>
Subject: RE: compiler bug w/ catch & throw
To: Taiichi Yuasa <yuasa@katura.tutics.tut.ac.jp>
In-Reply-To: Taiichi Yuasa's message of Sun, 29 Jan 95 12:14:04 JST
Cc: gcl@cli.com

> >> There seems to be a bug, and it looks like it's been around for
> >> a long time.  The simplest example I've come up with so far is
> >> 
> >> (defun f () (catch 'a (funcall #'(lambda () (throw 'a 10)))))
> >> 
> >> (f) should return 10.
> 
> In the original KCL, both interpreted and compiled f return 10.

I've just checked in AKCL 1.505, and it it works there too.

-- jeff

From nils@guru.ims.uni-stuttgart.de  Sun Jan 29 13:06:22 1995
Return-Path: <nils@guru.ims.uni-stuttgart.de>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12833; Sun, 29 Jan 95 13:06:22 CST
Received: from guru.ims.uni-stuttgart.de by cli.com (4.1/SMI-4.1)
	id AA03510; Sun, 29 Jan 95 12:21:50 CST
Received: by guru.ims.uni-stuttgart.de (Smail3.1.28.1 #16)
	id m0rYCwT-0003UwC; Sat, 28 Jan 95 14:11 MET
Message-Id: <m0rYCwT-0003UwC@guru.ims.uni-stuttgart.de>
Date: Sat, 28 Jan 95 14:11 MET
From: nils@guru.ims.uni-stuttgart.de (Cornelis van der Laan)
To: gcl@cli.com, jeff@aiai.edinburgh.ac.uk
Subject: Re: compiler bug w/ catch & throw

I can't verify this here, running a (slightly patched) AKCL 1.624
as well as GCL 1.0 on FreeBSD 1.1.5:

Starting /usr/local/bin/akcl ...
AKCL (Austin Kyoto Common Lisp)  Version(1.624) Sat Jan 21 20:29:04 MET 1995
Contains Enhancements by W. Schelter
OPTIMIZE levels: Safety=1 (No runtime error checking), Space=1, Speed=3
Using conditions package CLCS 2/1/90
Loading /home/nils/.akclrc.lisp
Using MK defsystem version v2.5 08-JAN-92
Finished loading /home/nils/.akclrc.lisp
>

>(defun f () (catch 'a (funcall #'(lambda () (throw 'a 10)))))

F

>(f)
10

>(compile 'f)
;; Compiling gazonk0.lisp.
;; End of Pass 1.  
;; End of Pass 2.  
OPTIMIZE levels: Safety=1 (No runtime error checking), Space=1, Speed=3
;; Finished compiling gazonk0.lisp.
Loading gazonk0.o
Finished loading gazonk0.o
#<compiled-function F>

>(f)
10

Compiling with optimization levels of (safety 0) (space 0) (speed 3)
results in the very same behaviour. Ditto GCL 1.0.

Something must be wrong with your vax port...

Nils

> GCL (GNU Common Lisp)  Version(1.1) Mon Nov 14 00:41:18 GMT 1994
> Licensed under GNU Public Library License
> Contains Enhancements by W. Schelter

> >(defun f () (catch 'a (funcall #'(lambda () (throw 'a 10)))))
> F

> >(f)
> 10

> >(compile 'f)
> Compiling gazonk0.lsp.
> End of Pass 1.  
> End of Pass 2.  
> OPTIMIZE levels: Safety=0 (No runtime error checking), Space=0,
> Speed=3
> Finished compiling gazonk0.lsp.
> Loading gazonk0.o
> start address -T 21e234 Finished loading gazonk0.o
> #<compiled-function F>

> >(f)

> Error: The tag A is undefined.
> Fast links are on: do (use-fast-links nil) for debugging
> Error signalled by F.
> Broken at F.  Type :H for Help.
> >>Bye.


From @festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk  Sun Jan 29 13:27:47 1995
Return-Path: <@festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12837; Sun, 29 Jan 95 13:27:47 CST
Received: from sun2.nsfnet-relay.ac.uk by cli.com (4.1/SMI-4.1)
	id AA03518; Sun, 29 Jan 95 12:39:10 CST
Via: uk.ac.edinburgh.festival; Sun, 29 Jan 1995 18:39:04 +0000
Received: from skye-alter.aiai.ed.ac.uk by festival.ed.ac.uk id aa22052;
          29 Jan 95 18:38 GMT
Received: from subnode.aiai.ed.ac.uk (bute) by aiai.ed.ac.uk;
          Sun, 29 Jan 95 18:38:39 GMT
Date: Sun, 29 Jan 95 18:38:38 GMT
Message-Id: <7207.9501291838@subnode.aiai.ed.ac.uk>
From: Jeff Dalton <jeff@aiai.edinburgh.ac.uk>
Subject: Re: compiler bug w/ catch & throw
To: Cornelis van der Laan <nils@guru.ims.uni-stuttgart.de>, gcl@cli.com

In-Reply-To: Cornelis van der Laan's message of Sat, 28 Jan 95 14:11 MET

> I can't verify this here, running a (slightly patched) AKCL 1.624
> as well as GCL 1.0 on FreeBSD 1.1.5:

Interesting...  The cases that didn't work for me were on a 386
running FreeBSD 2.0-RELEASE #3, but it's possible the AKCL and
the GCl were compiled using some different OS (the AKCl almost
certainly was).

The case that did work for me (AKCL 1.505) was on a Sun (though
it was also a system built before some OS upgrades).

Anyway, this raises several possibilities...

-- jeff

From reggie@miles.phys.washington.edu  Sun Jan 29 15:32:09 1995
Return-Path: <reggie@miles.phys.washington.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12847; Sun, 29 Jan 95 15:32:09 CST
Received: from miles.phys.washington.edu (pacts44.phys.washington.edu) by cli.com (4.1/SMI-4.1)
	id AA03641; Sun, 29 Jan 95 14:43:13 CST
Received: from miles.phys.washington.edu (localhost [127.0.0.1]) by miles.phys.washington.edu (8.6.9/8.6.9) with ESMTP id MAA03633; Sun, 29 Jan 1995 12:43:16 -0800
Message-Id: <199501292043.MAA03633@miles.phys.washington.edu>
To: Jeff Dalton <jeff@aiai.edinburgh.ac.uk>
Cc: Taiichi Yuasa <yuasa@katura.tutics.tut.ac.jp>, gcl@cli.com
Subject: Re: compiler bug w/ catch & throw 
In-Reply-To: Your message of "Sun, 29 Jan 1995 17:30:48 GMT."
             <7152.9501291730@subnode.aiai.ed.ac.uk> 
Date: Sun, 29 Jan 1995 12:43:12 -0800
From: "Reginald S. Perry" <reggie@phys.washington.edu>

>"Jeff" == Jeff Dalton <jeff@aiai.edinburgh.ac.uk> writes:

> >> There seems to be a bug, and it looks like it's been around for
> >> a long time.  The simplest example I've come up with so far is
> >> 
> >> (defun f () (catch 'a (funcall #'(lambda () (throw 'a 10)))))
> >> 
> >> (f) should return 10.
> 
> In the original KCL, both interpreted and compiled f return 10.

> I've just checked in AKCL 1.505, and it it works there too.

	Here is the result from gcl-1.0 on Linux.

miles$ gcl
GCL (GNU Common Lisp)  Version(1.0) Wed Aug 24 01:38:16 PDT 1994
Licensed under GNU Public Library License
Contains Enhancements by W. Schelter

>(defun f () (catch 'a (funcall #'(lambda () (throw 'a 10)))))
F

>(f)
10

>(compile (defun f () (catch 'a (funcall #'(lambda () (throw 'a 10))))))
Compiling gazonk0.lsp.
End of Pass 1.  
End of Pass 2.  
OPTIMIZE levels: Safety=0 (No runtime error checking), Space=0, Speed=3
Finished compiling gazonk0.lsp.
Loading gazonk0.o
start address -T 1e0000 Finished loading gazonk0.o
#<compiled-function F>

>(f)
10

>Bye.
miles$ gcl
GCL (GNU Common Lisp)  Version(1.0) Wed Aug 24 01:38:16 PDT 1994
Licensed under GNU Public Library License
Contains Enhancements by W. Schelter

>(compile (defun f () (catch 'a (funcall #'(lambda () (throw 'a 10))))))
Compiling gazonk0.lsp.
End of Pass 1.  
End of Pass 2.  
OPTIMIZE levels: Safety=0 (No runtime error checking), Space=0, Speed=3
Finished compiling gazonk0.lsp.
Loading gazonk0.o
start address -T 1e0000 Finished loading gazonk0.o
#<compiled-function F>

>(f)
10

>Bye.



-------------------
Reginald S. Perry -- University of Washington, Department of Physics FM-15
                     Seattle, Washington 98195
reggie@phys.washington.edu


From Chandan.Haldar@blr.sni.de  Sun Jan 29 23:50:47 1995
Return-Path: <Chandan.Haldar@blr.sni.de>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA12891; Sun, 29 Jan 95 23:50:47 CST
Received: from mail.sni.de by cli.com (4.1/SMI-4.1)
	id AA04401; Sun, 29 Jan 95 22:41:36 CST
Received: from blrsn01.blr.sni.de by mail.sni.de with SMTP (PP) id <25439-0@mail.sni.de>; Mon, 30 Jan 1995 05:40:55 +0100
Received: from blrast03.blr.sni.de by blr.sni.de (4.1/SMI-4.1)
	id AA10147; Mon, 30 Jan 95 10:12:29+050
Date: Mon, 30 Jan 95 10:12:29+050
From: Chandan.Haldar@blr.sni.de (Dr. Chandan Haldar)
Message-Id: <9501300512.AA10147@blr.sni.de>
Received: by blrast03.blr.sni.de (5.0/SMI-SVR4)
	id AA00369; Mon, 30 Jan 95 10:24:21 GMT
To: jeff@aiai.edinburgh.ac.uk
Cc: yuasa@katura.tutics.tut.ac.jp, gcl@cli.com
In-Reply-To: <7152.9501291730@subnode.aiai.ed.ac.uk> (message from Jeff Dalton on Sun, 29 Jan 95 17:30:48 GMT)
Subject: RE: compiler bug w/ catch & throw
Content-Length: 565

> I've just checked in AKCL 1.505, and it it works there too.

Also in AKCL 1.600 and in GCL 1.1 (on Sparc 10 Solaris 1 with cc).

--------------------------------------------------------------------------
Dr. Chandan Haldar
--------------------------------------------------------------------------
Siemens Information Systems Limited
29 Infantry Road, Bangalore 560 001, India.
Phone:    +91 80 551 1012                       Fax:      +91 80 551 1214
Internet: Chandan.Haldar@blr.sni.de
--------------------------------------------------------------------------

From readingj@cerfnet.com  Mon Jan 30 14:28:26 1995
Return-Path: <readingj@cerfnet.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA13186; Mon, 30 Jan 95 14:28:26 CST
Received: from nic.cerf.net by cli.com (4.1/SMI-4.1)
	id AA06203; Mon, 30 Jan 95 13:23:36 CST
Received: (from readingj@localhost) by nic.cerf.net (8.6.9/8.6.9) id LAA02737 for gcl@cli.com; Mon, 30 Jan 1995 11:23:31 -0800
Date: Mon, 30 Jan 1995 11:23:31 -0800
From: "John D. Reading" <readingj@cerfnet.com>
Message-Id: <199501301923.LAA02737@nic.cerf.net>
To: gcl@cli.com
Subject: Help building PCL??


Sorry to bug you, but has anyone out there built PCL under GCL 1.1 on
Solaris 2.3?  I am getting a core dump while building PCL, and I am
not progressing very well on tracking down the source of the error.

Can anyone help me?

Thanks,

John Reading
readingj@cerf.net
reading@io.dsd.litton.com

From wfs@math.utexas.edu  Mon Jan 30 15:09:11 1995
Return-Path: <wfs@math.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA13206; Mon, 30 Jan 95 15:09:11 CST
Received: from fireant.ma.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA06353; Mon, 30 Jan 95 13:57:33 CST
Received: from nicolas.ma.utexas.edu by fireant.ma.utexas.edu (5.64/5.51)
	id AA21073; Mon, 30 Jan 95 13:54:25 -0600
Date: Mon, 30 Jan 95 13:54:20 -0600
From: wfs@math.utexas.edu (Bill Schelter)
Posted-Date: Mon, 30 Jan 95 13:54:20 -0600
Message-Id: <9501301954.AA00894@nicolas.ma.utexas.edu>
Received: by nicolas.ma.utexas.edu (5.61/5.51)
	id AA00894; Mon, 30 Jan 95 13:54:20 -0600
To: gcl@cli.com
In-Reply-To: "John D. Reading"'s message of Mon, 30 Jan 1995 11:23:31 -0800 <199501301923.LAA02737@nic.cerf.net>
Subject: Re: Help building PCL??
Reply-To: wfs@math.utexas.edu


PCL:
On math.utexas.edu:pub/gcl/pcl-gcl-1.1.tgz

should contain correct code for pcl and gcl-1.1

This was contributed by Richard Harris who has done a good deal of work
pcl.

--------------------
Xlib:

There are two ways of having Xlib
1) CLX lisp code with X distribution.
  It is desirable to use some speedups for the arithmetic operations
rascal.ics.utexas.edu:7 -rw-r--r--  1 root         6494 Oct 22  1991 /usr2/ftp/pub/clx-5-opts.tar.Z
  contains such speedups.
2) Use something like
-rw-r--r--  1 wfs        106547 Oct  3 19:24 /u/ftp/pub/gcl/xgcl-2.tgz
which contains bindings for Xlib functions in lisp, but does a link with the C xlibrary.

I am also about to release a TCL/TK interface for GCL which will
provide a third (and I think for most purposes) preferable way of
interacting with the window system.

--------------------
Catch:
It appears from various evidence that the 'catch' bug reported by
dalton, was probably due to a changed include file on his system or a
changed C compiler flag, since the base gcl system had been compiled
(eg changing size of jmp_buf).  It was not due to a gcl/kcl/akcl bug.

Bill Schelter


From kbibb@qualcomm.com  Mon Jan 30 15:38:46 1995
Return-Path: <kbibb@qualcomm.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA13210; Mon, 30 Jan 95 15:38:46 CST
Received: from jafar.qualcomm.com by cli.com (4.1/SMI-4.1)
	id AA06381; Mon, 30 Jan 95 14:10:03 CST
Received: (kbibb@localhost) by jafar.qualcomm.com (8.6.8/QC-BSD-2.4) id MAA27759; Mon, 30 Jan 1995 12:10:09 -0800
Date: Mon, 30 Jan 1995 12:10:09 -0800
From: Ken Bibb <kbibb@qualcomm.com>
Message-Id: <199501302010.MAA27759@jafar.qualcomm.com>
To: gcl@cli.com, readingj@cerfnet.com
Subject: Re:  Help building PCL??

> From: "John D. Reading" <readingj@cerfnet.com>
> 
> Sorry to bug you, but has anyone out there built PCL under GCL 1.1 on
> Solaris 2.3?  I am getting a core dump while building PCL, and I am
> not progressing very well on tracking down the source of the error.
> 
> Can anyone help me?

That's the same error I'm getting :D

I think I saw a post saying that the version of vprintf being used
in Solaris is at fault.  

--
Ken Bibb		"Through the fire backwards
kbibb@qualcomm.com	 Again and Again
jester@crash.cts.com	 Return to base."
				Peter Hammill--"A Headlong Stretch"

From kbibb@qualcomm.com  Mon Jan 30 18:00:02 1995
Return-Path: <kbibb@qualcomm.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA13247; Mon, 30 Jan 95 18:00:02 CST
Received: from jafar.qualcomm.com by cli.com (4.1/SMI-4.1)
	id AA06820; Mon, 30 Jan 95 16:06:35 CST
Received: (kbibb@localhost) by jafar.qualcomm.com (8.6.8/QC-BSD-2.4) id OAA17020; Mon, 30 Jan 1995 14:06:35 -0800
Date: Mon, 30 Jan 1995 14:06:35 -0800
From: Ken Bibb <kbibb@qualcomm.com>
Message-Id: <199501302206.OAA17020@jafar.qualcomm.com>
To: gcl@cli.com, wfs@fireant.ma.utexas.edu
Subject: Re: Help building PCL??

> From: wfs@fireant.ma.utexas.edu (Bill Schelter)
> 
> PCL:
> On math.utexas.edu:pub/gcl/pcl-gcl-1.1.tgz
> 
> should contain correct code for pcl and gcl-1.1
> 
> This was contributed by Richard Harris who has done a good deal of work
> pcl.

My last attempt to build this was two days ago using the version that
was on fireant at that time.  It had the same prob that all versions of
PCL have had on Solaris 2.3--it core dumps when it reaches a certain
point in the compilation.

PCL appears to compile correctly under SunOS 4.x.

--
Ken Bibb		"Through the fire backwards
kbibb@qualcomm.com	 Again and Again
jester@crash.cts.com	 Return to base."
				Peter Hammill--"A Headlong Stretch"

From readingj@cerfnet.com  Mon Jan 30 19:07:50 1995
Return-Path: <readingj@cerfnet.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA13264; Mon, 30 Jan 95 19:07:50 CST
Received: from nic.cerf.net by cli.com (4.1/SMI-4.1)
	id AA07062; Mon, 30 Jan 95 17:30:53 CST
Received: (from readingj@localhost) by nic.cerf.net (8.6.9/8.6.9) id PAA07035 for gcl@cli.com; Mon, 30 Jan 1995 15:30:41 -0800
Date: Mon, 30 Jan 1995 15:30:41 -0800
From: "John D. Reading" <readingj@cerfnet.com>
Message-Id: <199501302330.PAA07035@nic.cerf.net>
To: gcl@cli.com
Subject: Re: Help building PCL??

Sorry, I have been a little unresponsive on this.  wfs has
been helping, as some of the messages to the list have
shown.  The particular problem I am seeing occurs during
the compilation of slots-boot.lisp, and seems to be related
to the function MAKE-METHOD-FUNCTION which is called from this
file.  I am currently using pcl-gcl-1.1, gcc 2.6.3, and gcl
1.1  Anybody who wants to play is welcome to come along ;-)

BTW:  Having commented out the 4 functions that call MAKE-METHOD-FUNCTION
in slots-boot.lisp I have found that the compilation proceeds
then to braid.lisp, at which point it dumps core again.  I
haven't played with this too much, but if I didn't screw up
something really bad then commenting out the function in 
braid.lisp which calls MAKE-METHOD-FUNCTION didn't seem to
stop it from dumping core.  For some reason I feel like I am
swimming upstream here.

John
readingj@cerf.net
reading@io.dsd.litton.com

From raz@superior.powercerv.com  Mon Jan 30 19:12:29 1995
Return-Path: <raz@superior.powercerv.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA13268; Mon, 30 Jan 95 19:12:29 CST
Received: from riverside.mr.net by cli.com (4.1/SMI-4.1)
	id AA07135; Mon, 30 Jan 95 17:45:07 CST
Received: from powercerv.com by riverside.mr.net (8.6.9/SMI-4.1.R931202)
	id RAA16887; Mon, 30 Jan 1995 17:45:16 -0600
Received: by powercerv.com (5.0/SMI-SVR4)
	id AA11120; Mon, 30 Jan 1995 17:44:13 +0600
Date: Mon, 30 Jan 1995 17:44:13 +0600
From: raz@superior.powercerv.com (Randal V. Zoeller)
Message-Id: <9501302344.AA11120@powercerv.com>
To: gcl@cli.com
Subject: Unsubscribe
Content-Length: 35


Please unsubscribe raz@itasca.com

From @festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk  Mon Jan 30 21:16:26 1995
Return-Path: <@festival.edinburgh.ac.uk:jeff@aiai.edinburgh.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA13292; Mon, 30 Jan 95 21:16:26 CST
Received: from sun2.nsfnet-relay.ac.uk by cli.com (4.1/SMI-4.1)
	id AA07374; Mon, 30 Jan 95 20:25:19 CST
Via: uk.ac.edinburgh.festival; Mon, 30 Jan 1995 17:51:03 +0000
Received: from skye-alter.aiai.ed.ac.uk by festival.ed.ac.uk id aa11495;
          30 Jan 95 17:50 GMT
Received: from subnode.aiai.ed.ac.uk (bute) by aiai.ed.ac.uk;
          Mon, 30 Jan 95 17:50:33 GMT
Date: Mon, 30 Jan 95 17:50:32 GMT
Message-Id: <9784.9501301750@subnode.aiai.ed.ac.uk>
From: Jeff Dalton <jeff@aiai.edinburgh.ac.uk>
Subject: Re: compiler bug w/ catch & throw
To: Cornelis van der Laan <nils@guru.ims.uni-stuttgart.de>, gcl@cli.com

In-Reply-To: Jeff Dalton's message of Sun, 29 Jan 95 18:38:38 GMT

> In-Reply-To: Cornelis van der Laan's message of Sat, 28 Jan 95 14:11 MET
> 
> > I can't verify this here, running a (slightly patched) AKCL 1.624
> > as well as GCL 1.0 on FreeBSD 1.1.5:
> 
> Interesting...  The cases that didn't work for me were on a 386
> running FreeBSD 2.0-RELEASE #3, but it's possible the AKCL and
> the GCl were compiled using some different OS (the AKCl almost
> certainly was).
> 
> The case that did work for me (AKCL 1.505) was on a Sun (though
> it was also a system built before some OS upgrades).
> 
> Anyway, this raises several possibilities...

Ok, I've figured it out.  Thanks to everyone who responded.
It was all very helpful.

And the answer is ... not a KCL or GCL bug at all.  For some
reason FreeBSD 2 changed the size of the area saved by setjmp.
In the various BSDs used to build the various Lisps it was 10;
in FreeBSD 2.0, it was 8.  Why the change?  Not clear.  Presumably
it's "more right" in some sense; but it does make otherwise
compatible systems incompatible.

-- jeff

From root@guru.ims.uni-stuttgart.de  Tue Jan 31 15:20:33 1995
Return-Path: <root@guru.ims.uni-stuttgart.de>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA13482; Tue, 31 Jan 95 15:20:33 CST
Received: from guru.ims.uni-stuttgart.de by cli.com (4.1/SMI-4.1)
	id AA11085; Tue, 31 Jan 95 13:43:22 CST
Received: by guru.ims.uni-stuttgart.de (Smail3.1.28.1 #16)
	id m0rZOXR-0003UwC; Tue, 31 Jan 95 20:46 MET
Message-Id: <m0rZOXR-0003UwC@guru.ims.uni-stuttgart.de>
Date: Tue, 31 Jan 95 20:46 MET
From: root@guru.ims.uni-stuttgart.de (Cornelis van der Laan)
To: gcl@cli.com, jeff@aiai.edinburgh.ac.uk, nils@guru.ims.uni-stuttgart.de
Subject: Re: compiler bug w/ catch & throw

And as far as I can see (not that far, but...) they only set
the jmp_buf size to it's real size, which is 8. The code
which uses it - setjmp and longjmp - is identical on
FreeBSD 1.1.5 and 2.0. All OSes which use 10 bytes waste 2...

So maybe editing the header file to read 10 and recompiling
world helps?

Nils

From frkorze@srv.PacBell.COM  Wed Feb  1 20:43:36 1995
Return-Path: <frkorze@srv.PacBell.COM>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA13729; Wed, 1 Feb 95 20:43:36 CST
Received: from ns.PacBell.COM by cli.com (4.1/SMI-4.1)
	id AA15781; Wed, 1 Feb 95 19:48:14 CST
Received: from srv.PacBell.COM (mother.srv.PacBell.COM) by ns.PacBell.COM (4.1/PacBell-11/15/94)
	id AA10449; Wed, 1 Feb 95 17:48:24 PST
Received: from diablo.srv.PacBell.COM by srv.PacBell.COM (4.1/SMI-4.0)
	id AA02736; Wed, 1 Feb 95 17:48:21 PST
Received: by diablo.srv.PacBell.COM (4.1/SMI-4.1)
	id AA00893; Wed, 1 Feb 95 17:48:21 PST
Date: Wed, 1 Feb 95 17:48:21 PST
From: frkorze@srv.PacBell.COM (Frank Korzeniewski)
Message-Id: <9502020148.AA00893@diablo.srv.PacBell.COM>
To: gcl@cli.com
Subject: subscribe

subscribe

From ias5!c3po.iasi.com!basham@csn.net  Fri Feb  3 13:58:24 1995
Return-Path: <ias5!c3po.iasi.com!basham@csn.net>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA14155; Fri, 3 Feb 95 13:58:24 CST
Received: from csn.net (csn.org) by cli.com (4.1/SMI-4.1)
	id AA21227; Fri, 3 Feb 95 13:02:18 CST
Received: from ias5.UUCP by csn.net with UUCP id AA00830
  (5.65c/IDA-1.4.4 for gcl@cli.com); Fri, 3 Feb 1995 12:02:31 -0700
Received: from c3po.iasi.com by iasi.com (4.1/SMI-4.1)
	id AA27752; Fri, 3 Feb 95 12:02:33 MST
Received: by c3po.iasi.com (4.1/SMI-4.1)
	id AA23706; Fri, 3 Feb 95 12:05:02 MST
Date: Fri, 3 Feb 95 12:05:02 MST
From: basham@c3po.iasi.com (Bryan Basham)
Message-Id: <9502031905.AA23706@c3po.iasi.com>
To: gcl@cli.com
Subject: Status of GCL on IRIX 5.X
Cc: basham@c3po.iasi.com

Hello,

Does any know if GCL will compile on SGI's OS IRIX 5.X?  If so, which is
the best FTP site to get the code?

Thanks,
Bryan

From ajwright@acssun.pstcc.cc.tn.us  Sat Feb 11 14:08:04 1995
Return-Path: <ajwright@acssun.pstcc.cc.tn.us>
Received: from cli.com by ftp (4.1/SMI-4.1)
	id AA01639; Sat, 11 Feb 95 14:08:04 CST
Received: from PSTCC4.PSTCC.CC.TN.US by cli.com (4.1/SMI-4.1)
	id AA16457; Sat, 11 Feb 95 12:58:03 CST
Received: from ACSSUN.PSTCC.CC.TN.US by pstcc.cc.tn.us (PMDF V4.2-11 #7176) id
 <01HMXBWN0KJ48ZE7U7@pstcc.cc.tn.us>; Sat, 11 Feb 1995 13:56:28 EDT
Received: (from ajwright@localhost) by acssun.pstcc.cc.tn.us (8.6.9/8.6.9) id
 NAA03405; Sat, 11 Feb 1995 13:55:43 -0500
Date: Sat, 11 Feb 1995 13:55:43 -0500 (EST)
From: "A. John Wright" <ajwright@acssun.pstcc.cc.tn.us>
Subject: GCL 1.1 and Solaris 2.3
To: gcl@cli.com
Message-Id: <Pine.SOL.3.91.950211132604.2445A-100000@acssun>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Content-Transfer-Encoding: 7BIT

	After trying everything else I can think of . . . 

	The CS department that works on the Sun SPARCstation 20/50 I admin
has requested that I get a version of LISP (preferably GCL) on this computer. 
So, I attempted to get gcl 1.1 to compile, but to no avail.  I read all the
online documentation for it and the make lives up to the point that the "raw
lisp compiler" has to read in several object files (defmacro.o etc) and 
output the final compiler. It dies on/with:

/-------
../unixport/raw_gcl ../unixport/ < foo
GCL (GNU Common Lisp)  April 1994  16384 pages
loading ../lsp/export.lsp
Initializing ../lsp/defmacro.o
~s is not a ~a
Lisp initialization failed.
\-------

	I don't know lisp, so I tried what I *do* know: I experimented with
different C compilers, assemblers and linkers.  I even tried stepping through
the process by hand (That'll work!  NOT!)

	I managed to get it to the state described above (Which is the best
so far) using GCC (2.6.1), the assembler that comes with Solaris 2.3, and the
defaults for "add-defs solaris".  Has anyone else had any experience with
this combination, (suggestions!) or know where I can find pre-compiled
binaries for my system?  Any assistance is appreciated! 

Thanks, (HELP!)
--aj

     ajwright@acssun.pstcc.cc.tn.us	ajwright@acssun.pstcc.cc.tn.us
----------------------------------------------------------------------------
            A. John `AJ' Wright -- UNIX Technician -- Ext: 7068



From ajwright@acssun.pstcc.cc.tn.us  Sat Feb 11 14:21:32 1995
Return-Path: <ajwright@acssun.pstcc.cc.tn.us>
Received: from cli.com by ftp (4.1/SMI-4.1)
	id AA01647; Sat, 11 Feb 95 14:21:32 CST
Received: from PSTCC4.PSTCC.CC.TN.US by cli.com (4.1/SMI-4.1)
	id AA16485; Sat, 11 Feb 95 13:20:16 CST
Received: from ACSSUN.PSTCC.CC.TN.US by pstcc.cc.tn.us (PMDF V4.2-11 #7176) id
 <01HMXCP2VDVK8ZE8BX@pstcc.cc.tn.us>; Sat, 11 Feb 1995 14:18:37 EDT
Received: (from ajwright@localhost) by acssun.pstcc.cc.tn.us (8.6.9/8.6.9) id
 OAA04248; Sat, 11 Feb 1995 14:17:52 -0500
Date: Sat, 11 Feb 1995 14:17:52 -0500 (EST)
From: "A. John Wright" <ajwright@acssun.pstcc.cc.tn.us>
Subject: GCL 1.1 and Solaris 2.3
To: gcl@cli.com
Message-Id: <Pine.SOL.3.91.950211141613.4199A-100000@acssun>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Content-Transfer-Encoding: 7BIT

	After trying everything else I can think of . . . 

	The CS department that works on the Sun SPARCstation 20/50 I admin
has requested that I get a version of LISP (preferably GCL) on this computer. 
So, I attempted to get gcl 1.1 to compile, but to no avail.  I read all the
online documentation for it and the make lives up to the point that the "raw
lisp compiler" has to read in several object files (defmacro.o etc) and 
output the final compiler. It dies on/with:

/-------
../unixport/raw_gcl ../unixport/ < foo
GCL (GNU Common Lisp)  April 1994  16384 pages
loading ../lsp/export.lsp
Initializing ../lsp/defmacro.o
~s is not a ~a
Lisp initialization failed.
\-------

	I don't know lisp, so I tried what I *do* know: I experimented with
different C compilers, assemblers and linkers.  I even tried stepping through
the process by hand (That'll work!  NOT!)

	I managed to get it to the state described above (Which is the best
so far) using GCC (2.6.1), the assembler that comes with Solaris 2.3, and the
defaults for "add-defs solaris".  Has anyone else had any experience with
this combination, (suggestions!) or know where I can find pre-compiled
binaries for my system?  Any assistance is appreciated! 

Thanks, (HELP!)
--aj

     ajwright@acssun.pstcc.cc.tn.us	ajwright@acssun.pstcc.cc.tn.us
----------------------------------------------------------------------------
            A. John `AJ' Wright -- UNIX Technician -- Ext: 7068





From ajwright@acssun.pstcc.cc.tn.us  Sat Feb 11 14:52:26 1995
Return-Path: <ajwright@acssun.pstcc.cc.tn.us>
Received: from cli.com by ftp (4.1/SMI-4.1)
	id AA01665; Sat, 11 Feb 95 14:52:26 CST
Received: from acssun.pstcc.cc.tn.us by cli.com (4.1/SMI-4.1)
	id AA16496; Sat, 11 Feb 95 14:04:41 CST
Date: Sat, 11 Feb 95 14:01:47 CST
From: ajwright@acssun.pstcc.cc.tn.us
Subject: GCL 1.1 and Solaris 2.3
To: gcl@cli.com
Message-Id: <Pine.SOL.3.91.950211141613.4199A-100000@acssun>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII
Content-Transfer-Encoding: 7BIT
 
        After trying everything else I can think of . . . 
 
        The CS department that works on the Sun SPARCstation 20/50 I admin

has requested that I get a version of LISP (preferably GCL) on this computer. 
So, I attempted to get gcl 1.1 to compile, but to no avail.  I read all the
online documentation for it and the make lives up to the point that the "raw
lisp compiler" has to read in several object files (defmacro.o etc) and 
output the final compiler. It dies on/with:
 
/-------
./unixport/raw_gcl ../unixport/ < foo
GCL (GNU Common Lisp)  April 1994  16384 pages
loading ../lsp/export.lsp
Initializing ../lsp/defmacro.o
~s is not a ~a
Lisp initialization failed.
\-------
 
        I don't know lisp, so I tried what I *do* know: I experimented with
different C compilers, assemblers and linkers.  I even tried stepping through
 
        I managed to get it to the state described above (Which is the best
so far) using GCC (2.6.1), the assembler that comes with Solaris 2.3, and the
defaults for "add-defs solaris".  Has anyone else had any experience with
this combination, (suggestions!) or know where I can find pre-compiled
binaries for my system?  Any assistance is appreciated! 
 
Thanks, (HELP!)
--aj
 
     ajwright@acssun.pstcc.cc.tn.us     ajwright@acssun.pstcc.cc.tn.us
----------------------------------------------------------------------------
            A. John `AJ' Wright -- UNIX Technician -- Ext: 7068
 

From wfs@math.utexas.edu  Sat Feb 11 18:43:26 1995
Return-Path: <wfs@math.utexas.edu>
Received: from cli.com by ftp (4.1/SMI-4.1)
	id AA01716; Sat, 11 Feb 95 18:43:26 CST
Received: from fireant.ma.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA16687; Sat, 11 Feb 95 17:55:34 CST
Received: from nicolas.ma.utexas.edu by fireant.ma.utexas.edu (5.64/5.51)
	id AA18640; Sat, 11 Feb 95 17:54:07 -0600
Date: Sat, 11 Feb 95 17:54:00 -0600
From: wfs@math.utexas.edu (Bill Schelter)
Posted-Date: Sat, 11 Feb 95 17:54:00 -0600
Message-Id: <9502112354.AA03498@nicolas.ma.utexas.edu>
Received: by nicolas.ma.utexas.edu (5.61/5.51)
	id AA03498; Sat, 11 Feb 95 17:54:00 -0600
To: ajwright@acssun.pstcc.cc.tn.us
Cc: gcl@cli.com
In-Reply-To: "A. John Wright"'s message of Sat, 11 Feb 1995 13:55:43 -0500 (EST) <Pine.SOL.3.91.950211132604.2445A-100000@acssun>
Subject: Re: GCL 1.1 and Solaris 2.3
Reply-To: wfs@math.utexas.edu


It does compile correctly with gcc (100's have done so), but I dont
think the sun c compiler is correct.  At least it was not last time i
checked.



From grib@mamba.arlut.utexas.edu  Wed Feb 15 09:28:27 1995
Return-Path: <grib@mamba.arlut.utexas.edu>
Received: from cli.com by ftp (4.1/SMI-4.1)
	id AA02438; Wed, 15 Feb 95 09:28:27 CST
Received: from ns1.arlut.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA25983; Wed, 15 Feb 95 08:22:12 CST
Received: from mamba.arlut.utexas.edu (mamba.arlut.utexas.edu [129.116.176.42]) by ns1.arlut.utexas.edu (8.6.9/8.6.9) with SMTP id IAA10397 for <gcl@cli.com>; Wed, 15 Feb 1995 08:22:34 -0600
Received: by mamba.arlut.utexas.edu (5.0/SMI-SVR4)
	id AA12398; Wed, 15 Feb 1995 08:22:34 +0600
From: grib@mamba.arlut.utexas.edu (William Gribble)
Message-Id: <9502151422.AA12398@mamba.arlut.utexas.edu>
Subject: Building gcl-1.1 under recent Linux?
To: gcl@cli.com
Date: Wed, 15 Feb 1995 08:22:32 -0600 (CST)
X-Mailer: ELM [version 2.4 PL22]
Content-Type: text
Content-Length: 1570      

Has anyone built gcl-1.1 (or 1.0, for that matter) under a recent Linux?
(``recent'' meaning > 1.1.51)?

I obtained a binary package of 1.0 already built which works just
fine, but I wanted to rebuild it myself.  I applied the patches I
found on sunsite (mostly pretty minor) and proceeded to build (using
gcc 2.6.2).  The problem is that unexec() doesn't work right.  The
raw_gcl made with ld works fine, but after the dump to saved_gcl
there's no a.out header on the file.  od shows that the header is
actually there, but there are 0x10000 zeros before it starts.  I tried
to debug it, but unexec() seems a little bit like black magic to me so
I didn't make much progress.  The nearest thing I could determine was
that write_text_and_data() (?) thought the text segment consisted of
0x10000 0s, followed by the a.out header, followed by the text. It was
writing all of this starting at file offset 0x00, so it was
overwriting the header that a previous function had written out.  At
this point I decided to punt.

I grabbed the unexsunos4.c from emacs-19.28 and hacked it up a little
to include save.c and define N_PAGSIZ to PAGE_SIZE (as the emacs
linux.h does).  This fixed the header location problem, but the dumped
image doesn't run properly; it just prints the startup banner and
hangs without giving a prompt, taking an excessive amount of CPU but
making no system calls.

I dug around in the mailings list archives and saw that lots of people had 
similar problems with the IRIX port.  Was there a canonical solution? 

Thanks for any advice--
Bill Gribble




From n2ell!pcolsen@cs.UMD.EDU  Sun Feb 19 11:36:51 1995
Return-Path: <n2ell!pcolsen@cs.UMD.EDU>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00436; Sun, 19 Feb 95 11:36:51 CST
Received: from mimsy.cs.UMD.EDU by cli.com (4.1/SMI-4.1)
	id AA07133; Sun, 19 Feb 95 10:40:35 CST
Received: from n2ell.UUCP 
	by mimsy.cs.UMD.EDU (8.6.9/UMIACS-0.9/04-05-88)
	id LAA02632; Sun, 19 Feb 1995 11:40:59 -0500
Received: by n2ell (Smail3.1.29.1 #3)
	id m0rgERV-0003A3C; Sun, 19 Feb 95 11:25 EST
Message-Id: <m0rgERV-0003A3C@n2ell>
Date: Sun, 19 Feb 95 11:25 EST
From: pcolsen@n2ell (Peter C. Olsen P.E.)
To: gcl@cli.com
Subject: Can't compile GCL-1.1 under Linux
Reply-To: pcolsen@acm.org


I can't seem to compile GCL-1.1 under Linux --- and I can't figure out
why.  I'd really appreciate some advice.

Everything seems to run just fine until I get to the part where I have
to execute "../unixport/saved_gcl" --- but that file is not
executable.

Any suggestions?  (I've included the output of my "make" below.)

Peter

P.S.  I'd like to make the package rather than snarf down a compiled
version (which I can't seem to find anyway) so I can make Maxima-5.0
(which needs the gcl *.o files).

-----------------------------------------------------------------

Here's a copy of the make output.  (I've broken some long lines.)

 Here's what I did: 

   bash$ make >~/gcl-hist
   sh: ../unixport/saved_gcl: cannot execute binary file
   make[1]: *** [collectfn.o] Error 126
   make: *** [all] Error 1

 Here's what I got:

   (cd bin; make all)
   make[1]: Entering directory `/mnt/sdc1/local/src/gcl-1.1/bin'
   make[1]: Nothing to be done for `all'.
   make[1]: Leaving directory `/mnt/sdc1/local/src/gcl-1.1/bin'
   (cd mp ; make all)
   make[1]: Entering directory `/mnt/sdc1/local/src/gcl-1.1/mp'
   make all1 "MPFILES=./mpi-386d.o   ./libmport.a"
   make[2]: Entering directory `/mnt/sdc1/local/src/gcl-1.1/mp'
   make[2]: Nothing to be done for `all1'.
   make[2]: Leaving directory `/mnt/sdc1/local/src/gcl-1.1/mp'
   make[1]: Leaving directory `/mnt/sdc1/local/src/gcl-1.1/mp'
   rm -f o/cmpinclude.h ; ln h/cmpinclude.h o
   (cd o; make all)
   make[1]: Entering directory `/mnt/sdc1/local/src/gcl-1.1/o'
   make[1]: Nothing to be done for `all'.
   make[1]: Leaving directory `/mnt/sdc1/local/src/gcl-1.1/o'
   (cd lsp; make all)
   make[1]: Entering directory `/mnt/sdc1/local/src/gcl-1.1/lsp'
   make[1]: Nothing to be done for `all'.
   make[1]: Leaving directory `/mnt/sdc1/local/src/gcl-1.1/lsp'
   (cd cmpnew; make all)
   make[1]: Entering directory `/mnt/sdc1/local/src/gcl-1.1/cmpnew'
   make[1]: Nothing to be done for `all'.
   make[1]: Leaving directory `/mnt/sdc1/local/src/gcl-1.1/cmpnew'
   (cd unixport; make saved_gcl)
   make[1]: Entering directory `/mnt/sdc1/local/src/gcl-1.1/unixport'
   make[1]: `saved_gcl' is up to date.
   make[1]: Leaving directory `/mnt/sdc1/local/src/gcl-1.1/unixport'
   make command
   make[1]: Entering directory `/mnt/sdc1/local/src/gcl-1.1'
   rm -f xbin/gcl ; echo "#!/bin/sh" > xbin/gcl; \
   echo "/mnt/sdc1/local/src/gcl-1.1/unixport/saved_gcl -dir
         /mnt/sdc1/local/src/gcl-1.1/unixport/ \$@ " \ 
   >> xbin/gcl
   chmod 755 xbin/gcl
   make[1]: Leaving directory `/mnt/sdc1/local/src/gcl-1.1'
   (cd  cmpnew ; make collectfn.o)
   make[1]: Entering directory `/mnt/sdc1/local/src/gcl-1.1/cmpnew'
   ../unixport/saved_gcl ../unixport/ -compile collectfn
   make[1]: Leaving directory `/mnt/sdc1/local/src/gcl-1.1/cmpnew'


 Here's the listing for saved_gcl and the machine type I was using:

   bash$ ls -l /mnt/sdc1/local/src/gcl-1.1/unixport/saved_gcl
          -rwxr-xr-x   1 pcolsen  bin       2134748 Feb 19 10:00
          /mnt/sdc1/local/src/gcl-1.1/unixport/saved_gcl
   bash$ more machine
   386-linux


For what it's worth, "raw_gcl" does run

   bash$ ./raw_gcl
   GCL (GNU Common Lisp)  April 1994  16384 pages
   loading ../lsp/export.lsp
   Initializing ../lsp/defmacro.o
   Initializing ../lsp/evalmacros.o
   Initializing ../lsp/top.o
   Initializing ../lsp/module.o
   loading ../lsp/autoload.lsp

   >

From grib@mamba.arlut.utexas.edu  Sun Feb 19 12:59:56 1995
Return-Path: <grib@mamba.arlut.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00455; Sun, 19 Feb 95 12:59:56 CST
Received: from ns1.arlut.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA07203; Sun, 19 Feb 95 12:04:03 CST
Received: from mamba.arlut.utexas.edu (mamba.arlut.utexas.edu [129.116.176.42]) by ns1.arlut.utexas.edu (8.6.9/8.6.9) with SMTP id MAA25961; Sun, 19 Feb 1995 12:04:28 -0600
Received: by mamba.arlut.utexas.edu (5.0/SMI-SVR4)
	id AA20928; Sun, 19 Feb 1995 12:04:27 +0600
From: grib@mamba.arlut.utexas.edu (William Gribble)
Message-Id: <9502191804.AA20928@mamba.arlut.utexas.edu>
Subject: Re: Can't compile GCL-1.1 under Linux
To: pcolsen@acm.org
Date: Sun, 19 Feb 1995 12:04:25 -0600 (CST)
Cc: gcl@cli.com
In-Reply-To: <m0rgERV-0003A3C@n2ell> from "Peter C. Olsen P.E." at Feb 19, 95 11:25:00 am
X-Mailer: ELM [version 2.4 PL22]
Content-Type: text
Content-Length: 2721      

I had this same difficulty, and have solved (or at least found a way
around) the problem.  But whoever maintains the Linux port shoud think
about changing the way the current system works.

The problem: recent binutils distributions for Linux build QMAGIC binaries
by default.  The differences between QMAGIC and the older ZMAGIC binaries
are (1) a QMAGIC binary has the struct exec header as a part of the 
text segment (2) the first page of the process address space is unmapped
at run time for a QMAGIC binary, to help trap NULL pointer dereferences
(you get a segmentation violation if you try to use a NULL pointer). 

While the QMAGIC binary is a nifty idea, it completely breaks the 
unexec() that's compiled for Linux with gcl-1.[01].  If you will use 
od(1) to look at your un-executable saved_gcl image, you will see 
a page of 0 bytes at the beginning, and then the 0314 QMAGIC magic number.
This is your problem.  Without the magic number at the start of the file,
Linux thinks it's just a binary data file.  

The workaround: Force a non-QMAGIC binary.  Unfortunately, QMAGIC has 
*replaced* ZMAGIC, which was the original Linux demand-paged executable
format.  Your only option with the current binutils is to use the 
-N option to ld, which makes an NMAGIC binary.  The problem with NMAGIC 
is that it's not a demand-paged format and is certainly archaic.  I'm not
sure exactly what difference it makes to the kernel, but I'm almost 
certain that an NMAGIC lisp image will use memory less efficiently than a
QMAGIC binary, forcing more of lisp to be in physical memory at one time. 

To implement this, edit gcl-1.1/unixport/makefile and change the line 
``LDCC=$(CC)'' to ``LDCC=$(CC) -N''.  What this does is force the original
raw_gcl image to be linked as NMAGIC.  unexec() (which dumps the running
process to a file) copies the header of the running process for the 
new, dumped image.  Therefore, every dump you do, including the one done
by the makefile to generate saved_gcl, will create an NMAGIC binary.

A real solution: patch gcl-1.1/c/unexlin.c to correctly handle QMAGIC binaries.
Since the current unexec() code came from an older version of Emacs, my guess
is that getting the Linux unexec() from the current Emacs distribution
would be the easiest thing to do.  

Good luck with the compile.  By the way, I'm about to mail a small
patch to the gcl list which should fix the socket-stream code for
Linux, if you're trying to use it.  Actually, sockets are not compiled
in by default; if you want it, edit gcl-1.1/h/386-linux.h and comment
out the line which says #undef RUN_PROCESS.  Then you can do nifty
stuff like (setf sock (si:make-socket-stream 'foo.bar.com 23)).

Bill Gribble







From grib@mamba.arlut.utexas.edu  Sun Feb 19 13:02:11 1995
Return-Path: <grib@mamba.arlut.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00460; Sun, 19 Feb 95 13:02:11 CST
Received: from ns1.arlut.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA07208; Sun, 19 Feb 95 12:12:07 CST
Received: from mamba.arlut.utexas.edu (mamba.arlut.utexas.edu [129.116.176.42]) by ns1.arlut.utexas.edu (8.6.9/8.6.9) with SMTP id MAA25987 for <gcl@cli.com>; Sun, 19 Feb 1995 12:12:32 -0600
Received: by mamba.arlut.utexas.edu (5.0/SMI-SVR4)
	id AA21055; Sun, 19 Feb 1995 12:12:30 +0600
From: grib@mamba.arlut.utexas.edu (William Gribble)
Message-Id: <9502191812.AA21055@mamba.arlut.utexas.edu>
Subject: small patch against gcl-1.1 (run_process.c)
To: gcl@cli.com
Date: Sun, 19 Feb 1995 12:12:29 -0600 (CST)
X-Mailer: ELM [version 2.4 PL22]
Content-Type: text
Content-Length: 960       

This patch corrects an error in gcl-1.1/c/run_process.c.  The 
sin_port field in struct sockaddr_in should be in network byte order, 
not host byte order.  On Suns, I believe the two are the same; on
x86 machines, they are not.  The htons() macro does the right thing 
for the platform you're compiling on.

On Linux (and x86 BSD machines, I am pretty sure) this caused calls to
(si:make-socket-stream) to try to connect to the wrong port, usually
generating a ``connection refused'' error.

Bill Gribble

--- gcl-1.1.original/c/run_process.c    Fri Oct 21 11:44:10 1994
+++ gcl-1.1/c/run_process.c     Sun Feb 19 11:37:37 1995
@@ -80,7 +80,7 @@
        bzero((char *)&sock_add, sizeof(sock_add));
        bcopy(hp->h_addr, (char *)&sock_add.sin_addr, hp->h_length);
        sock_add.sin_family = hp->h_addrtype;
-       sock_add.sin_port = server;
+       sock_add.sin_port = htons((short)server);
 
        sock = socket( hp->h_addrtype, SOCK_STREAM , 0);



From blake@edge.ercnet.com  Mon Feb 20 00:48:39 1995
Return-Path: <blake@edge.ercnet.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00546; Mon, 20 Feb 95 00:48:39 CST
Received: from edge.ercnet.com by cli.com (4.1/SMI-4.1)
	id AA07861; Sun, 19 Feb 95 23:58:24 CST
Received: from ip202.ercnet.com (ip202.ercnet.com [199.0.68.202]) by edge.ercnet.com (8.6.9/8.6.9) with SMTP id XAA18619 for <gcl@cli.com>; Sun, 19 Feb 1995 23:58:40 -0600
Message-Id: <199502200558.XAA18619@edge.ercnet.com>
X-Sender: blake@edge.ercnet.com
X-Mailer: Windows Eudora Version 1.4.4
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Date: Sun, 19 Feb 1995 23:58:59 -0600
To: gcl@cli.com
From: blake@edge.ercnet.com (Blake McBride)
Subject: Re: Can't compile GCL-1.1 under Linux

>The problem: recent binutils distributions for Linux build QMAGIC binaries
>by default.  The differences between QMAGIC and the older ZMAGIC binaries
>are (1) a QMAGIC binary has the struct exec header as a part of the 
>text segment (2) the first page of the process address space is unmapped
>at run time for a QMAGIC binary, to help trap NULL pointer dereferences
>(you get a segmentation violation if you try to use a NULL pointer). 
>
>........


I sure wish GCL had the ability to create executables via a normal
link instead of loading objects and unexecing!  This would make GCL
useful across a much wider veriety of platforms.

The way it would work is that lisp code would be compiled into objects
as they are now.  However, those objects could then be linked with a
GCL library - producing the executable.  No real need for unexec or
reading in objects.

--blake

-- 
Blake McBride				(615) 790-8521  voice
3020 Liberty Hills Drive		(615) 791-7736  fax
Franklin, TN  37064			blake@edge.ercnet.com
U.S.A.


From kr@shell.portal.com  Wed Feb 22 20:11:59 1995
Return-Path: <kr@shell.portal.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01185; Wed, 22 Feb 95 20:11:59 CST
Received: from nova.unix.portal.com by cli.com (4.1/SMI-4.1)
	id AA17351; Wed, 22 Feb 95 19:10:32 CST
Received: from jobe.shell.portal.com (root@jobe.shell.portal.com [156.151.3.4]) by nova.unix.portal.com (8.6.9/8.6.5) with ESMTP id RAA09632 for <gcl@cli.com>; Wed, 22 Feb 1995 17:10:30 -0800
Received: from DialupEudora (kr@jobe.shell.portal.com [156.151.3.4]) by jobe.shell.portal.com (8.6.9/8.6.5) with SMTP id RAA06238 for <gcl@cli.com>; Wed, 22 Feb 1995 17:10:24 -0800
X-Sender: kr@pop.shell.portal.com
Message-Id: <v02110101ab718ce88c55@DialupEudora>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Date: \p\r\r\e%, 22 Feb 1995 17:10:41 -0800
To: gcl@cli.com
From: kr@shell.portal.com (kr)
Subject: what is brk needed for ?

With this question I am presumably displaying my lack of knowledge about
UN!X systems. But I hope that getting a quick answer from the authors of
gcl will save me a lot of painful time, trying to figure this out by trial
and error.

In c/main.c , in the function siLsave_system() , one finds the following:

>#if defined(BSD) || defined(ATT)
>        brk(core_end);
>  /* printf( "(breaking at core_end = %x in main ,)",core_end); */
>#endif

What is the brk needed for ? Is there a way to work around it ? This seems
to be essentially the only place in the gcl source where brk is called. I
would be glad to receive advice on how to eliminate this call too.

I am trying to compile gcl-1.1 on a Mac, using MacMiNT, which is a
UN!X-like emulator that was originally written for Atari computers and then
adapted to Macs. This sounds pretty hairy (and it is :-), but usually most
C code can be ported without too much trouble to this platform. So far,
after fiddling around quite a bit, I have been able to compile everything,
but I am now stuck at the linking stage. I have tried to adhere to a BSD
system, so "BSD" is defined. Unfortunately, the mint libraries seem to be
totally unaware of any brk call, they only have sbrk. I do not understand
the difference between these calls, so I do not know how to work around
this problem.

Thank you for helpful hints.
When I have finally succeeded in getting this to run, I can contribute the
configuration I used for compiling under MacMiNT, if this is desired by the
gcl authors or members of this mailing list.


Greetings
Markus Krummenacker



From kr@shell.portal.com  Thu Feb 23 17:33:45 1995
Return-Path: <kr@shell.portal.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01486; Thu, 23 Feb 95 17:33:45 CST
Received: from nova.unix.portal.com by cli.com (4.1/SMI-4.1)
	id AA19931; Thu, 23 Feb 95 15:58:34 CST
Received: from jobe.shell.portal.com (root@jobe.shell.portal.com [156.151.3.4]) by nova.unix.portal.com (8.6.10/8.6.5) with ESMTP id NAA13210 for <gcl@cli.com>; Thu, 23 Feb 1995 13:58:32 -0800
Received: from DialupEudora (kr@jobe.shell.portal.com [156.151.3.4]) by jobe.shell.portal.com (8.6.10/8.6.5) with SMTP id NAA04253 for <gcl@cli.com>; Thu, 23 Feb 1995 13:58:27 -0800
X-Sender: kr@pop.shell.portal.com
Message-Id: <v02110101ab72a666a3d4@DialupEudora>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Date: date\r\e%, 23 Feb 1995 13:58:44 -0800
To: gcl@cli.com
From: kr@shell.portal.com (kr)
Subject: what is _cleanup ?

Thank you for the replies I obtained for my last question. It seems that
brk() can be expressed in terms of sbrk().

However, I have an additional question concerning a problem I have run
into. In the file unixsave.c , in function Lsave() , there is a call to
_cleanup() .

I have not found this function anywhere in the gcl source, nor does MacMiNT
know about it. What does it do ? Is this a UN!X function ? Can one just
leave it away with no adverse consequences ?


Greetings
Markus Krummenacker



From mjs@s4mjs.shannon.com  Sun Feb 26 13:41:47 1995
Return-Path: <mjs@s4mjs.shannon.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01978; Sun, 26 Feb 95 13:41:47 CST
Received: from cnj.digex.net by cli.com (4.1/SMI-4.1)
	id AA26331; Sun, 26 Feb 95 12:41:24 CST
Received: from shannon.com by cnj.digex.net with SMTP id AA00698
  (5.67b8/IDA-1.5 for <gcl@cli.com>); Sun, 26 Feb 1995 13:41:52 -0500
Received: by shannon.com (5.x/SMI-SVR4)
	id AA18818; Sun, 26 Feb 1995 13:41:48 -0500
Date: Sun, 26 Feb 1995 13:41:48 -0500
From: mjs@s4mjs.shannon.com (marty shannon)
Message-Id: <9502261841.AA18818@shannon.com>
To: gcl@cli.com
Subject: gcl on Solaris 2.4 for x86
Reply-To: mjs@s4mjs.shannon.com
X-Sun-Charset: US-ASCII

Hi, I've been trying to get gcl-1.1 to build under Solaris 2.4 (i.e.,
SunOS 5.4) on a 486, and been having a devil of a time even building
raw_gcl.  One of the problems with the current method of configuring
gcl is that a system type of, say, solaris, implies both hardware and
software, even though solaris runs on wildly different hardware (sparc
vs. i386/i486).  It would be better if the vast majority of parameters
were determined by the presense or absense of features rather than by the
current method.  Of course, if/as/when I get a working version, I'll send
my code to Bill Schelter to be folded in to the distribution, but anyone
who's more familiar with the porting issues than I am, and is willing
to look at what I've done so far is more than welcome to contact me
(mjs@shannon.com, in case the mail headers aren't quite right...).

	Marty
--
---------------+ <Delapsus Resurgam: When I fall I shall rise. --(10cc)>
Marty Shannon  | My opinions are just that.  You may share them.  No one
mjs@shannon.com| speaks for me, and I speak only for myself -- no matter
---------------+ where I post from.  Get it?             Post no flames.

From DOUGHILL@BNLCL6.BNL.GOV  Sun Feb 26 14:41:53 1995
Return-Path: <DOUGHILL@BNLCL6.BNL.GOV>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01985; Sun, 26 Feb 95 14:41:53 CST
Received: from BNLCL6.BNL.GOV by cli.com (4.1/SMI-4.1)
	id AA26403; Sun, 26 Feb 95 13:56:01 CST
Date: Sun, 26 Feb 1995 14:56:31 -0500 (EST)
From: DOUGHILL@BNLCL6.BNL.GOV
To: gcl@cli.com
Message-Id: <950226145631.24c41f17@BNLCL6.BNL.GOV>
Subject: A Fix for GCL unexec() problem with Linux

***   OUTLINE OF A FIX FOR THE GCL UNEXEC() PROBLEM ON LINUX    ***

SIMPTOM: GCL bombs during build.


gcl-1.1 (also gcl-1.0) generates a segmentation fault during the dumping
phase of the build on Slackware Linux 1.0.9.  It occurs during the call
to unexec().

I found a remedy by copying stuff from the current GNU emacs-19.28 (which
also dumps).

Take emacs/src/unexec.c, which is a somewhat modified version of unexlin.c
(i. e. same author: Spencer W. Thomas).  Define these macros:

/* These 3 from emacs/s
rc/s/linux.h */

#define A_TEXT_OFFSET(hdr) (N_MAGIC(hdr) == QMAGIC ? sizeof (struct exec) : 0)
#define A_TEXT_SEEK(hdr) (N_TXTOFF(hdr) + A_TEXT_OFFSET(hdr))
#define ADJUST_EXEC_HEADER \
  unexec_text_start = N_TXTADDR(ohdr) + A_TEXT_OFFSET(ohdr)

Using the preprocessor I determined start_of_text () and start_of_data () to
be:

/*
 *      These two functions lifted from emacs/src/sysdep.c
 *
 *	Return the address of the start of the text segment prior to
 *	doing an unexec.  After unexec the return value is
 undefined.
 *	See crt0.c for further explanation and _start.
 *
 */


char *
start_of_text ()
{
  return ((char *) 0 );
}


/*
 *	Return the address of the start of the data segment prior to
 *	doing an unexec.  After unexec the return value is undefined.
 *	See crt0.c for further information and definition of data_start.
 *
 *	Apparently, on BSD systems this is etext at startup.  On
 *	USG systems (swapping) this is highly mmu dependent and
 *	is also dependent on whether or not the program is running
 *	
with shared text.  Generally there is a (possibly large)
 *	gap between end of text and start of data with shared text.
 *
 *	On Uniplus+ systems with shared text, data starts at a
 *	fixed address.  Each port (from a given oem) is generally
 *	different, and the specific value of the start of data can
 *	be obtained via the UniPlus+ specific "uvar" system call,
 *	however the method outlined in crt0.c seems to be more portable.
 *
 *	Probably what will have to happen when a USG unexec is available,
 *	at l
east on UniPlus, is temacs will have to be made unshared so
 *	that text and data are contiguous.  Then once loadup is complete,
 *	unexec will produce a shared executable where the data can be
 *	at the normal shared text boundry and the startofdata variable
 *	will be patched by unexec to the correct value.
 *
 */
 
char *
start_of_data ()
{
  extern int data_start;
  return ((char *) &data_start);
}



In unixport/makefile:

# Put in stuff from emacs:
crt0_stuff = $(ODIR)/pre-crt0.o /usr/lib/crt0.o

raw_
$(SYSTEM):  $(crt0_stuff) $(FOR_RAW)
	$(LDCC) -nostartfiles $(crt0_stuff) -o raw_$(SYSTEM) $(FOR_RAW) $(GCLIB) -lm

It might be more portable to let the compiler pick its own libraries like this.


From simons@cs.tu-berlin.de  Thu Mar  2 02:49:45 1995
Return-Path: <simons@cs.tu-berlin.de>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02816; Thu, 2 Mar 95 02:49:45 CST
Received: from mail.cs.tu-berlin.de by cli.com (4.1/SMI-4.1)
	id AA07257; Thu, 2 Mar 95 01:48:08 CST
Received: from wintermute.cs.tu-berlin.de (simons@wintermute.cs.tu-berlin.de [130.149.19.141]) by mail.cs.tu-berlin.de (8.6.10/8.6.10) with ESMTP id IAA19813; Thu, 2 Mar 1995 08:48:34 +0100
Received: (simons@localhost) by wintermute.cs.tu-berlin.de (8.6.10/8.6.9) id IAA03894; Thu, 2 Mar 1995 08:48:25 +0100
Date: Thu, 2 Mar 1995 08:48:25 +0100
Message-Id: <199503020748.IAA03894@wintermute.cs.tu-berlin.de>
From: Martin Simons <simons@cs.tu-berlin.de>
To: gcl@cli.com
Subject: GCL 1.1 and NESL
Content-Type: text
Content-Length: 1215

Hi,

I am having troubles with GCL 1.1 while compiling CMU's NESL 3.0 under
SunOS5.4; everything works fine with SunOS4.1.3.

After adding the definitions for Solaris (./add-defs solaris) GCL 1.1
compiles with a few warnings. I am using gcc2.5.8.

Also, compiling NESL works well until I am asked to call the main
function (nesl) form the GCL prompt. GCL then quits with

	calling `dl' function sun did not supply

This error message originates from GCL's c/run_process.c where some
wrappers for `dl' functions are provided. We actually do have the libdl
library but naively commenting out the wrappers and compiling gcl with
-ldl with dynamic loading of libraries enabled produced a saved_gcl that
cored immediately. 

I don't want to dive any deeper into the gcl code and I would appreciate
any help.

Thanks and best regards,

Martin Simons
-------------------------------------------------------------------------
Martin Simons                            Internet: simons@cs.tu-berlin.de
Software Engineering Research Group (Sekr. FR5-6)   Tel: +49 30 314 25213
                                                    Fax: +49 30 314 73488
Technical University Berlin - Franklinstr. 28/29 - 10587 Berlin - Germany



From PBC01764@niftyserve.or.jp  Mon Mar  6 05:19:57 1995
Return-Path: <PBC01764@niftyserve.or.jp>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01002; Mon, 6 Mar 95 05:19:57 CST
Received: from inetnif.niftyserve.or.jp ([192.47.24.129]) by cli.com (4.1/SMI-4.1)
	id AA16804; Mon, 6 Mar 95 04:19:55 CST
Received: by inetnif.niftyserve.or.jp (8.6.9+2.4W/3.3W8-950117-Mail-Gateway)
	id TAA06257; Mon, 6 Mar 1995 19:20:55 +0900
Message-Id: <199503061020.TAA06257@inetnif.niftyserve.or.jp>
Date: Mon, 06 Mar 1995 19:19:00 +0900
From: Mikio Nakajima <PBC01764@niftyserve.or.jp>
Subject: gcl-1.1 on MSDOS (djgpp)
To: gcl@cli.com

  I got the gcl-1.1 from ftp.cli.com, tried to compile it on MSDOS +
djgpp- 1.12, but I cannot finish it even now :-(.


  First of all, I found add-defs.bat did not work on MSDOS ver.5.0.  For
Japanese domestic machines, MSDOS ver.6 has been receltly available, and
I don't have it now.  I'd like to know what version's MSDOS does
add-defs.bat support.


  Secondly, unixport\saved_kc.exe was not included in the archive.  I
am really anxious about the following message created by add-defs.bat.

  WARNING : unixport/saved_kcl.exe file not found
  _         you will not be able to recompile the .lsp files
  _         nor start akcl
  
      I'd like to know where to get saved_kcl.exe.


  Thirdly, I found out neither Smakefile nor tmpxx_.tem in the archive.
I guessed Smakefile was provided as makefile, but I really didn't found
out a relief for tmpxx_.tem.  I'd like to know where to or how to get
them.


  Finally, it seemed that h\dos-go32.h included <aout.h>.  Was this
dos-go32.h for djgpp-1.10 or earlier?  If someone provides dos-go32.h for
djgpp-1.11 or later, please tell me where to get it.

Mikio Nakajima (PBC01764@niftyserve.or.jp / minakaji@mix.or.jp)

From jeff@aiai.ed.ac.uk  Fri Mar 24 17:07:26 1995
Return-Path: <jeff@aiai.ed.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00485; Fri, 24 Mar 95 17:07:26 CST
Received: from haymarket.ed.ac.uk ([129.215.128.53]) by cli.com (4.1/SMI-4.1)
	id AA19847; Fri, 24 Mar 95 15:36:12 CST
Received: from festival.ed.ac.uk (festival.ed.ac.uk [129.215.128.24]) by haymarket.ed.ac.uk (8.6.10/8.6.10) with SMTP id VAA03612 for <gcl%cli.com@haymarket.ed.ac.uk>; Fri, 24 Mar 1995 21:36:04 GMT
Received: from skye-alter.aiai.ed.ac.uk by festival.ed.ac.uk id aa08313;
          24 Mar 95 21:34 GMT
Received: from subnode.aiai.ed.ac.uk (bute) by aiai.ed.ac.uk; Fri, 24 Mar 95 21:34:39 GMT
Date: Fri, 24 Mar 95 21:34:39 GMT
Message-Id: <4021.9503242134@subnode.aiai.ed.ac.uk>
From: Jeff Dalton <jeff@aiai.ed.ac.uk>
Subject: possible bug w/ 0d0
To: gcl@cli.com

Compiling a file that contains 0d0 and then loading the ,o file
gets "Dots appeared illegally".

This is running on a 386 using FreeBSD 2.0.  GCL 1.1 doesn't come w/.
such a port -- I just used the NetBSD stuff unchanged -- so it's
possible the bug is there rather than in GCL per se.

$ cat mess.lsp
(defun df-zero () 0d0)

$ gcl
GCL (GNU Common Lisp)  Version(1.1) Fri Mar 24 19:33:57  1995
Licensed under GNU Public Library License
Contains Enhancements by W. Schelter

>(compile-file "mess.lsp")
Compiling mess.lsp.
End of Pass 1.  
End of Pass 2.  
OPTIMIZE levels: Safety=0 (No runtime error checking), Space=0,
Speed=3
Finished compiling mess.lsp.
#"mess.o"

>(load *)
Loading mess.o

Error: Dots appeared illegally.
Fast links are on: do (use-fast-links nil) for debugging
Error signalled by LOAD.
Broken at LOAD.  Type :H for Help.
>>

-- jeff

From toy@rtp.ericsson.se  Fri Mar 24 17:23:56 1995
Return-Path: <toy@rtp.ericsson.se>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00489; Fri, 24 Mar 95 17:23:56 CST
Received: from gwa.ericsson.com by cli.com (4.1/SMI-4.1)
	id AA19926; Fri, 24 Mar 95 16:08:16 CST
Received: from mr2.exu.ericsson.se (mr2.exu.ericsson.com [138.85.147.12]) by gwa.ericsson.com (8.6.10/8.6.10) with ESMTP id QAA19987 for <gcl@cli.com>; Fri, 24 Mar 1995 16:08:15 -0600
Received: from screamer.rtp.ericsson.se (screamer.rtp.ericsson.se [147.117.133.13]) by mr2.exu.ericsson.se (8.6.8/NAHUB-MR1.1) with ESMTP id QAA13099 for <gcl@cli.com>; Fri, 24 Mar 1995 16:08:14 -0600
Received: from rcur (rcur7.rtp.ericsson.se [147.117.133.38]) by screamer.rtp.ericsson.se (8.6.8/8.6.4) with ESMTP id RAA10673; Fri, 24 Mar 1995 17:11:20 -0500
Message-Id: <199503242211.RAA10673@screamer.rtp.ericsson.se>
To: gcl@cli.com
Cc: toy@rtp.ericsson.se
Subject: reduce with :key, and map-into
Date: Fri, 24 Mar 1995 17:08:06 -0500
From: Raymond Toy <toy@rtp.ericsson.se>

I'm new to this list, so forgive if this has already been fixed.

In gcl 1.x and gcl 2.0, reduce does not accept the :key keyword
argument, as specified in cltl2.  Also, map-into is not defined at
all.

I've enclosed a modified version of reduce (from seqlib.lsp) that
accepts :key and a new version of map-into.  My lisp knowledge is
limited, so these may not be the best versions.

Ray

======================================================================
-----> Raymond Toy                         Tel:  919-990-7480
       Ericsson Inc.                       Fax:  919-990-7451
       1 Triangle Drive                 E-mail:  toy@rtp.ericsson.se
       RTP, NC 27709

(defun reduce (function sequence
			&key from-end
			start 
			end
			(initial-value nil ivsp)
			(key #'identity))
  (with-start-end  start end sequence
		   (cond ((not from-end)
			    (when (null ivsp)
			      (when (>= start end)
				(return-from reduce (funcall function)))
			      (setq initial-value (elt sequence start))
			      (setf start (f+ 1 start))
			      )
			    (do ((x initial-value
				    (funcall function x (funcall key (prog1 (elt sequence start)
							  (setf start (f+ 1 start))
							  )))))
				((>= start end) x)))
			 (t
			    (when (null ivsp)
			      (when (>= start end)
				(return-from reduce (funcall function)))
			      (setf end (f+ end -1))
			      (setq initial-value (elt sequence end)))
			    (do ((x initial-value (funcall function
							   (funcall key (elt sequence end)) x)))
				((>= start end) x)
			      (setf end (f+ -1 end)))))))

(defun map-into (result-sequence function &rest sequences)
  "map-into:  (result-sequence function &rest sequences)
Destructively modify RESULT-SEQUENCE to contain the results of
applying FUNCTION to corresponding elements of the argument
SEQUENCES in turn.  RESULT-SEQUENCE is returned.

The arguments RESULT-SEQUENCE and each element of SEQUENCES can each
be either a list or a vector.  The FUNCTION must accept at least as
many arguments as the number of arguement SEQUENCES supplied to
MAP-INTO.  If RESULT-SEQUENCE and the other argument SEQUENCES are not
all the same length, the iteration terminates when the shortest
sequence is exhausted.  If RESULT-SEQUENCE is a vector with a fill
pointer, the fill pointer is ignored when deciding how many iterations
to perform, and afterwards the fill pointer is set to the number of
times the FUNCTION was applied.

If the FUNCTION has side effects, it can count on being called first
on all the elements numbered 0, then on all those numbered 1, and so
on.

If RESULT-SEQUENCE is longer than the shortest element of SEQUENCES,
extra elements at the end of RESULT-SEQUENCE are unchanged.

The function MAP-INTO differs from MAP in that it modifies an existing
sequence rather than creating a new one.  In addition, MAP-INTO can be
called with only two arguments (RESULT-SEQUENCE and FUNCTION), while
MAP requires at least three arguments.

If RESULT-SEQUENCE is NIL, MAP-INTO immediately returns NIL, becaause
NIL is a sequence of length zero."
  (let ((nel (apply #'min (if (eq 'vector (type-of result-sequence))
			      (array-dimension result-sequence 0)
			    (length result-sequence))
		    (mapcar #'length sequences))))
    ;; Set the fill pointer to the number of iterations
    (when (and (eq 'vector (type-of result-sequence))
		(array-has-fill-pointer-p result-sequence))
      (setf (fill-pointer result-sequence) nel))
    ;; Perform mapping
    (dotimes (k nel result-sequence)
      (setf (elt result-sequence k)
	    (apply function (mapcar #'(lambda (v) (elt v k)) sequences))))))

From pw@snoopy.mv.com  Fri Mar 24 17:27:05 1995
Return-Path: <pw@snoopy.mv.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00493; Fri, 24 Mar 95 17:27:05 CST
Received: from snoopy.mv.com by cli.com (4.1/SMI-4.1)
	id AA19923; Fri, 24 Mar 95 16:06:51 CST
Received: (from pw@localhost) by snoopy.mv.com (8.6.9/8.6.6) id RAA01276; Fri, 24 Mar 1995 17:03:07 -0500
Date: Fri, 24 Mar 1995 17:03:07 -0500
From: "Paul F. Werkowski" <pw@snoopy.mv.com>
Message-Id: <199503242203.RAA01276@snoopy.mv.com>
To: jeff@aiai.ed.ac.uk
Cc: gcl@cli.com
In-Reply-To: <4021.9503242134@subnode.aiai.ed.ac.uk> (message from Jeff Dalton on Fri, 24 Mar 95 21:34:39 GMT)
Subject: Re: possible bug w/ 0d0

>>>>> "Jeff" == Jeff Dalton <jeff@aiai.ed.ac.uk> writes:

    Jeff> Compiling a file that contains 0d0 and then loading the ,o
    Jeff> file gets "Dots appeared illegally".

    Jeff> Error: Dots appeared illegally.  Fast links are on: do
    Jeff> (use-fast-links nil) for debugging Error signalled by LOAD.
    Jeff> Broken at LOAD.  Type :H for Help.
    >>>

	This is a known problem with the 2.0 vfprintf.c function
	in libc. It's been fixed in -current since mid January.

Paul





     

From leverich@rand.org  Fri Mar 24 19:39:49 1995
Return-Path: <leverich@rand.org>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00535; Fri, 24 Mar 95 19:39:49 CST
Received: from rand.org by cli.com (4.1/SMI-4.1)
	id AA20202; Fri, 24 Mar 95 18:46:30 CST
Received: from monty.rand.org (monty-cc.rand.org [130.154.8.173]) by rand.org (8.6.10/8.6.10) with ESMTP id QAA15341; Fri, 24 Mar 1995 16:44:49 -0800
Received: from atlantis.rand.org (atlantis.rand.org [130.154.12.124]) by monty.rand.org (8.6.10/8.6.10) with ESMTP id QAA21382; Fri, 24 Mar 1995 16:44:54 -0800
Received: from localhost.rand.org (localhost.rand.org [127.0.0.1]) by atlantis.rand.org (8.6.10/8.6.9) with SMTP id QAA14580; Fri, 24 Mar 1995 16:44:52 -0800
Message-Id: <199503250044.QAA14580@atlantis.rand.org>
To: "Paul F. Werkowski" <pw@snoopy.mv.com>
Cc: jeff@aiai.ed.ac.uk, gcl@cli.com, Brian_Leverich@rand.org
Reply-To: Brian_Leverich@rand.org
Subject: Re: possible bug w/ 0d0 
In-Reply-To: Your message of Fri, 24 Mar 95 17:03:07 EST.
             <199503242203.RAA01276@snoopy.mv.com> 
Date: Fri, 24 Mar 95 16:44:49 PST
From: Brian Leverich <leverich@rand.org>



-- Your message was:   (from ""Paul F. Werkowski"")

          This is a known problem with the 2.0 vfprintf.c function
          in libc. It's been fixed in -current since mid January.

  Paul
       
  ------------------


Oops.  I've just had one of those self-revelatory experiences where
I've become aware of my own extreme cluelessness.

Where are 2.0 and -current?  And is there another list where gcl is
being discussed besides here?

BTW, if anyone else is interested in such self-abuse, there are
versions of CLX and Garnet 2.2 hacked for GCL compatibility available
from ftp://rand.org/pub/leverich/.  (We're running GCL/CLX/Garnet on
Linux boxes and HP 735s here at RAND.)  We're supporting these sources
in rude mode, which means we don't support them at all but we will
incorporate contributed fixes into future versions.  Cheers, B.


From kr@shell.portal.com  Sat Mar 25 06:39:58 1995
Return-Path: <kr@shell.portal.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00617; Sat, 25 Mar 95 06:39:58 CST
Received: from nova.unix.portal.com by cli.com (4.1/SMI-4.1)
	id AA20989; Sat, 25 Mar 95 05:12:19 CST
Received: from jobe.shell.portal.com (jobe.shell.portal.com [156.151.3.4]) by nova.unix.portal.com (8.6.11/8.6.5) with ESMTP id DAA19500; Sat, 25 Mar 1995 03:11:43 -0800
Received: from DialupEudora (jobe.shell.portal.com [156.151.3.4]) by jobe.shell.portal.com (8.6.11/8.6.5) with SMTP id DAA25555; Sat, 25 Mar 1995 03:11:39 -0800
X-Sender: kr@pop.shell.portal.com
Message-Id: <v0211010aab992d208f52@DialupEudora>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Date: srialpop\r\e%, 25 Mar 1995 03:12:05 -0800
To: Raymond Toy <toy@rtp.ericsson.se>, gcl@cli.com
From: kr@shell.portal.com (kr)
Subject: Re: reduce with :key, and map-into
Cc: toy@rtp.ericsson.se

At 17:08 95-03-24, Raymond Toy wrote:
>I'm new to this list, so forgive if this has already been fixed.
>
>In gcl 1.x and gcl 2.0, reduce does not accept the :key keyword

What exactly is gcl 2.0 ?
Having been on this list for a couple of weeks, I have not noticed an
announcement float by. Have I missed something ?


Greetings
Markus Krummenacker



From pw@snoopy.mv.com  Sat Mar 25 08:51:24 1995
Return-Path: <pw@snoopy.mv.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00627; Sat, 25 Mar 95 08:51:24 CST
Received: from snoopy.mv.com by cli.com (4.1/SMI-4.1)
	id AA21086; Sat, 25 Mar 95 07:25:00 CST
Received: (from pw@localhost) by snoopy.mv.com (8.6.9/8.6.6) id IAA02697; Sat, 25 Mar 1995 08:18:19 -0500
Date: Sat, 25 Mar 1995 08:18:19 -0500
From: "Paul F. Werkowski" <pw@snoopy.mv.com>
Message-Id: <199503251318.IAA02697@snoopy.mv.com>
To: Brian_Leverich@rand.org
Cc: gcl@cli.com
In-Reply-To: <199503250044.QAA14580@atlantis.rand.org> (message from Brian Leverich on Fri, 24 Mar 95 16:44:49 PST)
Subject: Re: possible bug w/ 0d0

>>>>> "Brian" == Brian Leverich <leverich@rand.org> writes:

    Brian> -- Your message was: (from ""Paul F. Werkowski"")

    Brian>           This is a known problem with the 2.0 vfprintf.c
    Brian> function in libc. It's been fixed in -current since mid
    Brian> January.

    Brian> Oops.  I've just had one of those self-revelatory
    Brian> experiences where I've become aware of my own extreme
    Brian> cluelessness.

    Brian> Where are 2.0 and -current?  And is there another list
    Brian> where gcl is being discussed besides here?


	Sorry, I had been reading zillions of messages from
	the "freebsd-hackers" list where those terms are part of
	the lingo.

	2.0 refers to FreeBSD 2.0, part of the subject in the message
	I was replying to. -current refers to the current state of the
	FreeBSD development tree which will at some point become
	FreeBSD 2.1(RELEASE). There is no specific gcl discussion
	in any of  the FreeBSD mailing lists that I know of but there
	is a "port" of gcl-1.1 in the tree that will appear on the
	2.1 CDROM. A "port" in this context is a node in the distribution
	where one can simply say "make" and have all the right things
	happen to cause the underlying application to be fetched,
	patched, compiled and installed. The FreeBSD gcl port adds
	files FreeBSD.defs and FreeBSD.h that have been tuned to 
	the -current state of things and also arranges for the correct
	"unexec" variant of the system saver to be present.

	Having written all that I now notice that you asked "where",
	not "what".

	freebsd.cdrom.com:/pub/FreeBSD/FreeBSD-current	
	http://www.freebsd.org

-- 
(let ((forty++ "Sonetech Corporation")
      (product "Real-Time Multi-Media Recognition Systems")
      (IP-access :self)
      (OS-of-choice '|FreeBSD|)
  ...)



     

From jeff@aiai.ed.ac.uk  Sat Mar 25 11:00:01 1995
Return-Path: <jeff@aiai.ed.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00662; Sat, 25 Mar 95 11:00:01 CST
Received: from haymarket.ed.ac.uk by cli.com (4.1/SMI-4.1)
	id AA21227; Sat, 25 Mar 95 09:58:43 CST
Received: from festival.ed.ac.uk (festival.ed.ac.uk [129.215.128.24]) by haymarket.ed.ac.uk (8.6.10/8.6.10) with SMTP id PAA08315; Sat, 25 Mar 1995 15:57:16 GMT
Received: from skye-alter.aiai.ed.ac.uk by festival.ed.ac.uk id aa07751;
          25 Mar 95 15:55 GMT
Received: from subnode.aiai.ed.ac.uk (bute) by aiai.ed.ac.uk; Sat, 25 Mar 95 15:55:25 GMT
Date: Sat, 25 Mar 95 15:55:25 GMT
Message-Id: <4643.9503251555@subnode.aiai.ed.ac.uk>
From: Jeff Dalton <jeff@aiai.ed.ac.uk>
Subject: Re: possible bug w/ 0d0 
To: Brian_Leverich@rand.org, "Paul F. Werkowski" <pw@snoopy.mv.com>
Cc: gcl@cli.com

In-Reply-To: Brian Leverich's message of Fri, 24 Mar 95 16:44:49 PST

> -- Your message was:   (from ""Paul F. Werkowski"")
> 
>           This is a known problem with the 2.0 vfprintf.c function
>           in libc. It's been fixed in -current since mid January.
>
> Oops.  I've just had one of those self-revelatory experiences where
> I've become aware of my own extreme cluelessness.
> 
> Where are 2.0 and -current?  And is there another list where gcl is
> being discussed besides here?

Fear not!  2.0 and -current are versions of FreeBSD, and the "bug"
turns out to be in FreeBSD rather than GCL.  Indeed, I should have
remembered this problem, because I've had to deal with it before.

When GCL prints a floating-point number, it uses the C routine
sprintf to convert it to a string and then edits the string.
And this editing sassumes the string has a format that it turns
out not to have for numbers such as 1.0 and 100.0.  Other
numbers, e.g. PI, are fine.

Anyway, thanks to all who replied!

-- jeff

From lnm@stsn.dga.fr  Mon Mar 27 06:18:08 1995
Return-Path: <lnm@stsn.dga.fr>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00931; Mon, 27 Mar 95 06:18:08 CST
Received: from asterix.stsn.dga.fr (mailhost.stsn.dga.fr) by cli.com (4.1/SMI-4.1)
	id AA24003; Mon, 27 Mar 95 04:57:00 CST
Received: (from lnm@localhost) by asterix.stsn.dga.fr (8.6.9/8.6.9) id LAA00383; Mon, 27 Mar 1995 11:40:56 +0100
Date: Mon, 27 Mar 1995 11:40:56 +0100
From: LIGNON Marc  <lnm@stsn.dga.fr>
Message-Id: <199503271040.LAA00383@asterix.stsn.dga.fr>
To: gcl@cli.com
Subject: Pb with Xgcl on solaris


I want to use Xgcl-2 on both sun4 and solaris. I built it properly for
sun4 but I'm having some pbs with solaris:
(gcl already works OK on solaris) 

Building it straight ahead I get this:

Undefined			first referenced
 symbol  			    in file
authdes_create                      /usr/lib/libX11.a(XConnDis.o)
ld: fatal: Symbol referencing errors. No output written to raw_xgcl

The symbol "authdes_create" is defined at libnsl.a which is present in
one of the make variables "*LIBS*" of GCLDIR/unixport, and is present
on the gcc line to build "raw_xgcl". The pb is that it figures before
-lX11. If we put -lnsl after -lX11 the following appears:

ld: fatal: symbol `shifts' is multiply defined:
	(file ../mp/libmport.a(mp2.o) and file /usr/lib/libnsl.a(des_soft.o));
ld: fatal: File processing errors.  No output written to raw_xgcl

Does anybody already had this problem, and knows how to overpass ?

Thaks for your attention,
Best regards and

A bientot,

Marc LIGNON
________________________________________________________________________
DGA/DCN/ST/DA/S/ES			lignon@stsn.dga.fr
8, boulevard Victor			tel: (33)(1) 40.59.13.14
75015 - PARIS - FRANCE			fax: (33)(1) 45.79.20.40


From novak@cs.utexas.edu  Mon Mar 27 14:53:10 1995
Return-Path: <novak@cs.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01138; Mon, 27 Mar 95 14:53:10 CST
Received: from mail.cs.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA25450; Mon, 27 Mar 95 13:44:18 CST
Received: from ai.cs.utexas.edu (novak@ai.cs.utexas.edu [128.83.120.3]) by mail.cs.utexas.edu (8.6.10/8.6.9) with ESMTP id NAA09179; Mon, 27 Mar 1995 13:44:17 -0600
Received: by ai.cs.utexas.edu (8.6.10/Client-v1.4)
	id NAA11217; Mon, 27 Mar 1995 13:44:15 -0600
Message-Id: <199503271944.NAA11217@ai.cs.utexas.edu>
From: novak@cs.utexas.edu (Gordon Shaw Novak  Jr.)
Date: Mon, 27 Mar 1995 13:44:15 -0600
X-Mailer: Mail User's Shell (7.2.5 10/14/92)
To: gcl@cli.com
Subject: XGCL available
Cc: novak@cs.utexas.edu, boyer@cli.com

Xgcl software is now available; it provides an interface to
X  windows from GCL (Gnu Common Lisp, formerly Austin Kyoto
Common Lisp or AKCL).

There is a low-level interface to the Xlib routines, and there is
an easy-to-use interface that provides graphics, menus, and mouse
interaction via functions that are called from Lisp.

Xgcl is built on top of GCL, and it is somewhat larger
(e.g. 6.7 MB for Xgcl vs. 4.9 MB for GCL) because it incorporates
Xlib.  To make Xgcl, you must first obtain and make GCL.  The code
was written by Gordon Novak, Hiep Nguyen, and William Schelter.

The file is called xgcl-2.tgz .  Xgcl and GCL can be FTP'd from:
    math.utexas.edu    pub/gcl
    ftp.cli.com        pub/gcl
    ftp.cs.utexas.edu  pub/novak/xgcl       (Xgcl file only)

    http://www.cs.utexas.edu/users/novak    (Xgcl file only)

Put the xgcl-2.tgz file in the same directory as gcl-1.1.tgz .
Uncompress it with:      gzip -dc xgcl-2.tgz | tar xvf -
Then see the README in the directory xgcl-2.

Note: the date of the xgcl-2.tgz should be 3/15/95 or later.

From boyer@cli.com  Mon Mar 27 16:17:19 1995
Return-Path: <boyer@cli.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01168; Mon, 27 Mar 95 16:17:19 CST
Received: from rita.cli.com by cli.com (4.1/SMI-4.1)
	id AA25658; Mon, 27 Mar 95 14:50:32 CST
From: boyer@cli.com (Robert S. Boyer)
Received: by rita.cli.com (4.1) id AA08369; Mon, 27 Mar 95 14:50:31 CST
Date: Mon, 27 Mar 95 14:50:31 CST
Message-Id: <9503272050.AA08369@rita.cli.com>
To: gcl@cli.com
Cc: novak@cs.utexas.edu
Subject: Re: XGCL available

I didn't have anything to do with Xgcl, but I have seen it operate and
I think I should mention that Xgcl is an extremely fast and efficient
way to communicate with X from GCL.  I believe some folks have found
GCL or (A)KCL, when used with other interfaces to Xlib, to be rather
sluggish.  I suspect this was due to the absence of sufficient
attention to the declaration of arithmetic and array operations and
function proclamations, something that can make a two orders of
magnitude difference in the execution of KCL/GCL programs.

For others who are as ignorant as me about X windows, let me make the
obvious remark that Xgcl is relatively "low level" because it connects
the programmer to the Xlib level of X, a level at which you can draw
your own lines and place your characters at absolute locations of your
choice, and so forth.  This is in marked contrast to the TK interface
that Bill Schelter is providing, where a plethora of higher level
graphical objects are supported.  The point is that both relatively
high and low level X graphics facilities are becoming available to the
GCL programmer.

Bob

From leverich@rand.org  Mon Mar 27 18:14:49 1995
Return-Path: <leverich@rand.org>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01183; Mon, 27 Mar 95 18:14:49 CST
Received: from rand.org by cli.com (4.1/SMI-4.1)
	id AA26064; Mon, 27 Mar 95 16:57:20 CST
Received: from monty.rand.org (monty-cc.rand.org [130.154.8.173]) by rand.org (8.6.10/8.6.10) with ESMTP id OAA15969; Mon, 27 Mar 1995 14:57:18 -0800
Received: from atlantis.rand.org (atlantis.rand.org [130.154.12.124]) by monty.rand.org (8.6.10/8.6.10) with ESMTP id OAA02633; Mon, 27 Mar 1995 14:57:17 -0800
Received: from localhost.rand.org (localhost.rand.org [127.0.0.1]) by atlantis.rand.org (8.6.10/8.6.9) with SMTP id OAA18554; Mon, 27 Mar 1995 14:57:16 -0800
Message-Id: <199503272257.OAA18554@atlantis.rand.org>
To: boyer@cli.com (Robert S. Boyer)
Cc: gcl@cli.com, novak@cs.utexas.edu, Brian_Leverich@rand.org
Reply-To: Brian_Leverich@rand.org
Subject: Re: XGCL available 
In-Reply-To: Your message of Mon, 27 Mar 95 14:50:31 CST.
             <9503272050.AA08369@rita.cli.com> 
Date: Mon, 27 Mar 95 14:57:14 PST
From: Brian Leverich <leverich@rand.org>



Anyone know off the top of their head how much is XGCL like CLX at the
Lisp funtional interface level?  Cheers, B




From novak@cs.utexas.edu  Mon Mar 27 18:51:30 1995
Return-Path: <novak@cs.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01190; Mon, 27 Mar 95 18:51:30 CST
Received: from mail.cs.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA26100; Mon, 27 Mar 95 17:01:59 CST
Received: from ai.cs.utexas.edu (novak@ai.cs.utexas.edu [128.83.120.3]) by mail.cs.utexas.edu (8.6.10/8.6.9) with ESMTP id RAA23926; Mon, 27 Mar 1995 17:01:57 -0600
Received: by ai.cs.utexas.edu (8.6.10/Client-v1.4)
	id RAA11686; Mon, 27 Mar 1995 17:01:55 -0600
Message-Id: <199503272301.RAA11686@ai.cs.utexas.edu>
From: novak@cs.utexas.edu (Gordon Shaw Novak  Jr.)
Date: Mon, 27 Mar 1995 17:01:55 -0600
X-Mailer: Mail User's Shell (7.2.5 10/14/92)
To: Brian_Leverich@rand.org, boyer@cli.com (Robert S. Boyer)
Subject: Re: XGCL available
Cc: gcl@cli.com, novak@cs.utexas.edu

CLX and Xlib have very similar interfaces.  My guess is that CLX is a
"copy" of Xlib except that it is written in Lisp rather than C.
(This does not mean that the actual calling sequences are identical,
but conceptually they are the same.)  CLX is a lot bigger and a lot
slower than Xlib in my experience.  And XGCL provides a higher-level
interface than either CLX or Xlib.
Regards, Gordon

From leverich@rand.org  Mon Mar 27 19:15:25 1995
Return-Path: <leverich@rand.org>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01195; Mon, 27 Mar 95 19:15:25 CST
Received: from rand.org by cli.com (4.1/SMI-4.1)
	id AA26201; Mon, 27 Mar 95 17:47:14 CST
Received: from monty.rand.org (monty-cc.rand.org [130.154.8.173]) by rand.org (8.6.10/8.6.10) with ESMTP id PAA18285; Mon, 27 Mar 1995 15:47:09 -0800
Received: from atlantis.rand.org (atlantis.rand.org [130.154.12.124]) by monty.rand.org (8.6.10/8.6.10) with ESMTP id PAA07937; Mon, 27 Mar 1995 15:47:08 -0800
Received: from localhost.rand.org (localhost.rand.org [127.0.0.1]) by atlantis.rand.org (8.6.10/8.6.9) with SMTP id PAA18645; Mon, 27 Mar 1995 15:47:07 -0800
Message-Id: <199503272347.PAA18645@atlantis.rand.org>
To: novak@cs.utexas.edu (Gordon Shaw Novak Jr.)
Cc: boyer@cli.com (Robert S. Boyer), gcl@cli.com, Brian_Leverich@rand.org
Reply-To: Brian_Leverich@rand.org
Subject: Re: XGCL available 
In-Reply-To: Your message of Mon, 27 Mar 95 17:01:55 CST.
             <199503272301.RAA11686@ai.cs.utexas.edu> 
Date: Mon, 27 Mar 95 15:47:05 PST
From: Brian Leverich <leverich@rand.org>



-- Your message was:   (from "novak@cs.utexas.edu")
  CLX and Xlib have very similar interfaces.  My guess is that CLX is a
  "copy" of Xlib except that it is written in Lisp rather than C.
  (This does not mean that the actual calling sequences are identical,
  but conceptually they are the same.)  CLX is a lot bigger and a lot
  slower than Xlib in my experience.  And XGCL provides a higher-level
  interface than either CLX or Xlib.
  Regards, Gordon
  ------------------


Bummer.  I was hoping you were going to say that you'd taken advantage
of GCL's C-friendliness to reimplement CLX as a set of direct calls to
Xlib rather than emulating Xlib's functionality in Lisp.  I could have
used that immediately, because I have a family of apps that are
CLX-dependent.

I'll look at XGCL the next time I start a project from scratch.

Cheers, B.


From lnm@stsn.dga.fr  Tue Mar 28 10:32:13 1995
Return-Path: <lnm@stsn.dga.fr>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01332; Tue, 28 Mar 95 10:32:13 CST
Received: from asterix.stsn.dga.fr (mailhost.stsn.dga.fr) by cli.com (4.1/SMI-4.1)
	id AA27476; Tue, 28 Mar 95 09:11:03 CST
Received: (from lnm@localhost) by asterix.stsn.dga.fr (8.6.9/8.6.9) id RAA02287; Tue, 28 Mar 1995 17:10:31 +0100
Date: Tue, 28 Mar 1995 17:10:31 +0100
From: LIGNON Marc  <lnm@stsn.dga.fr>
Message-Id: <199503281610.RAA02287@asterix.stsn.dga.fr>
To: gcl@cli.com
Subject: Re: Pb with Xgcl on solaris


> My guess is that you could remake putting in h/solaris.h
> #define shifts shifts_p
> to avoid the name conflict, with the definition in libnsl.a

Less elegant, but I tried renaming all "shifts" in GCL and it
overpassed THAT step all right... But trying it out I got:

client13:/commun/bdt/src/Trajecto 501 > Xgcl
GCL (GNU Common Lisp)  Version(1.1) Mon Mar 27 14:46:37 MET DST 1995
Licensed under GNU Public Library License
Contains Enhancements by W. Schelter
Loading init.lsp
Finished loading init.lsp

>(in-package "XLIB")
#<"XLIB" package>

XLIB>(Xinit)
calling 'dl' function sun did not supply..exitting
client13:/commun/bdt/src/Trajecto 502 > 

In file run_process.c at line 300, we find :

#ifdef __svr4__
getpagesize()
{ return PAGESIZE;
}

dlclose()
{fprintf(stderr,"calling 'dl' function sun did not supply..exitting") ;exit(1);}
dgettext()
{dlclose();}
dlopen()
{dlclose();}
dlerror()
{dlclose();}

dlsym()
{dlclose();}

It concerns dynamic linking... but the image was compiled with "gcc -static" 
(=> static linking), so I don't understand what's happening...

Moreover, I found problems interfacing C and lisp at GCL level which
is the subject of a new mail : Pb interfacing C and Lisp on solaris

A bientot,

Marc LIGNON
________________________________________________________________________
DGA/DCN/ST/DA/S/ES			lignon@stsn.dga.fr
8, boulevard Victor			tel: (33)(1) 40.59.13.14
75015 - PARIS - FRANCE			fax: (33)(1) 45.79.20.40


From lnm@stsn.dga.fr  Tue Mar 28 10:36:42 1995
Return-Path: <lnm@stsn.dga.fr>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01336; Tue, 28 Mar 95 10:36:42 CST
Received: from asterix.stsn.dga.fr (mailhost.stsn.dga.fr) by cli.com (4.1/SMI-4.1)
	id AA27497; Tue, 28 Mar 95 09:19:39 CST
Received: (from lnm@localhost) by asterix.stsn.dga.fr (8.6.9/8.6.9) id RAA02302; Tue, 28 Mar 1995 17:19:17 +0100
Date: Tue, 28 Mar 1995 17:19:17 +0100
From: LIGNON Marc  <lnm@stsn.dga.fr>
Message-Id: <199503281619.RAA02302@asterix.stsn.dga.fr>
To: gcl@cli.com
In-Reply-To: <9503272209.AA11119@nicolas.ma.utexas.edu> (wfs@fireant.ma.utexas.edu)
Subject: Pb interfacing C and Lisp on solaris


Again solaris...
The basic "silly" exemple from the manual which works perfectly on a
sun4 (Sparc2) doesn't on a solaris (Sparc10):

$cat silly.lsp

(defCfun "silly(x) int x;" 0
%        int y;
         ((+ (int x) (int "100")) (int y))
%        printf("\n%d", y);
%        y = y+100;
	 (print (int y))
	 (print (int "x+100"))
%	 return(y);
	 )

(defentry foo (int) (int silly))

$gcl
GCL (GNU Common Lisp)  Version(1.1) Tue Mar 28 15:45:26 MET DST 1995
Licensed under GNU Public Library License
Contains Enhancements by W. Schelter
Loading init.lsp
Finished loading init.lsp

>(compile-file "silly.lsp")
Compiling silly.lsp.
End of Pass 1.  
End of Pass 2.  
OPTIMIZE levels: Safety=1 (No runtime error checking), Space=0, Speed=3
Finished compiling silly.lsp.
#"silly.o"

>(load "silly.o")
Loading silly.o
[unknown global sym silly]start address -T 2a7c28 Finished loading silly.o
608

>(foo 3)
Segmentation Fault - core dumped


What we see when we load it is : [unknown global sym silly]
So it seams to be a linking problem on solaris. 
Does anyone (perhaps Bill is better placed) have an idea where to
surch to repair this pb?

Thanx and
A bientot,

Marc LIGNON
________________________________________________________________________
DGA/DCN/ST/DA/S/ES			lignon@stsn.dga.fr
8, boulevard Victor			tel: (33)(1) 40.59.13.14
75015 - PARIS - FRANCE			fax: (33)(1) 45.79.20.40


From wfs@math.utexas.edu  Tue Mar 28 11:00:27 1995
Return-Path: <wfs@math.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01341; Tue, 28 Mar 95 11:00:27 CST
Received: from fireant.ma.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA27606; Tue, 28 Mar 95 09:54:37 CST
Received: from nicolas.ma.utexas.edu by fireant.ma.utexas.edu (5.64/5.51)
	id AA25554; Tue, 28 Mar 95 09:53:47 -0600
Date: Tue, 28 Mar 95 09:53:38 -0600
From: wfs@math.utexas.edu (Bill Schelter)
Posted-Date: Tue, 28 Mar 95 09:53:38 -0600
Message-Id: <9503281553.AA11918@nicolas.ma.utexas.edu>
Received: by nicolas.ma.utexas.edu (5.61/5.51)
	id AA11918; Tue, 28 Mar 95 09:53:38 -0600
To: gcl@cli.com
Cc: lnm@stsn.dga.fr
In-Reply-To: LIGNON Marc's message of Tue, 28 Mar 1995 17:10:31 +0100 <199503281610.RAA02287@asterix.stsn.dga.fr>
Subject: Re: Pb with Xgcl on solaris
Reply-To: wfs@math.utexas.edu


    (defCfun "silly(x) int x;" 0
    %        int y;
	     ((+ (int x) (int "100")) (int y))
    %        printf("\n%d", y);
    %        y = y+100;
	     (print (int y))
	     (print (int "x+100"))

you might try

    (defCfun "static int silly(x) int x;" 0
    ...)

The loader is really designed for the output from the compiler.  That
has all functions being static (ie definitions not visible outside)
the file.  In fact you cant reference them outside the file, even if
you make them global, since they wont be in the main symbol table, and
I dont add them to my local entries.  On ordinary BSD .o files, the
load is ok whether they are static or not.

hmmm

    XLIB>(Xinit)
    calling 'dl' function sun did not supply..exitting
    client13:/commun/bdt/src/Trajecto 502 > 

this means you are somehow invoking something that is invoking something
that is trying to load a shared library.

This is not supported,
since then saving an image and knowing where they mapped the library etc
is too system specific.   Try to make sure you have -static on the link
line (in the make in the unixport directory).

I know for example that the yp stuff causes a problem, and in the new
release I will have to work around this on solaris.  For some reason
sun does not give non shared versions of some yp referenced stuff.   One
sees this in reference to "~joe/.." paths in solaris.   I dont know
how to make the password lookup stuff work:  it seems to invoke loading
of shared libraries when invoked.    It would seem you are hitting
against a similar thing [perhaps the SAME thing].

Bill







From lnm@stsn.dga.fr  Wed Mar 29 10:15:23 1995
Return-Path: <lnm@stsn.dga.fr>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01625; Wed, 29 Mar 95 10:15:23 CST
Received: from asterix.stsn.dga.fr (mailhost.stsn.dga.fr) by cli.com (4.1/SMI-4.1)
	id AA01924; Wed, 29 Mar 95 08:51:18 CST
Received: (from lnm@localhost) by asterix.stsn.dga.fr (8.6.9/8.6.9) id QAA05780; Wed, 29 Mar 1995 16:50:53 +0100
Date: Wed, 29 Mar 1995 16:50:53 +0100
From: LIGNON Marc  <lnm@stsn.dga.fr>
Message-Id: <199503291550.QAA05780@asterix.stsn.dga.fr>
To: gcl@cli.com
Subject: Re: Pb interfacing C and Lisp on solaris


>     (defCfun "silly(x) int x;" 0
>     %        int y;
> 	     ((+ (int x) (int "100")) (int y))
>     %        printf("\n%d", y);
>     %        y = y+100;
> 	     (print (int y))
> 	     (print (int "x+100"))

> you might try

>     (defCfun "static int silly(x) int x;" 0
>     ...)

> The loader is really designed for the output from the compiler.  That
> has all functions being static (ie definitions not visible outside)
> the file.  In fact you cant reference them outside the file, even if
> you make them global, since they wont be in the main symbol table, and
> I dont add them to my local entries.  On ordinary BSD .o files, the
> load is ok whether they are static or not.

It works fine with the "static" declaration.
Thank's a lot.

Marc LIGNON
________________________________________________________________________
DGA/DCN/ST/DA/S/ES			lignon@stsn.dga.fr
8, boulevard Victor			tel: (33)(1) 40.59.13.14
75015 - PARIS - FRANCE			fax: (33)(1) 45.79.20.40


From reading@io.litton.com  Wed Mar 29 18:33:02 1995
Return-Path: <reading@io.litton.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01671; Wed, 29 Mar 95 18:33:02 CST
Received: from lcsdns1.litton.com by cli.com (4.1/SMI-4.1)
	id AA04691; Wed, 29 Mar 95 17:01:50 CST
Received: from io.dsd.litton.com by lcsdns1.litton.com (4.1/SMI-4.1)
	id AA02943; Wed, 29 Mar 95 14:57:48 PST
Received: by io.dsd.litton.com (Concentrix-2800 3.0/SMI-4.1)
	id AA07304; Wed, 29 Mar 95 15:00:20 PST
Date: Wed, 29 Mar 95 15:00:20 PST
From: John D. Reading <reading@io.dsd.litton.com>
Message-Id: <9503292300.AA07304@io.dsd.litton.com>
To: gcl@cli.com
Subject: pcl and Solaris 2

A couple of months ago I was running into troubles trying to build PCL
on Solaris 2.3.  Since then I have had some questions about what
success I had, but no other particular progress.  I find we are
shortly upgrading to Solaris 2.4 (I guess within days).  Has anyone
had any success with PCL and Solaris 2.3?  Will Solaris 2.4 make a
difference (for the better, preferably)?

Appreciate any help,

John

--
John D. Reading           | Why be difficult when with just a little more
reading@io.dsd.litton.com | effort you could be impossible?
(818) 597-5152            | 

From toy@rtp.ericsson.se  Sat Apr  1 18:58:57 1995
Return-Path: <toy@rtp.ericsson.se>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02996; Sat, 1 Apr 95 18:58:57 CST
Received: from gwa.ericsson.com by cli.com (4.1/SMI-4.1)
	id AA15100; Sat, 1 Apr 95 17:45:57 CST
Received: from mr2.exu.ericsson.se (mr2.exu.ericsson.com [138.85.147.12]) by gwa.ericsson.com (8.6.10/8.6.10) with ESMTP id RAA27261 for <gcl@cli.com>; Sat, 1 Apr 1995 17:45:56 -0600
Received: from screamer.rtp.ericsson.se (screamer.rtp.ericsson.se [147.117.133.13]) by mr2.exu.ericsson.se (8.6.8/NAHUB-MR1.1) with ESMTP id RAA08762 for <gcl@cli.com>; Sat, 1 Apr 1995 17:45:56 -0600
Received: from rcur (rcur7.rtp.ericsson.se [147.117.133.38]) by screamer.rtp.ericsson.se (8.6.8/8.6.4) with ESMTP id SAA21605 for <gcl@cli.com>; Sat, 1 Apr 1995 18:49:06 -0500
Message-Id: <199504012349.SAA21605@screamer.rtp.ericsson.se>
To: gcl@cli.com
Subject: Fix for reduce with :key
Date: Sat, 01 Apr 1995 18:45:48 -0500
From: Raymond Toy <toy@rtp.ericsson.se>

About a week ago, I posted a modified version of reduce that accepted
the keyword :key as specified in CLTL2.  Unfortunately, there is a bug
in that if no initial value (:initial-value) is given, the key is not
applied to the first element of the sequence.

The following is a fix for this so that the key function is applied.

Sorry if this caused problems.

Ray

(defun reduce (function sequence
			&key from-end
			start 
			end
			(initial-value nil ivsp)
			(key #'identity))
  (with-start-end  start end sequence
		   (cond ((not from-end)
			    (when (null ivsp)
			      (when (>= start end)
				(return-from reduce (funcall function)))
			      (setq initial-value (funcall key (elt sequence start)))
			      (setf start (f+ 1 start))
			      )
			    (do ((x initial-value
				    (funcall function x (funcall key (prog1 (elt sequence start)
							  (setf start (f+ 1 start))
							  )))))
				((>= start end) x)))
			 (t
			    (when (null ivsp)
			      (when (>= start end)
				(return-from reduce (funcall function)))
			      (setf end (f+ end -1))
			      (setq initial-value (funcall key (elt sequence end)))
			      )
			    (do ((x initial-value (funcall function
							   (funcall key (elt sequence end)) x)))
				((>= start end) x)
			      (setf end (f+ -1 end)))))))


From lien@tam.cs.monash.edu.au  Mon Apr 10 03:19:58 1995
Return-Path: <lien@tam.cs.monash.edu.au>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA04947; Mon, 10 Apr 95 03:19:58 CDT
Received: from tam.cs.monash.edu.au by cli.com (4.1/SMI-4.1)
	id AA08750; Mon, 10 Apr 95 01:56:39 CDT
Received: by tam.cs.monash.edu.au (5.67/1.37)
	id AA04758; Mon, 10 Apr 95 16:56:03 +1000
From: lien@tam.cs.monash.edu.au (Tam T. Lien)
Message-Id: <9504100656.AA04758@tam.cs.monash.edu.au>
To: gcl@cli.com
Cc: lien@tam.cs.monash.edu.au
Subject: GCL-1.1 on DOS
X-Mailer: exmh version 1.4.1 7/21/94
Date: Mon, 10 Apr 95 16:56:03 EST


Hello,

Has anyone got GCL-1.1 to compile with DJGCC under DOS?

Thanks,

Tam.


From back0003@gold.tc.umn.edu  Mon Apr 10 20:01:49 1995
Return-Path: <back0003@gold.tc.umn.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA05343; Mon, 10 Apr 95 20:01:49 CDT
Received: from gold.tc.umn.edu by cli.com (4.1/SMI-4.1)
	id AA11570; Mon, 10 Apr 95 18:58:09 CDT
Received: by gold.tc.umn.edu; Mon, 10 Apr 95 15:34:46 -0500
Date: Mon, 10 Apr 1995 15:34:46 -0500 (CDT)
From: Jan E Backlund <back0003@gold.tc.umn.edu>
Subject: ngcl-2.0beta on Slackware Linux
To: gcl@cli.com
Message-Id: <Pine.3.89.9504101506.A9532-0100000@gold.tc.umn.edu>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII


Has anyone built gcl-2.0 on Slackware Linux? I had one minor problem with 
u_int32_t not being defined in inet.h and then got as far as building the 
raw_gcl. Now I'm stuck with deciphering why saved_gcl is not executable 
(I've appended the tail end of the make log). Can anyone give me a clue?

Jan Erik
back0003@gold.tc.umn.edu


-------------      Tail end of "make &> error.log"       -----------------

make install-command "INSTALL_LIB_DIR=/usr/local/src/gcl-2.0" "PREFIX_DIR=/usr/local/src/gcl-2.0"
make[2]: Entering directory `/usr/local/src/gcl-2.0'
(echo "#!/bin/sh" ; \
echo exec /usr/local/src/gcl-2.0/unixport/saved_gcl \\ ; \
echo '   -dir' /usr/local/src/gcl-2.0/unixport/ \\ ; \
echo '   -libdir' /usr/local/src/gcl-2.0/ \\ ; \
echo '   -eval '\''(setq si::*allow-gzipped-file* t)'\' \\ ;\
echo '   -eval '\''(setq si::*tk-library* '\"unknown\"')'\' \\;\
echo '     '\"\$@\" ) > /usr/local/src/gcl-2.0/bin/gcl;
echo '#' other options: -load "/tmp/foo.o" -load "jo.lsp" -eval '"(joe 3)"' >> /usr/local/src/gcl-2.0/bin/gcl
chmod a+x /usr/local/src/gcl-2.0/bin/gcl
make[2]: Leaving directory `/usr/local/src/gcl-2.0'
(cd xbin ; ln -s ../bin/gcl .)
make[1]: Leaving directory `/usr/local/src/gcl-2.0'
(cd  cmpnew ; make collectfn.o)
make[1]: Entering directory `/usr/local/src/gcl-2.0/cmpnew'
../unixport/saved_gcl ../unixport/ -compile collectfn.lsp
../unixport/saved_gcl: ../unixport/saved_gcl: cannot execute binary file
make[1]: *** [collectfn.o] Error 126
make[1]: Leaving directory `/usr/local/src/gcl-2.0/cmpnew'
make: *** [all] Error 2


From wfs@math.utexas.edu  Mon Apr 10 22:52:47 1995
Return-Path: <wfs@math.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA05408; Mon, 10 Apr 95 22:52:47 CDT
Received: from fireant.ma.utexas.edu by cli.com (4.1/SMI-4.1)
	id AA11799; Mon, 10 Apr 95 21:32:30 CDT
Received: from nicolas.ma.utexas.edu by fireant.ma.utexas.edu (5.64/5.51)
	id AA09320; Mon, 10 Apr 95 21:32:14 -0500
Date: Mon, 10 Apr 95 21:32:06 -0500
From: wfs@math.utexas.edu (Bill Schelter)
Posted-Date: Mon, 10 Apr 95 21:32:06 -0500
Message-Id: <9504110232.AA07461@nicolas.ma.utexas.edu>
Received: by nicolas.ma.utexas.edu (5.61/5.51)
	id AA07461; Mon, 10 Apr 95 21:32:06 -0500
To: back0003@gold.tc.umn.edu
Cc: gcl@cli.com
In-Reply-To: Jan E Backlund's message of Mon, 10 Apr 1995 15:34:46 -0500 (CDT) <Pine.3.89.9504101506.A9532-0100000@gold.tc.umn.edu>
Subject: ngcl-2.0-beta.tgz vs gcl-2.0.tgz
Reply-To: wfs@math.utexas.edu


I certainly have been doing development of gcl-2.0 on slackware linux,
so it should work!

You probably need to take the latest released version which is
ftp.cli.com:pub/gcl/gcl-2.0.tgz or ftp.ma.utexas.edu:...

I am using linux 1.2.1 gcc 2.6.3, and it should work.

The ngcl-2.0-beta.tgz worked in an older version of linux, but the
executable format changed slightly.

In any event there are other benefits to gcl-2.0, over the beta
version.  Among other things the socket connection stuff for the
windowing has been substantially improved to avoid broken pipes.

Bill




From mjs@s4mjs.shannon.com  Tue Apr 11 03:50:39 1995
Return-Path: <mjs@s4mjs.shannon.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA05490; Tue, 11 Apr 95 03:50:39 CDT
Received: from cnj.digex.net by cli.com (4.1/SMI-4.1)
	id AA12510; Tue, 11 Apr 95 02:36:37 CDT
Received: from s4mjs (shannon.com) by cnj.digex.net with SMTP id AA14474
  (5.67b8/IDA-1.5 for <gcl@cli.com>); Tue, 11 Apr 1995 03:36:32 -0400
Received: by s4mjs (5.x/SMI-SVR4-mjs-950410)
	id AA02325; Mon, 10 Apr 1995 23:25:07 -0400
Date: Mon, 10 Apr 1995 23:25:07 -0400
From: mjs@s4mjs.shannon.com (marty shannon)
Message-Id: <9504110325.AA02325@s4mjs>
To: gcl@cli.com
Subject: Solaris 2.4 X86 vs. gcl 1
Reply-To: mjs@s4mjs.shannon.com
X-Sun-Charset: US-ASCII

In a nutshell, it doesn't build.  I can't figure out the right things
to set in the defs and h file (and Solaris 2.4 does *not* want to
build anything static -- as far as I can tell; clues on that would be
appreciated, too).  Has anyone done this?  BTW, "Solaris" is an operating
system, not a "platform".  Solaris (currently) is available for both
Sparc and X86 processors....

	Marty Shannon

From leverich@rand.org  Tue Apr 11 17:28:51 1995
Return-Path: <leverich@rand.org>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA05726; Tue, 11 Apr 95 17:28:51 CDT
Received: from rand.org by cli.com (4.1/SMI-4.1)
	id AA14652; Tue, 11 Apr 95 15:47:56 CDT
Received: from monty.rand.org (monty-cc.rand.org [130.154.8.173]) by rand.org (8.6.10/8.6.10) with ESMTP id NAA22295 for <gcl@cli.com>; Tue, 11 Apr 1995 13:47:45 -0700
Received: from atlantis.rand.org (atlantis.rand.org [130.154.12.124]) by monty.rand.org (8.6.10/8.6.10) with ESMTP id NAA17525 for <gcl@cli.com>; Tue, 11 Apr 1995 13:47:44 -0700
Received: from localhost.rand.org (localhost.rand.org [127.0.0.1]) by atlantis.rand.org (8.6.10/8.6.10) with SMTP id NAA11641 for <gcl@cli.com>; Tue, 11 Apr 1995 13:47:43 -0700
Message-Id: <199504112047.NAA11641@atlantis.rand.org>
To: gcl@cli.com
Reply-To: Brian_Leverich@rand.org
Subject: GCL-2.0 Breaks CLX
Date: Tue, 11 Apr 95 13:47:40 PDT
From: Brian Leverich <leverich@rand.org>


The new socket code (and the TK interface) is way cool, but it breaks
CLX in a couple of ways.  Also, it looks like the new socket code
might allow some improvements in CLX performance.

Any chance that one of the folks familiar with the socket code could
be persuaded to hack CLX to fix the breakage and best exploit the new
code?

It would improve compatibility with existing apps ...

Thanks, B.

---------
Dr. Brian Leverich
Informations Systems Scientist
The RAND Corporation

From jsc@esther.mit.edu  Wed Apr 12 23:21:48 1995
Return-Path: <jsc@esther.mit.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA06134; Wed, 12 Apr 95 23:21:48 CDT
Received: from esther.mit.edu by cli.com (4.1/SMI-4.1)
	id AA19409; Wed, 12 Apr 95 22:17:20 CDT
Received: by esther.mit.edu id AA06628
  (5.67b/IDA-1.5 for gcl@cli.com); Wed, 12 Apr 1995 23:17:50 -0400
Date: Wed, 12 Apr 1995 23:17:50 -0400
From: jsc@esther.mit.edu
Message-Id: <199504130317.AA06628@esther.mit.edu>
To: gcl@cli.com
Subject: bugs in gcl-1.1
Reply-To: jsc@mit.edu

I recently tried recompiling gcl 1.1 under Linux 1.2.3 using the latest
ELF gcc compiler for that platform. This uncovered a few bugs.

386-linux.h should define DONT_NEED_MALLOC.

Here is a backtrace from a segfault:
#0  0x800357c in alloc_object (t=t_string) at ../c/alloc.c:201
#1  0x80443fd in alloc_simple_string (l=0) at ../c/string.d:41
#2  0x801eb9a in init_symbol () at ../c/symbol.d:616
#3  0x8001c22 in initlisp () at ../c/main.c:409
#4  0x80019d9 in main (argc=1, argv=0xbffffbd0, envp=0xbffffbd8)
    at ../c/main.c:275

The problem is Vignore_maximum_pages gets referenced at this point, but
isn't ever set except in init_alloc_function(), which gets called in
initlisp() *after* init_symbol() gets called.

I tried to work around this, but it turns out that Vignore_maximum_pages
gets set using make_special(), which depends on string_register, which
gets set using alloc_simple_string(), which depends on
Vignore_maximum_pages. 

This compiled fine under gcc 2.6.3, so I can only assume that some
default initialization behavior or something changed. Anyways, at a
quick glance this looks wrong. Please let me know if it is indeed
incorrect, or if I've just overlooked something.


On an entirely different subject, does anyone know if CLX and garnet
work under gcl?

-Jin

PS Please Cc any replies to the mailing list directly to me as well, as
I've only recently joined.

From leverich@rand.org  Thu Apr 13 02:19:42 1995
Return-Path: <leverich@rand.org>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA06163; Thu, 13 Apr 95 02:19:42 CDT
Received: from rand.org by cli.com (4.1/SMI-4.1)
	id AA19953; Thu, 13 Apr 95 01:01:34 CDT
Received: (from Uclarita@localhost) by rand.org (8.6.10/8.6.10) with UUCP id XAA08971; Wed, 12 Apr 1995 23:01:25 -0700
Received: (from leverich@localhost) by saugus.rand.org (8.6.9/8.6.9) id WAA02174; Wed, 12 Apr 1995 22:58:11 -0700
From: Brian Leverich <leverich@rand.org>
Message-Id: <199504130558.WAA02174@saugus.rand.org>
Subject: Re: bugs in gcl-1.1
To: jsc@mit.edu
Date: Wed, 12 Apr 1995 22:58:11 -0700 (PDT)
Cc: gcl@cli.com, leverich@rand.org
In-Reply-To: <199504130317.AA06628@esther.mit.edu> from "jsc@esther.mit.edu" at Apr 12, 95 11:17:50 pm
Organization: RAND, Santa Monica, CA
Reply-To: Brian_Leverich@rand.org
X-Mailer: ELM [version 2.4 PL23]
Content-Type: text
Content-Length: 1215      



> On an entirely different subject, does anyone know if CLX and garnet
> work under gcl?
> 
> -Jin

They did.  )-8

If you use GCL-1.0 or 1.1, anonymous ftp to 
	ftp://rand.org/pub/leverich
and check out the clx and garnet you'll find there.  Mike Harm
(USC/RAND) and my port of garnet is a little crufty, but it mostly
works.

Preallocate some extra memory, or you'll be living in GC hell.
General performance of GCL/CLX/garnet is satisfactory on a Linux
486DX2-66, satisfactory on a SPARC 2, and primo on a HP 735.

We've also integrated RAND's ROSS simulation language with garnet's
KR object system, and we're currently working on a GUI for general
use with ROSS.

Anyway, the new socket code in GCL-2.0 sort of gratuitously breaks
CLX.  I'm hoping somebody who knows what they're doing (this is a
thinly veiled canonical beg and grovel) will release a CLX that's
compatible with the new socket code.  If no kind soul will do that,
I'll eventually do it myself (but don't hold your breath waiting, and
it won't be as nicely done as it could have been by somebody who has
expertise in the area).  Cheers, B.


----------
Dr. Brian Leverich
Information Systems Scientist, The RAND Corporation
leverich@rand.org

From jsc@gwar.mit.edu  Thu Apr 13 21:47:25 1995
Return-Path: <jsc@gwar.mit.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA06528; Thu, 13 Apr 95 21:47:25 CDT
Received: from gwar.mit.edu by cli.com (4.1/SMI-4.1)
	id AA22740; Thu, 13 Apr 95 20:34:53 CDT
Received: by gwar.mit.edu id AA00555
  (5.67b/IDA-1.5 for gcl@cli.com); Thu, 13 Apr 1995 21:34:52 -0400
Date: Thu, 13 Apr 1995 21:34:52 -0400
From: "Jin S. Choi" <jsc@gwar.mit.edu>
Message-Id: <199504140134.AA00555@gwar.mit.edu>
To: gcl@cli.com
Subject: gcl 2.0 and Linux w/ ELF


I pulled over gcl 2.0 and tried to get it running under Linux w/ ELF.

1) Again, DONT_NEED_MALLOC has to be defined.
2) Compiling mpi-386d.o fails with undefined symbols, must use mpi.o.

3) raw_gcl dies on startup in alloc_object(), again because
   sSAignore_maximum_pagesA is referenced before being used in line
   223 of alloc.c. It's declared to be an object in a DEFVAR macro at
   the top of this file, but the macro that gets used is the one in
   notcomp.h, which just declares it as an `object' (a pointer).

Has anyone else run into this problem? It would appear to be a general
one...

From bslawson@phobos.astro.uwo.ca  Mon Apr 17 18:15:59 1995
Return-Path: <bslawson@phobos.astro.uwo.ca>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00204; Mon, 17 Apr 95 18:15:59 CDT
Received: from phobos.astro.uwo.ca by cli.com (4.1/SMI-4.1)
	id AA01993; Mon, 17 Apr 95 16:52:10 CDT
Message-Id: <9504172149.AA03593@phobos.astro.uwo.ca>
Date: Mon, 17 Apr 1995 17:49:18 +0500
From: bslawson@phobos.astro.uwo.ca (Bob Slawson)
To: gcl@cli.com
Subject: bug in gcl-2.0 : aref
Reply-To: bslawson@phobos.astro.uwo.ca
Content-Length: 962


There is a bug in aref when accessing arrays with rank > 1.

Transcript:

GCL (GNU Common Lisp)  Version(2.0) Mon Apr 17 14:07:56 EDT 1995
Licensed under GNU Public Library License
Contains Enhancements by W. Schelter

>*features*
(:COMPILER :NUMLIB :SDEBUG TRUNCATE_USE_C BSD SPARC SUN SGC
    IEEE-FLOATING-POINT UNIX GCL AKCL COMMON KCL)

>(defvar test-array (make-array '(2 3) :initial-element 0))
TEST-ARRAY

>test-array
#2A((0 0 0) (0 0 0))

>(setf (aref test-array 1 1) 4)
4

>test-array
#2A((0 0 0) (0 4 0))

--- This looks OK

>(aref test-array 1 1)
0

--- Ooops!

>(setf (aref test-array 0 0) 9)
9

>test-array
#2A((9 0 0) (0 4 0))

--- This is OK too.

>(aref test-array 0 1)
9

--- Oops should be 0

>(aref test-array 2 0)
0

--- Should be an errror!

>(setf (aref test-array 2 0) 20)

Error: Index 0 to array is too large
Fast links are on: do (use-fast-links nil) for debugging
Error signalled by EVAL.
Broken at SETF.  Type :H for Help.
>>

BobS

From wfs@math.utexas.edu  Tue Apr 18 01:45:24 1995
Return-Path: <wfs@math.utexas.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00480; Tue, 18 Apr 95 01:45:24 CDT
Received: from parthenon.ma.utexas.edu (parthenon.pi.ma.utexas.edu) by cli.com (4.1/SMI-4.1)
	id AA02784; Tue, 18 Apr 95 00:33:05 CDT
Received: (from wfs@localhost) by parthenon.ma.utexas.edu (8.6.10/8.6.10) id AAA10754; Tue, 18 Apr 1995 00:31:56 -0500
Date: Tue, 18 Apr 1995 00:31:56 -0500
From: Bill Schelter <wfs@math.utexas.edu>
Message-Id: <199504180531.AAA10754@parthenon.ma.utexas.edu>
To: gcl@cli.com
Subject: patch for 2.0
Reply-To: wfs@fireant.ma.utexas.edu


Here is a patch for the multidimensional array aref bug, for
./saved_gcl -compile, and for the gcl-2.0/makefile in case you do not
have tcl/tk or X.

There will be a new release shortly but in the meantime:

To apply the patch do
% cd gcl-2.0/..
% patch -p < patch-1
% (cd gcl-2.0 ; make)

==================begin patch-1===============================
*** /tmp/gcl-2.0/makefile	Sun Apr  9 22:14:48 1995
--- gcl-2.0/makefile	Thu Apr 13 12:42:22 1995
***************
*** 106,112 ****
  	then echo "Make of GCL `cat majvers`.`cat minvers` completed." ; \
  	xbin/notify "CC=${CC}" ; \
  	else echo "The new image failed to compile collectfn.lsp" ;fi
! 	if [ "${X11_LIBS}" != unknown ] ; then if [ "${TK_LIBS}" != unknown ]; \
  	then (cd gcl-tk ; make) ; fi ; fi
  	(cd info ; make)
  
--- 109,115 ----
  	then echo "Make of GCL `cat majvers`.`cat minvers` completed." ; \
  	xbin/notify "CC=${CC}" ; \
  	else echo "The new image failed to compile collectfn.lsp" ;fi
! 	if [ "${X11_LIBS}" != "-Lunknown -lX11" ] ; then if [ "${TK_LIBS}" != "-Lunknown -ltk" ]; \
  	then (cd gcl-tk ; make) ; fi ; fi
  	(cd info ; make)
  
*** /tmp/gcl-2.0/o/array.c	Sat Mar  4 07:50:37 1995
--- gcl-2.0/o/array.c	Tue Apr 18 00:13:12 1995
***************
*** 70,76 ****
         FEerror(" ~a has wrong rank",x);
       if (rank == 1) return fSaref1(x,i);
       va_start(ap);
!      m = 0;
       k = i;
       /* index into 1 dimensional array */
       i1 = 0;
--- 70,76 ----
         FEerror(" ~a has wrong rank",x);
       if (rank == 1) return fSaref1(x,i);
       va_start(ap);
!      m = 1;
       k = i;
       /* index into 1 dimensional array */
       i1 = 0;
***************
*** 80,86 ****
  	 if (k > x->a.a_dims[m])
  	   FEerror("Index ~a to array is too large",1,make_fixnum (m));
  	 i1 += k;
! 	 if (m < rank)
  	   { i1 = i1 * x->a.a_dims[m];
  	     if (m < N_FIXNUM_ARGS)
  	       { k = va_arg(ap,int);}
--- 80,86 ----
  	 if (k > x->a.a_dims[m])
  	   FEerror("Index ~a to array is too large",1,make_fixnum (m));
  	 i1 += k;
! 	 if (m <= rank)
  	   { i1 = i1 * x->a.a_dims[m];
  	     if (m < N_FIXNUM_ARGS)
  	       { k = va_arg(ap,int);}
***************
*** 87,96 ****
  	     else {object x = va_arg(ap,object);
  		   check_type(x,t_fixnum);
  		   k = Mfix(x);}
! 	     m++;}
  	 else break;}
       va_end(ap);
!      return fSaref1(x,i);
     }
    if (n > 2)
      { FEerror("Too many args (~a) to aref",1,make_fixnum(n));}
--- 87,97 ----
  	     else {object x = va_arg(ap,object);
  		   check_type(x,t_fixnum);
  		   k = Mfix(x);}
! 	     m++;
! 	   }
  	 else break;}
       va_end(ap);
!      return fSaref1(x,i1);
     }
    if (n > 2)
      { FEerror("Too many args (~a) to aref",1,make_fixnum(n));}
*** /tmp/gcl-2.0/unixport/init_gcl.lsp	Sat Apr  1 19:47:23 1995
--- gcl-2.0/unixport/init_gcl.lsp	Wed Apr 12 15:50:20 1995
***************
*** 54,66 ****
  			       :output-file 
  			       (or (si::get-command-arg "-o")
  				   (si::get-command-arg "-compile"))
! 			       :o-file (not
! 					(or (equalp
  					     (si::get-command-arg "-o-file")
! 					       "nil")
! 					    (not (si::get-command-arg "-no-o"
! 								      t)))
! 					)
  			       :c-file (si::get-command-arg "-c-file" t)
  			       :h-file (si::get-command-arg "-h-file" t)
  			       :data-file (si::get-command-arg "-data-file" t)
--- 54,65 ----
  			       :output-file 
  			       (or (si::get-command-arg "-o")
  				   (si::get-command-arg "-compile"))
! 			       :o-file
! 			       (cond ((equalp
  					     (si::get-command-arg "-o-file")
! 					       "nil") nil)
! 				     ((si::get-command-arg "-o-file" t))
! 				     (t t))
  			       :c-file (si::get-command-arg "-c-file" t)
  			       :h-file (si::get-command-arg "-h-file" t)
  			       :data-file (si::get-command-arg "-data-file" t)

------------------------------end patch-1 ----------------

From gene@ccs.neu.edu  Tue Apr 18 14:38:34 1995
Return-Path: <gene@ccs.neu.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00627; Tue, 18 Apr 95 14:38:34 CDT
Received: from amber.ccs.neu.edu by cli.com (4.1/SMI-4.1)
	id AA04006; Tue, 18 Apr 95 13:00:33 CDT
Received: from highpoint.ccs.neu.edu (gene@highpoint.ccs.neu.edu [129.10.112.80])
	by amber.ccs.neu.edu (8.6.10/8.6.4) with ESMTP id OAA15258; Tue, 18 Apr 1995 14:00:28 -0400
From: Gene Cooperman <gene@ccs.neu.edu>
Received: (gene@localhost)
	by highpoint.ccs.neu.edu (8.6.10/8.6.4) id OAA16854; Tue, 18 Apr 1995 14:00:27 -0400
Date: Tue, 18 Apr 1995 14:00:27 -0400
Message-Id: <199504181800.OAA16854@highpoint.ccs.neu.edu>
To: gcl@cli.com, wfs@fireant.ma.utexas.edu
Subject: Re:  another make-array bug ?

I encountered another make-array bug for arrays of rank 1.  I don't know
if this is covered by the previous patch, but I would guess it's different.
When I type:

(make-array 256 :element-type 'fixnum ":fill-pointer t)

I get an error:

Correctable error: Expected a FIXNUM 
Signalled by EVAL.
If continued: Supply right type
Broken at MAKE-ARRAY.  Type :H for Help.


When I type:

(make-array 256 :element-type 'fixnum ":fill-pointer 5)

it results in an infinite loop.
						- Gene Cooperman

From bslawson@phobos.astro.uwo.ca  Tue Apr 18 23:09:47 1995
Return-Path: <bslawson@phobos.astro.uwo.ca>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00724; Tue, 18 Apr 95 23:09:47 CDT
Received: from phobos.astro.uwo.ca by cli.com (4.1/SMI-4.1)
	id AA05291; Tue, 18 Apr 95 22:01:42 CDT
Message-Id: <9504190258.AA25164@phobos.astro.uwo.ca>
Date: Tue, 18 Apr 1995 22:58:37 +0500
From: bslawson@phobos.astro.uwo.ca (Bob Slawson)
To: wfs@fireant.ma.utexas.edu
Cc: gcl@cli.com
In-Reply-To: <199504180531.AAA10754@parthenon.ma.utexas.edu> (message from Bill Schelter on Tue, 18 Apr 1995 00:31:56 -0500)
Subject: Re: patch for 2.0
Reply-To: bslawson@phobos.astro.uwo.ca
Content-Length: 2603

Patch-1 didn't seem to fix the aref problem so I worked on it myself.
It's been tested with interpreted forms and compiled code at all
possible safety levels.

A context diff follows (it applies on top of patch-1).

I don't understand the necessity of changing the flag in the DEFUN
("AREF1" ... from ONE_VAL to NONE, but this is what was necessary for
aref to work in compiled code.  I merely paralleled the DEFUN with
DEFUN ("ASET1".  (All compiled code I tried calls `fSaref1'
irrespective of safety level because of a macro in `cmpinclude.h').

BobS
-------------------------------------------------
*** o/array.c-patchd-1	Tue Apr 18 21:49:05 1995
--- o/array.c	Tue Apr 18 22:08:38 1995
***************
*** 59,65 ****
  (x, i, va_alist)
    object x;
    int i;
! 
  { int n = VFUN_NARGS;
    int i1;
    va_list ap;
--- 59,65 ----
  (x, i, va_alist)
    object x;
    int i;
!   va_dcl
  { int n = VFUN_NARGS;
    int i1;
    va_list ap;
***************
*** 70,76 ****
         FEerror(" ~a has wrong rank",x);
       if (rank == 1) return fSaref1(x,i);
       va_start(ap);
!      m = 1;
       k = i;
       /* index into 1 dimensional array */
       i1 = 0;
--- 70,76 ----
         FEerror(" ~a has wrong rank",x);
       if (rank == 1) return fSaref1(x,i);
       va_start(ap);
!      m = 0;
       k = i;
       /* index into 1 dimensional array */
       i1 = 0;
***************
*** 77,85 ****
       rank-- ;
       while(1) 
         {
! 	 if (k > x->a.a_dims[m])
  	   FEerror("Index ~a to array is too large",1,make_fixnum (m));
  	 i1 += k;
  	 if (m <= rank)
  	   { i1 = i1 * x->a.a_dims[m];
  	     if (m < N_FIXNUM_ARGS)
--- 77,86 ----
       rank-- ;
       while(1) 
         {
! 	 if (k >= x->a.a_dims[m])
  	   FEerror("Index ~a to array is too large",1,make_fixnum (m));
  	 i1 += k;
+ 	 m++;
  	 if (m <= rank)
  	   { i1 = i1 * x->a.a_dims[m];
  	     if (m < N_FIXNUM_ARGS)
***************
*** 87,93 ****
  	     else {object x = va_arg(ap,object);
  		   check_type(x,t_fixnum);
  		   k = Mfix(x);}
- 	     m++;
  	   }
  	 else break;}
       va_end(ap);
--- 88,93 ----
***************
*** 131,137 ****
  }
      
  DEFUN("AREF1", object, fSaref1, SI, 2, 2,
!       ONE_VAL, OO, IO, OO,OO,
        "For array X and index I it returns (aref x i) as if x were \
  1 dimensional, even though its rank may be bigger than 1")
  (x, i)
--- 131,137 ----
  }
      
  DEFUN("AREF1", object, fSaref1, SI, 2, 2,
!       NONE, OO, IO, OO,OO,
        "For array X and index I it returns (aref x i) as if x were \
  1 dimensional, even though its rank may be bigger than 1")
  (x, i)

From bf@next.ipl.fr  Wed Apr 19 04:44:42 1995
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00962; Wed, 19 Apr 95 04:44:42 CDT
Received: from cpe.ipl.fr by cli.com (4.1/SMI-4.1)
	id AA05979; Wed, 19 Apr 95 03:26:20 CDT
Return-Path: bf@next.ipl.fr
Received: from next.ipl.fr (next.ipl.fr [193.48.221.6]) by cpe.ipl.fr (8.6.5/8.6.5) with SMTP id KAA03268 for <gcl@cli.com>; Wed, 19 Apr 1995 10:25:40 +0100
Received-Date: Wed, 19 Apr 1995 10:25:40 +0100
Received: by next.ipl.fr (NX5.67e/NX3.0S)
	id AA00428; Wed, 19 Apr 95 09:22:23 +0100
Date: Wed, 19 Apr 95 09:22:23 +0100
From: Beatrice Fuchs <bf@next.ipl.fr>
Message-Id: <9504190822.AA00428@next.ipl.fr>
Received: by NeXT.Mailer (1.100)
Received: by NeXT Mailer (1.100)
To: gcl@cli.com
Subject: unsubscribe


Please, remove my address from the mailing list.


Bests regards

Beatrice Fuchs--
Beatrice  Fuchs,          CPE LYON,  Laboratoire LISA,|
31, Place Bellecour,      F-69288 Lyon Cedex 02       |
bf@cpe.ipl.fr             Tel : (33) 72 32 50 63      |
--------------------------------------------------------------------------------

From pw@snoopy.mv.com  Sat Apr 22 20:28:37 1995
Return-Path: <pw@snoopy.mv.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02363; Sat, 22 Apr 95 20:28:37 CDT
Received: from snoopy.mv.com by cli.com (4.1/SMI-4.1)
	id AA16054; Sat, 22 Apr 95 19:23:39 CDT
Received: (from pw@localhost) by snoopy.mv.com (8.6.9/8.6.6) id TAA27534; Sat, 22 Apr 1995 19:54:14 -0400
Date: Sat, 22 Apr 1995 19:54:14 -0400
From: "Paul F. Werkowski" <pw@snoopy.mv.com>
Message-Id: <199504222354.TAA27534@snoopy.mv.com>
To: gcl@cli.com
In-Reply-To: <9504190258.AA25164@phobos.astro.uwo.ca> (bslawson@phobos.astro.uwo.ca)
Subject: Re: patch for 2.0

>>>>> "Bob" == Bob Slawson <bslawson@phobos.astro.uwo.ca> writes:

    Bob> Patch-1 didn't seem to fix the aref problem so I worked on it
    Bob> myself.  It's been tested with interpreted forms and compiled
    Bob> code at all possible safety levels.

	Not wanting to confuse this issue more, but, having just
	grabbed the gcl-2.0 kit from its home along with patch
	and attempted to build it on FreeBSD 2.0. I found that
	while the unpatched installation built and ran OK  (except
	for possibly the array bug) but ANY patch to array.c resulted
	in
>Loading ../gcl-tk/tk-package.lsp
Finished loading ../gcl-tk/tk-package.lsp
T

>Initializing ../lsp/predlib.o
Initializing ../lsp/setf.o
Initializing ../lsp/arraylib.o
Initializing ../lsp/assert.o
Initializing ../lsp/defstruct.o

Error: ARRAY-HAS-FILL-POINTER-P is invalid as a function.
Error signalled by ADJUST-ARRAY.
Broken at BREAK-LEVEL.  Type :H for Help.
.
	To repeat:
	.  I can build a vanilla system no problem.
	.  Patch for no tcl/tk (part of patch-1) works  ok.
	.  Any of the changes to array.c produces the above abort.

	I don't have the time to persue this more right now.
	Please consider it a heads-up.

	Paul

From etokna@etn.ericsson.se  Mon Apr 24 04:10:35 1995
Return-Path: <etokna@etn.ericsson.se>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02845; Mon, 24 Apr 95 04:10:35 CDT
Received: from mailgate.ericsson.se by cli.com (4.1/SMI-4.1)
	id AA17821; Mon, 24 Apr 95 02:36:43 CDT
Received: from hisoy0 (hisoy0.etn.ericsson.se [193.161.188.2]) by mailgate.ericsson.se (8.6.11/1.0) with SMTP id JAA17681 for <gcl@cli.com>; Mon, 24 Apr 1995 09:36:28 +0200
Received: from hisoy1.etn.ericsson.se by hisoy0 (5.0/LME-DOM-2.2.3)
	id AA16226; Mon, 24 Apr 1995 09:36:46 +0200
From: etokna@etn.ericsson.se (Knut-Haavard Aksnes)
Received: by hisoy1.etn.ericsson.se (4.1/client-1.5)
	id AA12903; Mon, 24 Apr 95 09:34:01 +0200
Date: Mon, 24 Apr 95 09:34:01 +0200
Message-Id: <9504240734.AA12903@hisoy1.etn.ericsson.se>
To: gcl@cli.com
Subject: PCL for gcl-2.0
Comments: Hyperbole mail buttons accepted, v3.18.3.
Content-Length: 336

Has anybody had any success in building PCL for GCL-2.0?

-- 

-------------------------------------------------------------------------------
Name:	Knut-Hvard Aksnes (ECMA 94) or		Knut-Haavard Aksnes (ASCII)
Ericsson signature: HI/ETO/X/I KNA		Phone: +47 37 05 14 81
Email: etokna@hisoy.etn.ericsson.se (internet)  ETO.ETOKNA (memo)


From thorsten@arch.su.EDU.AU  Fri Apr 28 03:06:07 1995
Return-Path: <thorsten@arch.su.EDU.AU>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA04515; Fri, 28 Apr 95 03:06:07 CDT
Received: from arch.su.EDU.AU (archsci.arch.su.EDU.AU) by cli.com (4.1/SMI-4.1)
	id AA01283; Fri, 28 Apr 95 01:42:59 CDT
Received: from glass (glass.arch.su.EDU.AU) by arch.su.EDU.AU (4.1/SMI-4.1)
	id AA00544; Fri, 28 Apr 95 16:34:48 EST
From: thorsten@arch.su.EDU.AU (Thorsten Schnier)
Received: by glass (5.x) id AA05146; Fri, 28 Apr 1995 16:39:55 +1000
Date: Fri, 28 Apr 1995 16:39:55 +1000
Message-Id: <9504280639.AA05146@glass>
To: gcl@cli.com
Subject: Problems with defCfun in gcl-2.0 
X-Sun-Charset: US-ASCII


After installing gcl 2.0 (on solaris and linux w/o ELF),
some inline c-functions didn't work anymore. While loading
a file containing a defCfun, the loader complained about
not knowing the symbols Creturn and CMPfuncall.

The new documentation doesn't mention creturn anymore, and
I was able to rewrite the code without it. When comparing
the intermediate C-Code with the output from gcl-1.1, I 
noticed a macro for CMPfuncall: 

#define CMPfuncall funcall

with this line added in the function code, loading works again.

Is this a bug ? And is Creturn obsolete ?
Or do I have to add the macro for creturn from gcl-1.1 code ?

BTW. Someone had problems with linux with ELF. Is this solved ?

thorsten
 

From anders.vinjar@notam.uio.no  Sat Apr 29 15:31:29 1995
Return-Path: <anders.vinjar@notam.uio.no>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA05081; Sat, 29 Apr 95 15:31:29 CDT
Received: from mons.uio.no by cli.com (4.1/SMI-4.1)
	id AA05759; Sat, 29 Apr 95 14:17:34 CDT
Received: from ulrik.uio.no by mons.uio.no with local-SMTP (PP) 
          id <13480-0@mons.uio.no>; Sat, 29 Apr 1995 21:17:25 +0200
Received: by alban.notam.uio.no ; Sat, 29 Apr 1995 19:14:52 GMT
Date: Sat, 29 Apr 1995 19:14:52 GMT
From: anders.vinjar@notam.uio.no
Message-Id: <199504291914.TAA15011@alban.notam.uio.no>
To: gcl@cli.com
Subject: gcl-2.0 on irix5 (patch-level 2). PCL stops it!

I've successfully built and saved an executing version of gcl-2.0 on the
SGI (irix-5.2).  The gcl-tcl interface works seemingly allright.

When trying to build pcl-gcl-2.1 (from ftp.ma.utexas.edu) it goes all the
way through the compilation and loading without warnings, but
si::save-system fails to save the image.  The error message is like this:

  Error: Sorry, Cant save an image with dynamically loaded .o files
  Fast links are on: do (use-fast-links nil) for debugging
  Error signalled by EVAL.
  Broken at SYSTEM:SAVE-SYSTEM.  Type :H for Help.
  >>

What can i do to avoid the problem, or to find some bugs to fix?

-- 

   Anders Vinjar                       |        NoTAM -
                                       |
   Addr: Ole Jacob Brochs gt. 1        |        http://www.notam.uio.no
         0454 Oslo, Norway             |        Vox: +47 22857970
   Vox:  + 47 22607968                 |        Fax: +47 22857974


From ahe@cs.unh.edu  Mon May  1 11:28:54 1995
Return-Path: <ahe@cs.unh.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA06725; Mon, 1 May 95 11:28:54 CDT
Received: from cs.unh.edu by cli.com (4.1/SMI-4.1)
	id AA10514; Mon, 1 May 95 10:11:46 CDT
Received: from mica.cs.unh.edu by cs.unh.edu (5.x/SMI-SVR4)
	id AA27480; Mon, 1 May 1995 11:11:45 -0400
Received: by mica.cs.unh.edu (5.x/SMI-SVR4)
	id AA02994; Mon, 1 May 1995 11:11:44 -0400
Date: Mon, 1 May 1995 11:11:44 -0400
From: ahe@cs.unh.edu (Andy Evans)
Message-Id: <9505011511.AA02994@mica.cs.unh.edu>
To: gcl@cli.com
Subject: Ultrix 4.4 on a 5000 - any success?


Hello folks -

I've been trying to build gcl-2.0 and gcl-1.1 on a
DECstation 5000 with Ultrix 4.4 - without success.
I'm using either DEC's cc or gcc 2.6.3.  The
process has gotten as far as "loading auto.lsp"
but it has never finished making saved_gcl.  The
raw_gcl has core-dumped or complained of illegal
instruction (last one was "GBC not enabled" on 1.1).

Does anyone have any tips or reccomendations?  I'd
be grateful!  Thanks -

- Andy

====================================================
    Andrew Evans        Computer Science Department
 Computer Specialist    University of New Hampshire
   ahe@cs.unh.edu             Durham, NH 03824
====================================================

From haleysj@HIRAMF.hiram.edu  Mon May  1 17:02:45 1995
Return-Path: <haleysj@HIRAMF.hiram.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00222; Mon, 1 May 95 17:02:45 CDT
Received: from HIRAMF.hiram.edu by cli.com (4.1/SMI-4.1)
	id AA11894; Mon, 1 May 95 15:47:15 CDT
Received: by HIRAMF.hiram.edu (5.65/DEC-Ultrix/4.3)
	id AA15562; Mon, 1 May 1995 16:53:14 -0400
Date: Mon, 1 May 1995 16:53:13 -0400 (EDT)
From: Steve <haleysj@HIRAMF.hiram.edu>
To: gcl@cli.com
Subject: GCL on DecStation 3100 / VAXstation 3100
Message-Id: <Pine.ULT.3.91.950501164737.15505A-100000@hiramf.hiram.edu>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Hello!
   I am having a lot of trouble compiling GCL-2.0 on both a DECstation 
3100 and a VAXstation 3100.
   When compiling with the stock cc, I get many compiler warnings and it 
eventually stops.  
   Changing references in the dec3100.defs from cc to gcc (version 2.6.3) 
makes compiling go well until raw_gcl.  When running raw_gcl, it reports 
an illegal instruction and core dumps.
   This happens both on the vaxstation using vax.defs and the decstation 
using dec3100.defs. They are running Ultrix 4.4 and 4.3 respectively.
   Any ideas?  Thanks in advance.  I hope I can get it to work, for gcl 
looks like a nice package.
	
					-- Steve Haley


...................*****************************************....................
haleysj@hiramf.hiram.edu       haleysj@hiram.edu     bm711@cleveland.freenet.edu
                                =) :) 8-) :> =D		

--------------------------------------------------------------------------------


From tkunze@ccrma.Stanford.EDU  Mon May  1 18:22:02 1995
Return-Path: <tkunze@ccrma.Stanford.EDU>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00239; Mon, 1 May 95 18:22:02 CDT
Received: from  ccrma.Stanford.EDU  (ccrma.Stanford.EDU) by cli.com (4.1/SMI-4.1)
	id AA12120; Mon, 1 May 95 17:04:46 CDT
Received: from cmn10 by  ccrma.Stanford.EDU  (NX5.67e/NeXT-1.0)
	id AA06121; Mon, 1 May 95 15:04:44 -0700
From: tkunze@ccrma.Stanford.EDU (Tobias Kunze)
Message-Id: <9505012204.AA06121@ ccrma.Stanford.EDU >
Received: by cmn10.Stanford.EDU (NX5.67e/NX3.0X)
	id AA21169; Mon, 1 May 95 15:04:43 -0700
Date: Mon, 1 May 95 15:04:43 -0700
Received: by NeXT.Mailer (1.100)
Received: by NeXT Mailer (1.100)
To: gcl@cli.com
Subject: gcl2.0 on irix5


Hi-

has anyone been able to successfully build gcl2 with pcl 2.1?

Also: does anyone happen to know why it is that the irix5 port
can't save an image with dynamically loaded code?

TIA, 


-Tobias

From erik@naggum.no  Tue May  2 18:47:28 1995
Return-Path: <erik@naggum.no>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00836; Tue, 2 May 95 18:47:28 CDT
Received: from naggum.no by cli.com (4.1/SMI-4.1)
	id AA16658; Tue, 2 May 95 17:22:26 CDT
Received: by naggum.no id <AA18953> for gcl@cli.com; Tue, 2 May 1995 22:22:23 UT
Date: 02 May 1995 21:48:49 UT
From: Erik Naggum <erik@naggum.no>
Organization: Naggum Software; +47 2295 0313
Message-Id: <19950502.12274@naggum.no>
To: gcl@cli.com
Subject: compile problems

I retrieved GCL-2.1, and appreciate the developments, but I'm a little
surprised by the difficulties I'm having in changing the prompting and
exiting behavior of top-level and break-level.  I also don't want tcl/tk
and find it hard to build without them.

here's the desired diff to top-level (I redefine it in init_gcl.lsp):

--- top.lsp     Sun Apr  2 01:40:14 1995
+++ ../unixport/init_gcl.lsp    Tue May  2 17:14:47 1995
@@ -100,7 +20,7 @@
     (loop
       (setq +++ ++ ++ + + -)
       (if *no-prompt* (setq *no-prompt* nil)
-       (format t "~%~a>"
+       (format t "~&~a> "
                (if (eq *package* (find-package 'user)) ""
                   (package-name *package*))))
       (reset-stack-limits)
@@ -109,55 +29,19 @@
       (when (catch *quit-tag*
               (setq - (locally (declare (notinline read))
                                (read *standard-input* nil *top-eof*)))
-              (when (eq - *top-eof*) (bye))
+              (when (eq - *top-eof*) (terpri) (bye))
               (let ((values (multiple-value-list
                              (locally (declare (notinline eval)) (eval -)))))
                 (setq /// // // / / values *** ** ** * * (car /))
                 (fresh-line)
                 (dolist (val /)
                   (locally (declare (notinline prin1)) (prin1 val))
-                  (terpri))
+                  (princ " "))
                 nil))
         (setq *evalhook* nil *applyhook* nil)
         (terpri *error-output*)
         (break-current)))))
 
however, when I made these trivial changes, I got a barrage of errors, and
gcl failed to build.  the amazing part is that compiling an _unmodified_
lsp/top.lsp crashes equally spectacularly.  (the copy to top1.lsp is only
to prevent destruction of top.*.)  I also note that there's a stray ) in
this file, but removing it had no effect whatsoever.  I'm not sure that's a
good sign, either.

$ cp top.lsp top1.lsp
$ make top1.o
Compiling top1.lsp.
Loading ./cmpinit.lsp
Finished loading ./cmpinit.lsp
Warning: WARN is being redefined.
Warning: BREAK is being redefined.
End of Pass 1.  
Error: Caught fatal error [memory may be damaged]
Fast links are on: do (use-fast-links nil) for debugging
Error signalled by CATCH.
Backtrace: gcl-top-level > if > let > error-set > error-set > progn > compile-file > loop > setq > apply > apply > compiler::compile-file1 > let > unwind-protect > progn > let* > let > unwind-protect > progn > when > compiler::compiler-pass2 > let > unwind-protect > progn > let > let > unwind-protect > progn > catch > compiler::ctop-write > universal-error-handler > break-level > let* > UNLESS
top1.c: In function `init_top1':
top1.c:4: `VV' undeclared (first use this function)
top1.c:4: (Each undeclared identifier is reported only once
top1.c:4: for each function it appears in.)
top1.c: In function `LI1':
top1.c:12: `VV' undeclared (first use this function)
top1.c:38: `Lnk140' undeclared (first use this function)
top1.c:44: `Lnk141' undeclared (first use this function)
top1.c:167: `Lnk145' undeclared (first use this function)
top1.c: In function `L2':
top1.c:176: `VM2' undeclared (first use this function)
top1.c:187: `VV' undeclared (first use this function)
top1.c:191: `Lnk140' undeclared (first use this function)
top1.c:199: `Lnk146' undeclared (first use this function)
top1.c: In function `L3':
top1.c:227: `VM3' undeclared (first use this function)
top1.c:243: `VV' undeclared (first use this function)
top1.c:290: `Lnk147' undeclared (first use this function)
top1.c:295: `Lnk148' undeclared (first use this function)
top1.c: In function `L4':
top1.c:316: `VM4' undeclared (first use this function)
top1.c:333: `VV' undeclared (first use this function)
top1.c:350: `Lnk149' undeclared (first use this function)
top1.c:358: `Lnk150' undeclared (first use this function)
top1.c:366: `Lnk151' undeclared (first use this function)
top1.c:405: `Lnk152' undeclared (first use this function)
top1.c:409: `Lnk153' undeclared (first use this function)
top1.c:414: `Lnk154' undeclared (first use this function)
top1.c:419: `LnkLI155' undeclared (first use this function)
top1.c:427: `Lnk156' undeclared (first use this function)
top1.c:492: `Lnk157' undeclared (first use this function)
top1.c:596: `Lnk145' undeclared (first use this function)
top1.c: At top level:
top1.c:605: parse error at end of input
$ tail top1.c
        vs_base=vs_top;
        (void) (*Lnk145)();
        vs_top=sup;
T210:;
        goto T209;}
        }
}
/*      local entry for function WARN   */

static object LI5(V30

compiling top1.lsp anywhere but in the distribution lsp directory succeeds.

I have made the changes in unixport/init_gcl.lsp and can live with that,
but I find this more than disturbing, so I thought you might be interested
in a report on the behavior.

#<Erik 3008442142>

From johng@jolt.mpx.com.au  Wed May  3 01:36:59 1995
Return-Path: <johng@jolt.mpx.com.au>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01027; Wed, 3 May 95 01:36:59 CDT
Received: from kyoko.mpx.com.au by cli.com (4.1/SMI-4.1)
	id AA17798; Wed, 3 May 95 00:30:57 CDT
Received: from jolt.mpx.com.au by kyoko.mpx.com.au with smtp
	(Smail3.1.29.1 #6) id m0s6X1s-0006NXC; Wed, 3 May 95 15:31 EST
Received: by jolt.mpx.com.au (Smail3.1.28.1 #2)
	id m0s6Wzq-0005tZC; Wed, 3 May 95 15:29 EST
Message-Id: <m0s6Wzq-0005tZC@jolt.mpx.com.au>
From: johng@jolt.mpx.com.au (John Gibbons)
Subject: GCL 2.x and Solaris 2.3/4
To: gcl@cli.com
Date: Wed, 3 May 1995 15:29:14 +1000 (EST)
X-Mailer: ELM [version 2.4 PL21]
Mime-Version: 1.0
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bit
Content-Length: 187       

Has anoyone succeeded in building PCL-GCL under Solaris 2.3 or 2.4 with
gcl2.0.

I have built gcl itself but pcl always fails to build in a dramatic way.

Any help would be appreciated.


From anders.vinjar@notam.uio.no  Wed May  3 04:30:24 1995
Return-Path: <anders.vinjar@notam.uio.no>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA01068; Wed, 3 May 95 04:30:24 CDT
Received: from mons.uio.no by cli.com (4.1/SMI-4.1)
	id AA18213; Wed, 3 May 95 03:20:36 CDT
Received: from ulrik.uio.no by mons.uio.no with local-SMTP (PP) 
          id <28573-0@mons.uio.no>; Wed, 3 May 1995 10:20:11 +0200
Received: by alban.notam.uio.no ; Wed, 3 May 1995 08:17:34 GMT
Date: Wed, 3 May 1995 08:17:34 GMT
From: anders.vinjar@notam.uio.no
Message-Id: <199505030817.IAA06857@alban.notam.uio.no>
To: johng@jolt.mpx.com.au
Cc: gcl@cli.com
In-Reply-To: <m0s6Wzq-0005tZC@jolt.mpx.com.au> (johng@jolt.mpx.com.au)
Subject: Re: GCL 2.x and Solaris 2.3/4

>>>>> johng@jolt.mpx.com.au (John Gibbons) writes:

    John> Has anoyone succeeded in building PCL-GCL under Solaris 2.3 or
    John> 2.4 with gcl2.0.

    John> I have built gcl itself but pcl always fails to build in a
    John> dramatic way.

    John> Any help would be appreciated.

Could you please describe the situation a bit closer?

From saruman.lb.bawue.de!shendi@delos.s.bawue.de  Sat May  6 11:11:00 1995
Return-Path: <saruman.lb.bawue.de!shendi@delos.s.bawue.de>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02740; Sat, 6 May 95 11:11:00 CDT
Received: from delos.s.bawue.de by cli.com (4.1/SMI-4.1)
	id AA29016; Sat, 6 May 95 10:01:08 CDT
Received: from saruman.lb.bawue.de by delos.s.bawue.de with uucp
	(Smail3.1.28.1 #3) id m0s7hUW-000BHmC; Sat, 6 May 95 12:53 MET DST
Received: by saruman.lb.bawue.de (Smail3.1.28.1 #1)
	id m0s7gci-0001b9C; Sat, 6 May 95 11:58 MET DST
Message-Id: <m0s7gci-0001b9C@saruman.lb.bawue.de>
From: shendi@saruman.lb.bawue.de (Alexander Shendi)
Subject: Prevent Loading of init.lsp in GCL 1.1
To: gcl@cli.com
Date: Sat, 6 May 1995 11:58:07 +0200 (MET DST)
In-Reply-To: <m0s6Wzq-0005tZC@jolt.mpx.com.au> from "John Gibbons" at May 3, 95 03:29:14 pm
X-Mailer: ELM [version 2.4 PL23]
Content-Type: text
Content-Length: 80        

Is there a way to prevent loading init.lsp in GCl 1.1.

Thanx in advance 

Alex

From kr@shell.portal.com  Sat May  6 17:55:56 1995
Return-Path: <kr@shell.portal.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA02826; Sat, 6 May 95 17:55:56 CDT
Received: from nova.unix.portal.com by cli.com (4.1/SMI-4.1)
	id AA29558; Sat, 6 May 95 16:52:26 CDT
Received: from jobe.shell.portal.com (jobe.shell.portal.com [156.151.3.4]) by nova.unix.portal.com (8.6.11/8.6.5) with ESMTP id OAA14876; Sat, 6 May 1995 14:51:43 -0700
Received: from DialupEudora (jobe.shell.portal.com [156.151.3.4]) by jobe.shell.portal.com (8.6.11/8.6.5) with SMTP id OAA05899; Sat, 6 May 1995 14:51:40 -0700
X-Sender: kr@pop.shell.portal.com
Message-Id: <v02110100abd1abfca96a@DialupEudora>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Date: srialpop\r\e%, 6 May 1995 14:52:13 -0800
To: shendi@saruman.lb.bawue.de (Alexander Shendi), gcl@cli.com
From: kr@shell.portal.com (kr)
Subject: Re: Prevent Loading of init.lsp in GCL 1.1

Sender: gcl-request@cli.com



At 11:58 5/6/95, Alexander Shendi wrote:
>Is there a way to prevent loading init.lsp in GCl 1.1.

How about just removing that file or keeping it empty ?  :-)


Greetings
Markus Krummenacker



From yuasa@ylab.tutics.tut.ac.jp  Sun May  7 20:40:48 1995
Return-Path: <yuasa@ylab.tutics.tut.ac.jp>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA03206; Sun, 7 May 95 20:40:48 CDT
Received: from katura.ylab.tutics.tut.ac.jp by cli.com (4.1/SMI-4.1)
	id AA01623; Sun, 7 May 95 19:27:50 CDT
Received: (from yuasa@localhost) by katura.ylab.tutics.tut.ac.jp (8.6.9+2.4W/3.3W9) id JAA15531 for gcl@cli.com; Mon, 8 May 1995 09:23:52 +0900
Date: Mon, 8 May 1995 09:23:52 +0900
From: Taiichi Yuasa <yuasa@ylab.tutics.tut.ac.jp>
Message-Id: <199505080023.JAA15531@katura.ylab.tutics.tut.ac.jp>
To: gcl@cli.com
Subject: RE: Prevent Loading of init.lsp in GCL 1.1

>> Is there a way to prevent loading init.lsp in GCl 1.1.

In the original KCL, the instruction to load init.lsp is given in the file
lsp/top.lsp.

    (defun top-level ()
      ...
      (catch *quit-tag* (when (probe-file "init.lsp") (load "init.lsp")))
      ...
    )

Commenting out the entire CATCH form will prevent loading init.lsp.

-- Taiichi

From kr@shell.portal.com  Sun May  7 20:42:39 1995
Return-Path: <kr@shell.portal.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA03210; Sun, 7 May 95 20:42:39 CDT
Errors-To: sandel@cli.com
Received: from nova.unix.portal.com by cli.com (4.1/SMI-4.1)
	id AA01624; Sun, 7 May 95 19:30:37 CDT
Errors-To: sandel@cli.com
Received: from jobe.shell.portal.com (jobe.shell.portal.com [156.151.3.4]) by nova.unix.portal.com (8.6.11/8.6.5) with ESMTP id RAA11193 for <gcl@cli.com>; Sun, 7 May 1995 17:29:54 -0700
From: kr@shell.portal.com
Received: (kr@localhost) by jobe.shell.portal.com (8.6.11/8.6.5) id RAA06468; Sun, 7 May 1995 17:29:53 -0700
Date: Sun, 7 May 1995 17:29:53 -0700
Message-Id: <199505080029.RAA06468@jobe.shell.portal.com>
To: gcl@cli.com
Subject: onscure format quirks
Sender: gcl-request@cli.com
Errors-To: gcl-request@cli.com

I have repeatedly used the (format ...) function to print out numbers
in a flexible and variable fashion. I think that the syntax of this
construct is pretty brain-dead and user-unfriendly, and many of the
options are pretty obscure (and so not well tested and debugged, it
seems). So I probably only have myself to blame for having run into
problems with various LISPs by using format. But OTOH there must be
reason why it was included, and there is no reasonable alternative I
know of, so I'll have to use what is available.

I have encountered the following oddities in gcl-1.1 :

* extra comma, but empty field:
------------------------------
(format nil "~v,'0,X" 8 1234) yields this:
==========
>(format nil "~v,'0,X" 8 1234)
(format nil "~v,'0,X" 8 1234)

Error: Format error: illegal ,.
              V
       "~v,'0,X"

Fast links are on: do (use-fast-links nil) for debugging
Error signalled by FORMAT.
Broken at FORMAT.  Type :H for Help.
>>
==========

With my reading of CLtL2, p. 586, it should be legal to have all these
commas in there, even if a field happens to be empty (I even read it
as if though it were required). This works with no problem in MCL2.0
. So I do not know whether this is a bug in GCL or in MCL, or whether
I just should code in a more defensive style.

* no comma, empty field:
-----------------------
(format nil "~v,'0X" 8 1234) works correctly:
==========
>(format nil "~v,'0X" 8 1234)
"000004D2"

>
==========

This also works in the same way in MCL2.0 .


* with comma, and specified field with "commachar":
--------------------------------------------------
(format nil "~v,'0,' X" 8 1234) does not do quite what one would
expect:
==========
>(format nil "~v,'0,' X" 8 1234)
"000004D2"

>
==========

It should have divided the output in blocks with a length of three (as
a default). In MCL2.0 it gives the following as expected:
==========
? (format nil "~v,'0,' X" 8 1234)
" 000 4D2"
? 
==========


I just wanted to toss out these observations. Maybe other people here
have encountered these issues, and maybe know definitive answers as to
what is correct..

Many Greetings
Markus Krummenacker


From marks@earth.sarnoff.com  Mon May  8 13:39:19 1995
Return-Path: <marks@earth.sarnoff.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA03578; Mon, 8 May 95 13:39:19 CDT
Received: from groucho.sarnoff.com by cli.com (4.1/SMI-4.1)
	id AA03269; Mon, 8 May 95 11:58:49 CDT
Received: (from marks@localhost) by groucho.sarnoff.com (8.6.9/8.6.9) id NAA26578; Mon, 8 May 1995 13:03:55 -0400
Date: Mon, 8 May 1995 13:03:55 -0400
From: "Aaron J. Marks" <marks@earth.sarnoff.com>
Message-Id: <199505081703.NAA26578@groucho.sarnoff.com>
To: gcl@cli.com
Subject: GCL 2.0 and PCL 2.1 on BSDI 2.0

Has anyone successfully compiled GCL 2.0 and PCL 2.1 on a BSDI 2.0 box?
I've been able to compile gcl (using FreeBSD mach type) but pcl does not
compile.  It looks like it's the infamous sprintf fcn bug that FreeBSD had.
I am under this assumption because I get the "Dots appeared illegally"
error message when trying to load the compiled version of DEPS:

  ...
  Loading binary of DEFCLASS...
  Loading binary of DEFS...

  Error: Dots appeared illegally.
  ...

Comments/suggestions?

Thanks,
-Aaron.

-- 
Aaron J. Marks - marks@sarnoff.com          "If you steal from one author it's
David Sarnoff Research Center               plagiarism; if you steal from many
Voice: (609)734-2704; Fax: (609)734-2049    it's research." --Unknown

From jeff@aiai.ed.ac.uk  Mon May  8 15:15:56 1995
Return-Path: <jeff@aiai.ed.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA03647; Mon, 8 May 95 15:15:56 CDT
Received: from haymarket.ed.ac.uk by cli.com (4.1/SMI-4.1)
	id AA03619; Mon, 8 May 95 13:36:42 CDT
Received: from aiai.ed.ac.uk (skye-alter.aiai.ed.ac.uk [192.41.104.6]) by haymarket.ed.ac.uk (8.6.10/8.6.10) with SMTP id TAA28234; Mon, 8 May 1995 19:36:00 +0100
Received: from subnode.aiai.ed.ac.uk (bute) by aiai.ed.ac.uk; Mon, 8 May 95 19:35:05 BST
Date: Mon, 8 May 95 19:35:04 BST
Message-Id: <27938.9505081835@subnode.aiai.ed.ac.uk>
From: Jeff Dalton <jeff@aiai.ed.ac.uk>
Subject: Re: onscure format quirks
To: kr@shell.portal.com, gcl@cli.com
In-Reply-To: kr@shell.portal.com's message of Sun, 7 May 1995 17:29:53 -0700

> I have repeatedly used the (format ...) function to print out numbers
> in a flexible and variable fashion. I think that the syntax of this
> construct is pretty brain-dead and user-unfriendly, and many of the
> options are pretty obscure (and so not well tested and debugged, it
> seems). So I probably only have myself to blame for having run into
> problems with various LISPs by using format. But OTOH there must be
> reason why it was included, and there is no reasonable alternative I
> know of, so I'll have to use what is available.

The short answer is that FORMAT is in Common Lisp because it was
in MacLisp and in the various MacLisp successors that lead to Common
Lisp, and because it didn't generate enough dislike to get it eliminated
or extensively modified.  If I recall correctly, Guy Steele is
the originator of some of the more elaborate aspects.  Anyway,
some people think it's neat, and indeed cool, to be able to write
loops and case statements in format strings.  ^_^

I don't think it's much worse than some of the similar things
used in C (printf(), strftime()), but it's true that it has
some problems.

Anyway, useing the XP pretty-printer's format in AKCL, I get:

-> (format nil "~v,'0,X" 8 1234) 
"000004D2"
-> (format nil "~v,'0X" 8 1234) 
"000004D2"
-> (format nil "~v,'0,' X" 8 1234)
"000004D2"

You say the last one should work like this:

> ? (format nil "~v,'0,' X" 8 1234)
> " 000 4D2"

As you can see, that's not what I get above.  Nor is it what I
get using the native FORMAT (ie, as opposed to the XP one) in
Lucid CL 4.1 or Allegro CL 4.1.

-- jeff

From kr@shell.portal.com  Mon May  8 18:27:04 1995
Return-Path: <kr@shell.portal.com>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA03711; Mon, 8 May 95 18:27:04 CDT
Received: from nova.unix.portal.com by cli.com (4.1/SMI-4.1)
	id AA04458; Mon, 8 May 95 17:11:31 CDT
Received: from jobe.shell.portal.com (jobe.shell.portal.com [156.151.3.4]) by nova.unix.portal.com (8.6.11/8.6.5) with ESMTP id PAA11907; Mon, 8 May 1995 15:10:45 -0700
Received: from DialupEudora (jobe.shell.portal.com [156.151.3.4]) by jobe.shell.portal.com (8.6.11/8.6.5) with SMTP id PAA15964; Mon, 8 May 1995 15:10:41 -0700
X-Sender: kr@pop.shell.portal.com
Message-Id: <v02110100abd45377fcb0@DialupEudora>
Mime-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Date: shell\r\elogin:, 8 May 1995 15:11:15 -0800
To: Jeff Dalton <jeff@aiai.ed.ac.uk>, gcl@cli.com
From: kr@shell.portal.com (kr)
Subject: Re: obscure format quirks

At 19:35 5/8/95, Jeff Dalton wrote:
>I don't think it's much worse than some of the similar things
>used in C (printf(), strftime()), but it's true that it has
>some problems.

I think those are also pretty brain-dead. :-)  (I did not even mention
Fortran :-)

>Anyway, useing the XP pretty-printer's format in AKCL, I get:

Thanx for sending those datapoints. But what is "XP pretty-printer" and
where would I get it ?


Greetings
Markus Krummenacker



From richards@igor.music.qc.edu  Mon May  8 20:27:14 1995
Return-Path: <richards@igor.music.qc.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA03729; Mon, 8 May 95 20:27:14 CDT
Received: from aaron.music.qc.edu by cli.com (4.1/SMI-4.1)
	id AA04714; Mon, 8 May 95 19:05:32 CDT
Received: from igor by aaron.music.qc.edu (NX5.67e/NX3.0M)
	id AA04757; Mon, 8 May 95 20:02:17 -0400
Received: by igor.music.qc.edu (NX5.67e/NX3.0S)
	id AA00326; Mon, 8 May 95 20:03:47 -0400
Date: Mon, 8 May 1995 20:03:44 -0400 (EDT)
From: "David N. Richards" <richards@aaron.music.qc.edu>
X-Sender: richards@igor
To: Gcl Mailing List <gcl@cli.com>
Subject: make breaks
Message-Id: <Pine.NXT.3.91.950508200055.322A-100000@igor>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Hi - Trying to build on a NeXTStep 3.2 m68k platform.
got the following error during a make (see below) - 
any help much appreciated!! 

Dave
==========================================
        David Richards               
The Aaron Copland School of Music
       at Queens College   
E-mail: richards@aaron.music.qc.edu               
Voice : 1-(718)-997-3874
==========================================

NeXTunixsave.c:121: `va_alist' undeclared (first use this function)
NeXTunixsave.c:121: (Each undeclared identifier is reported only once
NeXTunixsave.c:121: for each function it appears in.)
NeXTunixsave.c:296: `i' undeclared (first use this function)
NeXTunixsave.c:296: `the_commands_len' undeclared (first use this 
function)
NeXTunixsave.c:297: `the_commands' undeclared (first use this function)
NeXTunixsave.c:299: `segment' undeclared (first use this function)
NeXTunixsave.c:305: `data_size' undeclared (first use this function)
NeXTunixsave.c:305: `data_address' undeclared (first use this function)
NeXTunixsave.c:306: `bss_size' undeclared (first use this function)
NeXTunixsave.c:307: `fdatastart' undeclared (first use this function)
NeXTunixsave.c:308: `fdatasize' undeclared (first use this function)
NeXTunixsave.c:309: `fgrowth' undeclared (first use this function)
NeXTunixsave.c:314: `section' undeclared (first use this function)
NeXTunixsave.c:315: `seg' undeclared (first use this function)
NeXTunixsave.c:352: `outfd' undeclared (first use this function)
NeXTunixsave.c:352: `the_header' undeclared (first use this function)
NeXTunixsave.c:355: warning: `return' with a value, in function returning 
void
NeXTunixsave.c:366: warning: `return' with a value, in function returning 
void
NeXTunixsave.c:373: `infd' undeclared (first use this function)
NeXTunixsave.c:376: warning: `return' with a value, in function returning 
void
NeXTunixsave.c:378: `size' undeclared (first use this function)
NeXTunixsave.c:380: `buf' undeclared (first use this function)
NeXTunixsave.c:388: warning: `return' with a value, in function returning 
void
NeXTunixsave.c:399: warning: `return' with a value, in function returning 
void
NeXTunixsave.c:411: `st' undeclared (first use this function)
NeXTunixsave.c:414: warning: `return' with a value, in function returning 
void
NeXTunixsave.c:422: warning: `return' with a value, in function returning 
void
NeXTunixsave.c:427: warning: `return' with a value, in function returning 
void
NeXTunixsave.c:430: warning: `return' with a value, in function returning 
void
unixsave.c: In function `init_unixsave':
unixsave.c:174: `Lsave' undeclared (first use this function)
*** Exit 1


From etokna@etn.ericsson.se  Tue May  9 10:14:17 1995
Return-Path: <etokna@etn.ericsson.se>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00420; Tue, 9 May 95 10:14:17 CDT
Received: from mailgate.ericsson.se by cli.com (4.1/SMI-4.1)
	id AA06328; Tue, 9 May 95 08:44:49 CDT
Received: from hisoy0 (hisoy0.etn.ericsson.se [193.161.188.2]) by mailgate.ericsson.se (8.6.11/1.0) with SMTP id PAA03844 for <gcl@cli.com>; Tue, 9 May 1995 15:44:39 +0200
Received: from hisoy1.etn.ericsson.se by hisoy0 (5.0/LME-DOM-2.2.3)
	id AA19866; Tue, 9 May 1995 15:45:08 +0200
From: etokna@etn.ericsson.se (Knut-Haavard Aksnes)
Received: by hisoy1.etn.ericsson.se (4.1/client-1.5)
	id AA02791; Tue, 9 May 95 15:43:45 +0200
Date: Tue, 9 May 95 15:43:45 +0200
Message-Id: <9505091343.AA02791@hisoy1.etn.ericsson.se>
To: gcl@cli.com
Subject: Bug in gcl-2.1 installation
Comments: Hyperbole mail buttons accepted, v3.18.3.
Content-Length: 444

The tcl/tk  and X11 include and library  directories from  add-defs is
not propagated properly  to the makefile  in gcl-tk. This makefile has
to be edited manually.

-- 

-------------------------------------------------------------------------------
Name:	Knut-Hvard Aksnes (ECMA 94) or		Knut-Haavard Aksnes (ASCII)
Ericsson signature: HI/ETO/X/I KNA		Phone: +47 37 05 14 81
Email: etokna@hisoy.etn.ericsson.se (internet)  ETO.ETOKNA (memo)


From etokna@etn.ericsson.se  Tue May  9 10:25:14 1995
Return-Path: <etokna@etn.ericsson.se>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00426; Tue, 9 May 95 10:25:14 CDT
Received: from mailgate.ericsson.se by cli.com (4.1/SMI-4.1)
	id AA06409; Tue, 9 May 95 09:01:36 CDT
Received: from hisoy0 (hisoy0.etn.ericsson.se [193.161.188.2]) by mailgate.ericsson.se (8.6.11/1.0) with SMTP id QAA06092 for <gcl@cli.com>; Tue, 9 May 1995 16:01:32 +0200
Received: from hisoy1.etn.ericsson.se by hisoy0 (5.0/LME-DOM-2.2.3)
	id AA20254; Tue, 9 May 1995 16:02:00 +0200
From: etokna@etn.ericsson.se (Knut-Haavard Aksnes)
Received: by hisoy1.etn.ericsson.se (4.1/client-1.5)
	id AA02945; Tue, 9 May 95 16:00:36 +0200
Date: Tue, 9 May 95 16:00:36 +0200
Message-Id: <9505091400.AA02945@hisoy1.etn.ericsson.se>
To: gcl@cli.com
Subject: gcl-2.1 fails to compile pcl-gcl-2.1 on solaris.
Comments: Hyperbole mail buttons accepted, v3.18.3.
Content-Length: 367

GCL core dumps during compilation of slots-boot.lisp on a Sparc 1000
running SunOS 5.3.

-- 

-------------------------------------------------------------------------------
Name:	Knut-Hvard Aksnes (ECMA 94) or		Knut-Haavard Aksnes (ASCII)
Ericsson signature: HI/ETO/X/I KNA		Phone: +47 37 05 14 81
Email: etokna@hisoy.etn.ericsson.se (internet)  ETO.ETOKNA (memo)


From etokna@etn.ericsson.se  Tue May  9 10:34:58 1995
Return-Path: <etokna@etn.ericsson.se>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00433; Tue, 9 May 95 10:34:58 CDT
Received: from mailgate.ericsson.se by cli.com (4.1/SMI-4.1)
	id AA06421; Tue, 9 May 95 09:05:12 CDT
Received: from hisoy0 (hisoy0.etn.ericsson.se [193.161.188.2]) by mailgate.ericsson.se (8.6.11/1.0) with SMTP id QAA06626 for <gcl@cli.com>; Tue, 9 May 1995 16:05:09 +0200
Received: from hisoy1.etn.ericsson.se by hisoy0 (5.0/LME-DOM-2.2.3)
	id AA20314; Tue, 9 May 1995 16:05:38 +0200
From: etokna@etn.ericsson.se (Knut-Haavard Aksnes)
Received: by hisoy1.etn.ericsson.se (4.1/client-1.5)
	id AA03004; Tue, 9 May 95 16:04:15 +0200
Date: Tue, 9 May 95 16:04:15 +0200
Message-Id: <9505091404.AA03004@hisoy1.etn.ericsson.se>
To: gcl@cli.com
Subject: Path to libX11 should be stored for TCL/TK
Comments: Hyperbole mail buttons accepted, v3.18.3.
Content-Length: 426

(si::tkconnect)

fails for me if libX11.so.6.0 isn't in the LD_LIBRARY_PATH, this path
should ideally be remembered from the settings in add-defs.

-- 

-------------------------------------------------------------------------------
Name:	Knut-Hvard Aksnes (ECMA 94) or		Knut-Haavard Aksnes (ASCII)
Ericsson signature: HI/ETO/X/I KNA		Phone: +47 37 05 14 81
Email: etokna@hisoy.etn.ericsson.se (internet)  ETO.ETOKNA (memo)


From jeff@aiai.ed.ac.uk  Tue May  9 11:19:45 1995
Return-Path: <jeff@aiai.ed.ac.uk>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00470; Tue, 9 May 95 11:19:45 CDT
Received: from haymarket.ed.ac.uk by cli.com (4.1/SMI-4.1)
	id AA06649; Tue, 9 May 95 10:06:51 CDT
Received: from aiai.ed.ac.uk (skye-alter.aiai.ed.ac.uk [192.41.104.6]) by haymarket.ed.ac.uk (8.6.10/8.6.10) with SMTP id QAA19507; Tue, 9 May 1995 16:05:42 +0100
Received: from subnode.aiai.ed.ac.uk (bute) by aiai.ed.ac.uk; Tue, 9 May 95 16:04:45 BST
Date: Tue, 9 May 95 16:04:45 BST
Message-Id: <4003.9505091504@subnode.aiai.ed.ac.uk>
From: Jeff Dalton <jeff@aiai.ed.ac.uk>
Subject: Re: obscure format quirks
To: kr <kr@shell.portal.com>, gcl@cli.com
In-Reply-To: kr's message of shell\r\elogin:, 8 May 1995 15:11:15 -0800

> >Anyway, useing the XP pretty-printer's format in AKCL, I get:
> 
> Thanx for sending those datapoints. But what is "XP pretty-printer" and
> where would I get it ?

XP is a pretty printer written by Dick Waters at MIT.  It's the basis
for the pretty printer specification in Chapter 27 of Common Lisp the
Language 2nd edition.

The easiest way to make GCL conform to that spec (which I think is
also in the ANSI standard) would be to use XP.

It is (or at least was) available on the net.  The version I use
in AKCL is dated November, 26 1991 (rather old) and slightly
modified (by me) for AKCL to avoid calling COMPILE at run-time.

Now, _where_ on the net. ...

The latest info I have is from 8 feb 93:

   Dick Waters' XP Lisp Pretty Printer is available by anonymous ftp
   from merl.com:/pub/xp/ as the files xp-code.lisp, xp-doc.txt, and
   xp-test.lisp. (It is also available from the Lisp Utilities Repository.)
   For further information, contact Dick Waters, <dick@merl.com>
   or <dick@ai.mit.edu>.

For something more recent, check the Comp.lang.lisp FAQ.

For the utilities repository, try

  http://www.cs.cmu.edu/Web/Groups/AI/html/air.html

-- jeff

From wavehh!wavehh.hanse.de!cracauer@mail.hanse.de  Tue May  9 12:02:42 1995
Return-Path: <wavehh!wavehh.hanse.de!cracauer@mail.hanse.de>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00503; Tue, 9 May 95 12:02:42 CDT
Received: from ki1.chemie.fu-berlin.de by cli.com (4.1/SMI-4.1)
	id AA06844; Tue, 9 May 95 10:51:06 CDT
Received: by ki1.chemie.fu-berlin.de (Smail3.1.28.1)
	  from mail.hanse.de (134.100.239.2) with smtp
	  id <m0s8qVa-00012VC>; Tue, 9 May 95 16:43 MEST
Received: from wavehh.UUCP by mail.hanse.de with UUCP
	  for gcl@cli.com id <m0s8qVP-0004gMC@mail.hanse.de>; Tue, 9 May 95 16:43 MET DST
Received: by wavehh.hanse.de (4.1/SMI-4.1)
	id AA02969; Tue, 9 May 95 16:42:01 +0200
From: cracauer@wavehh.hanse.de (Martin Cracauer)
Message-Id: <9505091442.AA02969@wavehh.hanse.de>
Subject: gcl@cli.com: Please post announcements
To: gcl@cli.com
Date: Tue, 9 May 1995 16:42:00 +0200 (MET DST)
Reply-To: cracauer@wavehh.hanse.de
X-Mailer: ELM [version 2.4 PL24]
Content-Type: text
Content-Length: 377       

Hello,

I'd suggest that announcements for new releases of gcl are placed on
this list (gcl@cli.com). I see versions passing by in bug reports, but
never see any noification of a new release or beta release.

Thanks.
-- 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Martin Cracauer <cracauer@wavehh.hanse.de>  
(private address)
Tel.: +49 40 / 522 18 29
Fax.: +49 40 / 522 85 36

From richards@igor.music.qc.edu  Tue May  9 12:43:23 1995
Return-Path: <richards@igor.music.qc.edu>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00543; Tue, 9 May 95 12:43:23 CDT
Received: from aaron.music.qc.edu by cli.com (4.1/SMI-4.1)
	id AA07005; Tue, 9 May 95 11:27:29 CDT
Received: from igor by aaron.music.qc.edu (NX5.67e/NX3.0M)
	id AA00751; Tue, 9 May 95 12:24:04 -0400
Received: by igor.music.qc.edu (NX5.67e/NX3.0S)
	id AA02536; Tue, 9 May 95 12:25:44 -0400
Date: Tue, 9 May 1995 12:25:41 -0400 (EDT)
From: "David N. Richards" <richards@aaron.music.qc.edu>
X-Sender: richards@igor
To: Gcl Mailing List <gcl@cli.com>
Subject: make breaks
Message-Id: <Pine.NXT.3.91.950509122416.2532A-100000@igor>
Mime-Version: 1.0
Content-Type: TEXT/PLAIN; charset=US-ASCII

Hi - Building gcl2.0 on a NeXT m68k running 3.2 - and get the following:
cc -DVOL=volatile -I/Temp/Gcl/gcl-2.1/o -fwritable-strings -c -O 
-I../gcl-tk -I../h/  main.c  
main.c:554: only 3 args to macro 'RETURN' (4 expected)
*** Exit 1
Stop.
 
What should be the 4th value?? Many thanks in advance -
Dave

==========================================
        David Richards               
The Aaron Copland School of Music
       at Queens College   
E-mail: richards@aaron.music.qc.edu               
Voice : 1-(718)-997-3874
==========================================


From tkunze@ccrma.Stanford.EDU  Tue May  9 16:15:00 1995
Return-Path: <tkunze@ccrma.Stanford.EDU>
Received: from cli.com by ftp.cli.com (4.1/SMI-4.1)
	id AA00576; Tue, 9 May 95 16:15:00 CDT
Received: from  ccrma.Stanford.EDU  (ccrma.Stanford.EDU) by cli.com (4.1/SMI-4.1)
	id AA07668; Tue, 9 May 95 14:43:27 CDT
Received: from cmn18 by  ccrma.Stanford.EDU  (NX5.67e/NeXT-1.0)
	id AA16996; Tue, 9 May 95 12:43:25 -0700
From: tkunze@ccrma.Stanford.EDU (Tobias Kunze)
Message-Id: <9505091943.AA16996@ ccrma.Stanford.EDU >
Received: by cmn18.Stanford.EDU (NX5.67d/NX3.0X)
	id AA12106; Tue, 9 May 95 12:43:24 -0700
Date: Tue, 9 May 95 12:43:24 -0700
Received: by NeXT.Mailer (1.100)
Received: by NeXT Mailer (1.100)
To: "David N. Richards" <richards@aaron.music.qc.edu>
Subject: Re: make breaks
Cc: Gcl Mailing List <gcl@cli.com>


> Hi - Building gcl2.0 on a NeXT m68k running 3.2 - and get the following:
> cc -DVOL=volatile -I/Temp/Gcl/gcl-2.1/o -fwritable-strings -c -O 

> -I../gcl-tk -I../h/  main.c  

> main.c:554: only 3 args to macro 'RETURN' (4 expected)
> *** Exit 1
> Stop.
>  

> What should be the 4th value?? Many thanks in advance -
> Dave
> 


Dave-

it is a typo as far as i remember.  And--bad news--it's only the
first error in a row (about 50 or so) :(
I finally gave up.  I couldn't get it to compile under Next 3.3 (black).
I tweaked the sources here and there, but no way.

However, if somebody managed to get it to compile, I'd be glad to hear about!

-Tobias


