<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<!-- Common Lisp HyperSpec (TM), version 3.0 generated by kmp on Thu, 2-May-1996 10:21am EDT -->
<HTML>

<!-- Mirrored from www.cs.cmu.edu/afs/cs/project/ai-repository/ai/util/html/hyperspec/HyperSpec/Issues/iss353-writeup.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 22 Oct 2021 10:19:55 GMT -->
<HEAD>
<TITLE>CLHS: Issue TYPE-OF-UNDERCONSTRAINED Writeup</TITLE>
<META HTTP-EQUIV="Author" CONTENT="Kent M. Pitman">
<META HTTP-EQUIV="Organization" CONTENT="The Harlequin Group Limited">
<LINK REL=TOP HREF="../FrontMatter/index-2.html">
<LINK REL=COPYRIGHT HREF="../FrontMatter/About-HyperSpec.html#Legal">
<LINK REL=DISCLAIMER HREF="../FrontMatter/About-HyperSpec.html#Disclaimer">
<LINK REL=PREV HREF="iss351-writeup.html">
<LINK REL=UP HREF="iss353.html">
<LINK REL=NEXT HREF="iss354-writeup.html">
</HEAD>
<BODY BGCOLOR="#c0c0c0">
<H1><A REV=MADE HREF="http://www.harlequin.com/"><IMG ALT="[HARLEQUIN]" SRC="../Graphics/Harlequin-Small.gif" ALIGN=Bottom></A><A REL=TOP HREF="../FrontMatter/index-2.html"><IMG ALT="[Common Lisp HyperSpec (TM)]" SRC="../Graphics/HyperSpec-Small.gif" ALIGN=Bottom></A> <A REL=PREV HREF="iss351-writeup.html"><IMG ALT="[Previous]" SRC="../Graphics/Prev.gif" ALIGN=Bottom></A><A REL=UP HREF="iss353.html"><IMG ALT="[Up]" SRC="../Graphics/Up.gif" ALIGN=Bottom></A><A REL=NEXT HREF="iss354-writeup.html"><IMG ALT="[Next]" SRC="../Graphics/Next.gif" ALIGN=Bottom></A></H1>

<HR>



<H2>Issue TYPE-OF-UNDERCONSTRAINED Writeup</H2>

<PRE><B>Status:</B>	passed, Jun 89 X3J13<P>
<P>
<B>Forum:</B>	Cleanup<P>
<B>Issue:</B>      <A HREF="iss353.html">TYPE-OF-UNDERCONSTRAINED</A><P>
<P>
<B>References:</B> <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> (CLtL)<P>
            88-002R (Class-of)<P>
            88-005, p 43f, Condition system types<P>
Related issues: <A HREF="iss336.html">SUBTYPEP-TOO-VAGUE</A><P>
                DATA-TYPE-HIERARCHY-UNDERSPECIFIED<P>
                <A HREF="iss175-menu.html">FUNCTION-TYPE</A><P>
                <A HREF="iss015.html">ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS</A><P>
                COERCE-INCOMPLETE<P>
			<P>
<P>
<B>Category:</B>       CLARIFICATION/CHANGE<P>
<P>
<B>Edit history:</B>   Version 1,  1-Dec-88, Masinter<P>
		    Version 2,  9-Dec-88, Masinter<P>
		    Version 3, 12-Dec-88, Masinter (fix &quot;egregious bug&quot;)<P>
		Version 4, 3-14-89 Steele<P>
		Version 5, 16-Mar-89, Masinter (add other amendments)<P>
		Version 6, 22-Jun-89, Masinter (fix as per Moon)<P>
<P>
<B>Problem description:<P>
</B><P>
The specification of <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> in CLtL is so weak as to leave it <P>
nearly useless, if any implementor actually took the specification<P>
seriously.In particular, there are almost no constraints on the<P>
value that <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> might return for any of the built in<P>
types. The only constraint placed is that for objects created by the<P>
constructor function of <A REL=DEFINITION HREF="../Body/mac_defstruct.html#defstruct"><B>DEFSTRUCT</B></A>, the result of <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> is the name of the<P>
<A REL=DEFINITION HREF="../Body/mac_defstruct.html#defstruct"><B>defstruct</B></A>.<P>
<P>
This means that implementations could return T for all other objects.<P>
<P>
<B>Proposal (TYPE-OF-UNDERCONSTRAINED:ADD-CONSTRAINTS): <P>
</B><P>
Specify that the result of <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> satisfies the following:<P>
<P>
(a) For any object for which (<A REL=DEFINITION HREF="../Body/fun_typep.html#typep"><B>typep</B></A> object built-in-type) is true when<P>
built-in-type is one of <P>
<P>
<A REL=DEFINITION HREF="../Body/syscla_integer.html#integer"><B>INTEGER</B></A>, <A REL=DEFINITION HREF="../Body/syscla_ratio.html#ratio"><B>RATIO</B></A>, <A REL=DEFINITION HREF="../Body/any_float.html#float"><B>FLOAT</B></A>, <A REL=DEFINITION HREF="../Body/any_complex.html#complex"><B>COMPLEX</B></A>, <A REL=DEFINITION HREF="../Body/syscla_number.html#number"><B>NUMBER</B></A>, <A REL=DEFINITION HREF="../Body/any_null.html#null"><B>NULL</B></A>, <A REL=DEFINITION HREF="../Body/syscla_symbol.html#symbol"><B>SYMBOL</B></A>, <P>
<A REL=DEFINITION HREF="../Body/any_string.html#string"><B>STRING</B></A>, <A REL=DEFINITION HREF="../Body/syscla_bit-vector.html#bit-vector"><B>BIT-VECTOR</B></A>, <A REL=DEFINITION HREF="../Body/any_vector.html#vector"><B>VECTOR</B></A>, <A REL=DEFINITION HREF="../Body/syscla_array.html#array"><B>ARRAY</B></A>, <A REL=DEFINITION HREF="../Body/syscla_random-state.html#random-state"><B>RANDOM-STATE</B></A>, <A REL=DEFINITION HREF="../Body/syscla_sequence.html#sequence"><B>SEQUENCE</B></A>,<A REL=DEFINITION HREF="../Body/any_cons.html#cons"><B>CONS</B></A>, <P>
<A REL=DEFINITION HREF="../Body/syscla_stream.html#stream"><B>STREAM</B></A>, <A REL=DEFINITION HREF="../Body/syscla_package.html#package"><B>PACKAGE</B></A>, <A REL=DEFINITION HREF="../Body/any_character.html#character"><B>CHARACTER</B></A>, <A REL=DEFINITION HREF="../Body/any_function.html#function"><B>FUNCTION</B></A>, <A REL=DEFINITION HREF="../Body/syscla_readtable.html#readtable"><B>READTABLE</B></A>, <A REL=DEFINITION HREF="../Body/syscla_hash-table.html#hash-table"><B>HASH-TABLE</B></A>, <A REL=DEFINITION HREF="../Body/any_pathname.html#pathname"><B>PATHNAME</B></A>,<P>
<A REL=DEFINITION HREF="../Body/contyp_condition.html#condition"><B>CONDITION</B></A>, <A REL=DEFINITION HREF="../Body/syscla_restart.html#restart"><B>RESTART</B></A>,<P>
<A REL=DEFINITION HREF="../Body/any_rational.html#rational"><B>RATIONAL</B></A>, <A REL=DEFINITION HREF="../Body/typ_short-flo_m_long-float.html#short-float"><B>SHORT-FLOAT</B></A>, <A REL=DEFINITION HREF="../Body/typ_short-flo_m_long-float.html#long-float"><B>LONG-FLOAT</B></A>, <A REL=DEFINITION HREF="../Body/typ_short-flo_m_long-float.html#single-float"><B>SINGLE-FLOAT</B></A>, <A REL=DEFINITION HREF="../Body/typ_short-flo_m_long-float.html#double-float"><B>DOUBLE-FLOAT</B></A><P>
<P>
the result of <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> will be a type specifier for which<P>
(<A REL=DEFINITION HREF="../Body/fun_subtypep.html#subtypep"><B>subtypep</B></A> (<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>type-of</B></A> object) built-in-type) returns T T, i.e., either the<P>
build-in-type or a subtype of it (a subtype that the <P>
implementation's <A REL=DEFINITION HREF="../Body/fun_subtypep.html#subtypep"><B>SUBTYPEP</B></A> can recognize.)<P>
<P>
<P>
(b)  For all objects, (<A REL=DEFINITION HREF="../Body/fun_typep.html#typep"><B>TYPEP</B></A> object (<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> object)) will be true.<P>
(this implies that it will <A REL=DEFINITION HREF="../Body/any_not.html#not"><B>not</B></A> be <A REL=DEFINITION HREF="../Body/any_nil.html#nil"><B>NIL</B></A>, since no<P>
object is of <A REL=DEFINITION HREF="../Body/any_type.html#type"><B>type</B></A> <A REL=DEFINITION HREF="../Body/any_nil.html#nil"><B>NIL</B></A>.)<P>
<P>
(c) will not be T, or use <A REL=DEFINITION HREF="../Body/typspe_satisfies.html#satisfies"><B>SATISFIES</B></A>, <A REL=DEFINITION HREF="../Body/any_and.html#and"><B>AND</B></A>, <A REL=DEFINITION HREF="../Body/any_or.html#or"><B>OR</B></A>, <A REL=DEFINITION HREF="../Body/any_not.html#not"><B>NOT</B></A> or <A REL=DEFINITION HREF="../Body/any_values.html#values"><B>VALUES</B></A>.<P>
<P>
(d) The type returned by <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> is always a subtype of the <A REL=DEFINITION HREF="../Body/syscla_class.html#class"><B>class</B></A><P>
returned by <A REL=DEFINITION HREF="../Body/fun_class-of.html#class-of"><B>CLASS-OF</B></A>, and is a subtype that the implementation's<P>
<A REL=DEFINITION HREF="../Body/fun_subtypep.html#subtypep"><B>SUBTYPEP</B></A> can recognize.<P>
<P>
(e) For objects of metaclass <A REL=DEFINITION HREF="../Body/syscla_structure-class.html#structure-class"><B>STRUCTURE-CLASS</B></A> or <A REL=DEFINITION HREF="../Body/syscla_standard-class.html#standard-class"><B>STANDARD-CLASS</B></A>,<P>
<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> returns the proper name of the <A REL=DEFINITION HREF="../Body/syscla_class.html#class"><B>class</B></A> returned by <A REL=DEFINITION HREF="../Body/fun_class-of.html#class-of"><B>CLASS-OF</B></A><P>
if it has a proper name, and otherwise returns the <A REL=DEFINITION HREF="../Body/syscla_class.html#class"><B>class</B></A> itself.<P>
<P>
In particular, for objects created by the &quot;constructor&quot; function<P>
of a <A REL=DEFINITION HREF="../Body/stagenfun_doc_umentationcp.html#structure"><B>structure</B></A> defined with <A REL=DEFINITION HREF="../Body/mac_defstruct.html#defstruct"><B>DEFSTRUCT</B></A> without a :TYPE option,<P>
<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> will return the <A REL=DEFINITION HREF="../Body/stagenfun_doc_umentationcp.html#structure"><B>structure</B></A> name.<P>
<P>
This proposal is intended to be consistent with 88-002R, <P>
and not to conflict with any of the definitions in that document.<P>
<P>
<B>Examples:<P>
</B><P>
It is legal for (<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> &quot;abc&quot;) to return (<A REL=DEFINITION HREF="../Body/typ_simple-string.html#simple-string"><B>SIMPLE-STRING</B></A> 3), or just<P>
<A REL=DEFINITION HREF="../Body/any_string.html#string"><B>STRING</B></A>. It is legal for (<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> 112312) to return SI:MEDIUM-SIZE-FIXNUM,<P>
as long as (<A REL=DEFINITION HREF="../Body/fun_subtypep.html#subtypep"><B>SUBTYPEP</B></A> 'SI:MEDIUM-SIZE-FIXNUM '<A REL=DEFINITION HREF="../Body/syscla_integer.html#integer"><B>INTEGER</B></A>).<P>
<P>
 Given:<P>
<P>
   (<A REL=DEFINITION HREF="../Body/mac_defparametercm_defvar.html#defvar"><B>defvar</B></A> *foo* (<A REL=DEFINITION HREF="../Body/fun_make-array.html#make-array"><B>make-array</B></A> 5 :element-type t))<P>
   (<A REL=DEFINITION HREF="../Body/stagenfun_class-name.html#class-name"><B>class-name</B></A> (<A REL=DEFINITION HREF="../Body/fun_class-of.html#class-of"><B>class-of</B></A> *foo*))  =&gt;  <A REL=DEFINITION HREF="../Body/typ_simple-vector.html#simple-vector"><B>SIMPLE-VECTOR</B></A><P>
  It is legal for<P>
   (<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>type-of</B></A> *foo*)                =&gt;  (<A REL=DEFINITION HREF="../Body/typ_simple-vector.html#simple-vector"><B>SIMPLE-VECTOR</B></A> 5)<P>
<P>
<P>
<B>Rationale:<P>
</B><P>
The original specification for &quot;TYPE-OF&quot; was written to allow<P>
implementation freedom, but the wording is in fact more vague than was<P>
intended. <P>
<P>
<B>Current practice:<P>
</B><P>
Most Common Lisp implementations seem to implement the proposal, at least<P>
for the types we've tried them on.<P>
<P>
<B>Cost to Implementors:<P>
</B><P>
Even if there are implementations that do not currently implement the<P>
proposal, the required changes for them are likely to be minimal. <P>
<P>
<B>Cost to Users:<P>
</B><P>
Apparently none.<P>
<P>
<B>Cost of non-adoption:<P>
</B><P>
<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> would remain potentially inconsistent.<P>
<P>
<B>Performance impact:<P>
</B><P>
Likely none.<P>
<P>
<B>Benefits:<P>
</B><P>
Bring the specification of <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> in like with its common<P>
implementation, while requiring it to be generally useful.<P>
<P>
<B>Esthetics:<P>
</B><P>
Little effect.<P>
<P>
<B>Discussion:<P>
</B><P>
Originally, <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> was concieved as being useful for information display.<P>
CLOS specified <A REL=DEFINITION HREF="../Body/fun_class-of.html#class-of"><B>CLASS-OF</B></A> far more precisely, in that it must return exactly<P>
the <A REL=DEFINITION HREF="../Body/syscla_class.html#class"><B>class</B></A> of an object. Unless <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> is removed from the language, it<P>
seems reasonable to <A REL=DEFINITION HREF="../Body/fun_providecm_require.html#require"><B>require</B></A> it to be at least as precise as <A REL=DEFINITION HREF="../Body/fun_class-of.html#class-of"><B>CLASS-OF</B></A>.<P>
<P>
The accepted CLOS specification does not define <A REL=DEFINITION HREF="../Body/fun_class-of.html#class-of"><B>CLASS-OF</B></A><P>
in terms of <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A>, but an earlier draft did. <P>
<P>
This proposal presumes the (passed) proposals<P>
DATA-TYPES-HIERARCHY-UNDERSPECIFIED:DISJOINT, <A HREF="iss175-menu.html">FUNCTION-TYPE</A>, and<P>
accomodates the Condition System (version 18) and CLOS.<P>
<P>
If <A HREF="iss015.html">ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS</A> does not pass, <P>
and this proposal does pass, it may be that the only way an <P>
implementation can satisfy (<A REL=DEFINITION HREF="../Body/fun_typep.html#typep"><B>TYPEP</B></A> array (<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> array))<P>
would be to have (<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> array) return <A REL=DEFINITION HREF="../Body/any_vector.html#vector"><B>VECTOR</B></A> or <A REL=DEFINITION HREF="../Body/syscla_array.html#array"><B>ARRAY</B></A><P>
as appropriate, i.e., with no element type qualification.<P>
<P>
It is possible to constrain <A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> further, e.g., to eliminate<P>
the possibility that it might return a non-portable <P>
implementation-specific value. For example, <P>
(<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> 112312) should not return SI:MEDIUM-SIZE-FIXNUM, but rather some<P>
thing like (<A REL=DEFINITION HREF="../Body/typ_signed-byte.html#signed-byte"><B>SIGNED-BYTE</B></A> 17) [if that's what SI:MEDIUM-SIZE-FIXNUM means.]<P>
<P>
We would like to make this as an implementation recommendation,<P>
however, rather than as a constraint, at this point.<P>
<P>
About part (c): the restriction on T is meaningless, since the <A REL=DEFINITION HREF="../Body/fun_class-of.html#class-of"><B>CLASS-OF</B></A><P>
restriction dominates it. The restriction on <A REL=DEFINITION HREF="../Body/any_member.html#member"><B>MEMBER</B></A> is OK, just to keep<P>
<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>TYPE-OF</B></A> from being the silly definition that (<A REL=DEFINITION HREF="../Body/fun_type-of.html#type-of"><B>type-of</B></A> x) = `(member ,x).  I<P>
think we're running out of good reasons to leave out <A REL=DEFINITION HREF="../Body/typspe_satisfies.html#satisfies"><B>SATISFIES</B></A>, <A REL=DEFINITION HREF="../Body/any_and.html#and"><B>AND</B></A>, <A REL=DEFINITION HREF="../Body/any_or.html#or"><B>OR</B></A>,<P>
<A REL=DEFINITION HREF="../Body/any_not.html#not"><B>NOT</B></A>, and VALUES; they're probably no more useful, but we're probably<P>
overspecifying for no good reason.<P>
<P>
Some types are left out of the list in (a), including:<P>
<P>
<A REL=DEFINITION HREF="../Body/typ_bignum.html#bignum"><B>BIGNUM</B></A> and <A REL=DEFINITION HREF="../Body/typ_fixnum.html#fixnum"><B>FIXNUM</B></A> were left out because their division was implementation<P>
dependent.<P>
<P>
<A REL=DEFINITION HREF="../Body/typ_keyword.html#keyword"><B>KEYWORD</B></A> was left out because under odd circumstances it is possible to<P>
dynamically change the 'type' (e.g., by <A REL=DEFINITION HREF="../Body/fun_unintern.html#unintern"><B>UNINTERN</B></A>).<P>
<P>
<A REL=DEFINITION HREF="../Body/typ_standard-char.html#standard-char"><B>STANDARD-CHAR</B></A> and STRING-CHAR were left out for the same reasons they<P>
aren't built-in classes.<P>
<P>
(These reasonas are <A REL=DEFINITION HREF="../Body/any_not.html#not"><B>not</B></A> 100% compelling.)<P>
</PRE>

<HR>

<A REL=NAVIGATOR HREF="../FrontMatter/Starting-Points.html"><IMG ALT="[Starting Points]" SRC="../Graphics/Starting-Points.gif" ALIGN=Bottom></A><A REL=TOC HREF="../FrontMatter/Chapter-Index.html"><IMG ALT="[Contents]" SRC="../Graphics/Contents.gif" ALIGN=Bottom></A><A REL=INDEX HREF="../FrontMatter/Master-Index.html"><IMG ALT="[Index]" SRC="../Graphics/Index.gif" ALIGN=Bottom></A><A REL=INDEX HREF="../FrontMatter/Symbol-Index.html"><IMG ALT="[Symbols]" SRC="../Graphics/Symbols.gif" ALIGN=Bottom></A><A REL=GLOSSARY HREF="../Body/sec_26-1.html"><IMG ALT="[Glossary]" SRC="../Graphics/Glossary.gif" ALIGN=Bottom></A><A HREF="Issues-Categorized.html"><IMG ALT="[Issues]" SRC="../Graphics/Issues.gif" ALIGN=Bottom></A><BR>

<A REL=COPYRIGHT HREF="../FrontMatter/About-HyperSpec.html#Legal"><I>Copyright 1996, The Harlequin Group Limited.  All Rights Reserved.</I></A><P>
</BODY>

<!-- Mirrored from www.cs.cmu.edu/afs/cs/project/ai-repository/ai/util/html/hyperspec/HyperSpec/Issues/iss353-writeup.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 22 Oct 2021 10:19:55 GMT -->
</HTML>
